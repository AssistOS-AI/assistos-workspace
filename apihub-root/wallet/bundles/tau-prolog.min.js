/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/tau-prolog@0.3.4/modules/core.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(){var e,r={major:0,minor:3,patch:4,status:"beta"};function t(e,r,t,i){i=void 0===i?"":i,this.name=e,this.type=r,this.parent=t,this.text=i,this.created=Date.now()/1e3,this.modified=this.created}function n(e,r){this.name=e,this.parent=r,this.files={},this.length=0,this.created=Date.now()/1e3,this.modified=this.created}t.prototype.get=function(e,r){return r===this.text.length||r>this.text.length?"end_of_stream":this.text.substring(r,r+e)},t.prototype.eof=function(e){return e===this.text.length},t.prototype.put=function(e,r){return"end_of_stream"===r?(this.text+=e,!0):"past_end_of_stream"===r?null:(this.text=this.text.substring(0,r)+e+this.text.substring(r+e.length),!0)},t.prototype.get_byte=function(e){if("end_of_stream"===e)return-1;var r=Math.floor(e/2);if(this.text.length<=r)return-1;var t=s(this.text[Math.floor(e/2)],0);return e%2==0?255&t:t/256>>>0},t.prototype.put_byte=function(e,r){var t="end_of_stream"===r?this.text.length:Math.floor(r/2);if(this.text.length<t)return null;var i=this.text.length===t?-1:s(this.text[Math.floor(r/2)],0);return i=r%2==0?(255&(i=i/256>>>0))<<8|255&e:(255&e)<<8|255&(i&=255),this.text.length===t?this.text+=l(i):this.text=this.text.substring(0,t)+l(i)+this.text.substring(t+1),!0},t.prototype.flush=function(){return!0},t.prototype.close=function(){return this.modified=Date.now()/1e3,!0},t.prototype.size=function(){return this.text.length},n.prototype.lookup=function(e){return this.files.hasOwnProperty(e)?this.files[e]:null},n.prototype.push=function(e,r){this.files.hasOwnProperty(e)||this.length++,this.files[e]=r,this.modified=Date.now()/1e3},n.prototype.remove=function(e){this.files.hasOwnProperty(e)&&(this.length--,delete this.files[e],this.modified=Date.now()/1e3)},n.prototype.empty=function(){return 0===this.length},n.prototype.size=function(){return 4096},tau_file_system={files:new n("/","/",null),open:function(e,r,i){for(var n=e.replace(/\/$/,"").split("/"),a=tau_file_system.files,o=n[n.length-1],s=1;s<n.length-1;s++)if(a=a.lookup(n[s]),!H.type.is_directory(a))return null;var l=a.lookup(o);if(null===l){if("read"===i)return null;l=new t(o,r,a),a.push(o,l)}else if(!H.type.is_file(l))return null;return"write"===i&&(l.text=""),l},get:function(e){for(var r=e.replace(/\/$/,"").split("/"),t=tau_file_system.files,i=1;i<r.length;i++){if(!H.type.is_directory(t))return null;t=t.lookup(r[i])}return t}},tau_user_input={buffer:"",get:function(e,r){for(var t;tau_user_input.buffer.length<e;){if(0===(t=window.prompt()).length)return"end_of_stream";t&&(tau_user_input.buffer+=t)}return t=tau_user_input.buffer.substr(0,e),tau_user_input.buffer=tau_user_input.buffer.substr(e),t},eof:function(e){return!1}},tau_user_output={put:function(e,r){return console.log(e),!0},flush:function(){return!0}},tau_user_error={put:function(e,r){return(console.error||console.log)(e),!0},flush:function(){return!0}},nodejs_file_system={open:function(e,r,t){var i,n=require("fs");if("read"===t&&!n.existsSync(e))return null;try{i=n.openSync(e,t[0])}catch(e){return!1}return{get:function(e,r){var t=new Buffer(e);n.readSync(i,t,0,e,r);for(var a=!0,o=t.toString(),s=0;s<e&&a;s++)a="\0"===o[s];return a?"end_of_stream":t.toString()},eof:function(r){return r===n.statSync(e).size},put:function(e,r){var t=Buffer.from(e);if("end_of_stream"===r)n.writeSync(i,t);else{if("past_end_of_stream"===r)return null;n.writeSync(i,t,0,t.length,r)}return!0},get_byte:function(e){try{var r=Buffer.alloc(1);return n.readSync(i,r,0,1,e)<1?"end_of_stream":r.readUInt8(0)}catch(e){return"end_of_stream"}},put_byte:function(e,r){var t=Buffer.from([e]);if("end_of_stream"===r)n.writeSync(i,t);else{if("past_end_of_stream"===r)return null;n.writeSync(i,t,0,t.length,r)}return!0},flush:function(){return!0},close:function(){return n.closeSync(i),!0}}}},nodejs_user_input={buffer:"",get:function(e,r){for(var t,i=require("readline-sync");nodejs_user_input.buffer.length<e;)nodejs_user_input.buffer+=i.question("",{keepWhitespace:!0})+"\n";return t=nodejs_user_input.buffer.substr(0,e),nodejs_user_input.buffer=nodejs_user_input.buffer.substr(e),t},eof:function(e){return!1}},nodejs_user_output={put:function(e,r){return process.stdout.write(e),!0},flush:function(){return!0}},nodejs_user_error={put:function(e,r){return process.stderr.write(e),!0},flush:function(){return!0}},e=Array.prototype.indexOf?function(e,r){return e.indexOf(r)}:function(e,r){for(var t=e.length,i=0;i<t;i++)if(r===e[i])return i;return-1};var a,o,s,l,p,u=function(e,r){if(0!==e.length){for(var t=e[0],i=e.length,n=1;n<i;n++)t=r(t,e[n]);return t}};a=Array.prototype.map?function(e,r){return e.map(r)}:function(e,r){for(var t=[],i=e.length,n=0;n<i;n++)t.push(r(e[n]));return t},o=Array.prototype.filter?function(e,r){return e.filter(r)}:function(e,r){for(var t=[],i=e.length,n=0;n<i;n++)r(e[n])&&t.push(e[n]);return t},s=String.prototype.codePointAt?function(e,r){return e.codePointAt(r)}:function(e,r){return e.charCodeAt(r)},l=String.fromCodePoint?function(){return String.fromCodePoint.apply(null,arguments)}:function(){return String.fromCharCode.apply(null,arguments)};var _=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;p=Array.from?function(e){return Array.from(e).length}:function(e){return e.replace(_,"_").length};var c=/(\\a)|(\\b)|(\\d)|(\\e)|(\\f)|(\\n)|(\\r)|(\\s)|(\\t)|(\\v)|\\x([0-9a-fA-F]+)\\|\\([0-7]+)\\|(\\\\)|(\\')|('')|(\\")|(\\`)|(\\.)|(.)/g,d={"\\a":7,"\\b":8,"\\d":127,"\\e":27,"\\f":12,"\\n":10,"\\r":13,"\\s":32,"\\t":9,"\\v":11};function w(e,r){var t="";if("\\"===e)return null;if(e.length<2)return e;try{e=(e=(e=e.replace(/((?:\\\\)+)|\\([0-7]+)\\/g,(function(e,r,t){return r||l(parseInt(t,8))}))).replace(/((?:\\\\)+)|\\x([0-9a-fA-F]+)\\/g,(function(e,r,t){return r||l(parseInt(t,16))}))).replace(/((?:\\\\)+)|\\u([0-9a-fA-F]{4})/g,(function(e,r,t){return r||l(parseInt(t,16))}))}catch(e){return null}for(var i=0;i<e.length;i++){var n=e.charAt(i),a=e.charAt(i+1);if(n===r&&a===r)i++,t+=r;else if("\\"===n){if(-1===["a","b","f","n","r","t","v","'",'"',"\\","a","\b","\f","\n","\r","\t","\v"].indexOf(a))return null;switch(i+=1,a){case"a":t+="a";break;case"b":t+="\b";break;case"f":t+="\f";break;case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"v":t+="\v";break;case"'":t+="'";break;case'"':t+='"';break;case"\\":t+="\\"}}else t+=n}return t}function f(e){var r,t,i,n=e.substr(2);switch(e.substr(0,2).toLowerCase()){case"0x":return parseInt(n,16);case"0b":return parseInt(n,2);case"0o":return parseInt(n,8);case"0'":return(r=n,t=[],i=!1,r.replace(c,(function(e,r,n,a,o,l,p,u,_,c,w,f,y,h,g,v,m,b,x,k){switch(!0){case void 0!==f:return t.push(parseInt(f,16)),"";case void 0!==y:return t.push(parseInt(y,8)),"";case void 0!==h:case void 0!==g:case void 0!==v:case void 0!==m:case void 0!==b:return t.push(s(e.substr(1),0)),"";case void 0!==k:return t.push(s(k,0)),"";case void 0!==x:i=!0;default:return t.push(d[e]),""}})),i?null:t)[0];default:return parseFloat(e)}}function y(e){return/^[#\$\&\*\+\-\.\/\:\<\=\>\?\@\^\~\\]+/.test(e)}var h={whitespace:/^\s*(?:(?:%.*)|(?:\/\*(?:\n|\r|.)*?(?:\*\/|$))|(?:\s+))\s*/,variable:/^(?:[A-Z_][a-zA-Z0-9_]*)/,atom:/^(\!|,|;|[a-z][0-9a-zA-Z_]*|[#\$\&\*\+\-\.\/\:\<\=\>\?\@\^\~\\]+|'(?:(?:'')|(?:\\\\)|(?:\\')|[^'])*')/,number:/^(?:0o[0-7]+|0x[0-9a-fA-F]+|0b[01]+|0'(?:''|\\[abdefnrstv\\'"`]|\\x?\d+\\|[^\\])|\d+(?:\.\d+(?:[eE][+-]?\d+)?)?)/,string:/^(?:"([^"]|""|\\")*"|`([^`]|``|\\`)*`)/,l_brace:/^(?:\[)/,r_brace:/^(?:\])/,l_bracket:/^(?:\{)/,r_bracket:/^(?:\})/,bar:/^(?:\|)/,l_paren:/^(?:\()/,r_paren:/^(?:\))/};function g(e){this.thread=e,this.text="",this.tokens=[]}function v(e,r,t,i,n){if(!r[t])return{type:0,value:H.error.syntax(r[t-1],"expression expected",!0)};if("0"===i){switch((_=r[t]).name){case"number":return{type:1,len:t+1,value:new H.type.Num(_.value,_.float)};case"variable":return{type:1,len:t+1,value:new H.type.Var(_.value)};case"string":var a;switch(e.get_flag("double_quotes").id){case"atom":a=new Y(_.value,[]);break;case"codes":a=new Y("[]",[]);for(var o=_.value.length-1;o>=0;o--)a=new Y(".",[new H.type.Num(s(_.value,o),!1),a]);break;case"chars":a=new Y("[]",[]);for(o=_.value.length-1;o>=0;o--)a=new Y(".",[new H.type.Term(_.value.charAt(o),[]),a])}return{type:1,len:t+1,value:a};case"l_paren":return 1!==(c=v(e,r,t+1,e.__get_max_priority(),!0)).type?c:r[c.len]&&"r_paren"===r[c.len].name?(c.len++,c):{type:0,derived:!0,value:H.error.syntax(r[c.len]?r[c.len]:r[c.len-1],") or operator expected",!r[c.len])};case"l_bracket":return 1!==(c=v(e,r,t+1,e.__get_max_priority(),!0)).type?c:r[c.len]&&"r_bracket"===r[c.len].name?(c.len++,c.value=new Y("{}",[c.value]),c):{type:0,derived:!0,value:H.error.syntax(r[c.len]?r[c.len]:r[c.len-1],"} or operator expected",!r[c.len])}}var l=function(e,r,t,i){if(!r[t]||"atom"===r[t].name&&"."===r[t].raw&&!i&&(r[t].space||!r[t+1]||"l_paren"!==r[t+1].name))return{type:0,derived:!1,value:H.error.syntax(r[t-1],"unfounded token")};var n=r[t],a=[];if("atom"===r[t].name&&","!==r[t].raw){if(r[++t-1].space)return{type:1,len:t,value:new H.type.Term(n.value,a)};if(r[t]&&"l_paren"===r[t].name){if(r[t+1]&&"r_paren"===r[t+1].name)return{type:0,derived:!0,value:H.error.syntax(r[t+1],"argument expected")};var o=v(e,r,++t,"999",!0);if(0===o.type)return o.derived?o:{type:0,derived:!0,value:H.error.syntax(r[t]?r[t]:r[t-1],"argument expected",!r[t])};for(a.push(o.value),t=o.len;r[t]&&"atom"===r[t].name&&","===r[t].value;){if(0===(o=v(e,r,t+1,"999",!0)).type)return o.derived?o:{type:0,derived:!0,value:H.error.syntax(r[t+1]?r[t+1]:r[t],"argument expected",!r[t+1])};a.push(o.value),t=o.len}if(!r[t]||"r_paren"!==r[t].name)return{type:0,derived:!0,value:H.error.syntax(r[t]?r[t]:r[t-1],", or ) expected",!r[t])};t++}return{type:1,len:t,value:new H.type.Term(n.value,a)}}return{type:0,derived:!1,value:H.error.syntax(r[t],"term expected")}}(e,r,t,n);return 1===l.type||l.derived?l:(l=function(e,r,t){if(!r[t])return{type:0,derived:!1,value:H.error.syntax(r[t-1],"[ expected")};if(r[t]&&"l_brace"===r[t].name){var i=v(e,r,++t,"999",!0),n=[i.value],a=void 0;if(0===i.type)return r[t]&&"r_brace"===r[t].name?{type:1,len:t+1,value:new H.type.Term("[]",[])}:{type:0,derived:!0,value:H.error.syntax(r[t],"] expected")};for(t=i.len;r[t]&&"atom"===r[t].name&&","===r[t].value;){if(0===(i=v(e,r,t+1,"999",!0)).type)return i.derived?i:{type:0,derived:!0,value:H.error.syntax(r[t+1]?r[t+1]:r[t],"argument expected",!r[t+1])};n.push(i.value),t=i.len}var o=!1;if(r[t]&&"bar"===r[t].name){if(o=!0,0===(i=v(e,r,t+1,"999",!0)).type)return i.derived?i:{type:0,derived:!0,value:H.error.syntax(r[t+1]?r[t+1]:r[t],"argument expected",!r[t+1])};a=i.value,t=i.len}return r[t]&&"r_brace"===r[t].name?{type:1,len:t+1,value:V(n,a)}:{type:0,derived:!0,value:H.error.syntax(r[t]?r[t]:r[t-1],o?"] expected":", or | or ] expected",!r[t])}}return{type:0,derived:!1,value:H.error.syntax(r[t],"list expected")}}(e,r,t),1===l.type||l.derived?l:{type:0,derived:!1,value:H.error.syntax(r[t],_.error||"unexpected token")})}e.__get_max_priority();var p=e.__get_next_priority(i),u=t;if("atom"===r[t].name&&r[t+1]&&(r[t].space||"l_paren"!==r[t+1].name)){var _=r[t++];if((f=e.__lookup_operator_classes(i,_.value))&&f.indexOf("fy")>-1){if(0!==(c=v(e,r,t,i,n)).type)return"-"===_.value&&!_.space&&H.type.is_number(c.value)?{value:new H.type.Num(-c.value.value,c.value.is_float),len:c.len,type:1}:{value:new H.type.Term(_.value,[c.value]),len:c.len,type:1};c}else if(f&&f.indexOf("fx")>-1){var c;if(0!==(c=v(e,r,t,p,n)).type)return{value:new H.type.Term(_.value,[c.value]),len:c.len,type:1};c}}if(1===(c=v(e,r,t=u,p,n)).type){_=r[t=c.len];if(r[t]&&("atom"===r[t].name&&e.__lookup_operator_classes(i,_.value)||"bar"===r[t].name&&e.__lookup_operator_classes(i,"|"))){var d=p,w=i;if((f=e.__lookup_operator_classes(i,_.value)).indexOf("xf")>-1)return{value:new H.type.Term(_.value,[c.value]),len:++c.len,type:1};if(f.indexOf("xfx")>-1)return 1===(y=v(e,r,t+1,d,n)).type?{value:new H.type.Term(_.value,[c.value,y.value]),len:y.len,type:1}:(y.derived=!0,y);if(f.indexOf("xfy")>-1)return 1===(y=v(e,r,t+1,w,n)).type?{value:new H.type.Term(_.value,[c.value,y.value]),len:y.len,type:1}:(y.derived=!0,y);if(0!==c.type)for(;;){var f;if(!(_=r[t=c.len])||"atom"!==_.name||!e.__lookup_operator_classes(i,_.value))break;if((f=e.__lookup_operator_classes(i,_.value)).indexOf("yf")>-1)c={value:new H.type.Term(_.value,[c.value]),len:++t,type:1};else{if(!(f.indexOf("yfx")>-1))break;var y;if(0===(y=v(e,r,++t,d,n)).type)return y.derived=!0,y;t=y.len,c={value:new H.type.Term(_.value,[c.value,y.value]),len:t,type:1}}}}else({type:0,value:H.error.syntax(r[c.len-1],"operator expected")});return c}return c}function m(e,r,t){var i,n=r[t].line,a=v(e,r,t,e.__get_max_priority(),!1),o=null;if(0!==a.type){if(r[t=a.len]&&"atom"===r[t].name&&"."===r[t].raw){if(t++,H.type.is_term(a.value)){if(":-/2"===a.value.indicator)i={value:o=new H.type.Rule(a.value.args[0],O(a.value.args[1])),len:t,type:1};else if("--\x3e/2"===a.value.indicator){if(o=function(e,r){r.session.renamed_variables={},e=e.rename(r);var t=r.next_free_variable(),i=A(e.body,t,r);if(i.error)return i.value;if(e.body=i.value,",/2"===e.head.indicator){var n=e.head.args[1];e.head=e.head.args[0];var a=r.next_free_variable(),o=n;if(!H.type.is_list(o))return H.error.type("list",o,"DCG/0");if("[]/0"===o.indicator)n=i.variable;else{for(;"./2"===o.indicator&&H.type.is_list(o)&&"[]/0"!==o.args[1].indicator;)o=o.args[1];if(H.type.is_variable(o))return H.error.instantiation("DCG/0");if(!H.type.is_list(o))return H.error.type("list",n,"DCG/0");o.args[1]=i.variable}e.body=new Y(",",[e.body,new Y("=",[a,n])]),e.head=new Y(e.head.id,e.head.args.concat([t,a]))}else{var s=e.body;H.type.is_term(s)&&",/2"===s.indicator&&(s=s.args[0]),H.type.is_term(s)&&"=/2"===s.indicator&&H.type.is_variable(s.args[0])&&s.args[0]===t&&(t=s.args[1],e.body=e.body.replace(null)),":/2"===e.head.indicator?e.head=new Y(":",[new Y(e.head.args[0].id,[]),new Y(e.head.args[1].id,e.head.args[1].args.concat([t,i.variable]))]):e.head=new Y(e.head.id,e.head.args.concat([t,i.variable]))}return e}(o=new H.type.Rule(a.value.args[0],O(a.value.args[1])),e),o.body=O(o.body),!H.type.is_rule(o))return{value:o,len:t,type:0};i={value:o,len:t,type:H.type.is_rule(o)?1:0}}else i={value:o=new H.type.Rule(a.value,null),len:t,type:1};if(o){var s=o.singleton_variables();s.length>0&&e.throw_warning(H.warning.singleton(s,o.head.indicator,n))}return i}return{type:0,value:H.error.syntax(r[t],"callable expected")}}return{type:0,value:H.error.syntax(r[t]?r[t]:r[t-1],". or operator expected")}}return a}function b(e,r,t){var i={};t=t||{},i.success=t.success?t.success:function(){},i.error=t.error?t.error:function(){},i.from=t.from?t.from:"$tau-js",i.reconsult=void 0===t.reconsult||t.reconsult,i.reconsulted=void 0===t.reconsulted?{}:t.reconsulted,i.context_module=void 0===t.context_module?"user":t.context_module,i.initialization=void 0===t.initialization?[]:t.initialization,i.current_token=void 0===t.current_token?0:t.current_token,i.tokenizer=void 0===t.tokenizer?null:t.tokenizer,i.tokens=void 0===t.tokens?null:t.tokens,i.string=r,i.term_expansion=!1;var n=i.reconsulted,a=i.tokenizer,o=i.tokens;null===a&&((a=new g(e)).new_text(r),i.tokenizer=a,o=a.get_tokens(0),i.tokens=o);for(var s=i.current_token;null!==o&&o[s];){var l=m(e,o,s);if(i.current_token=l.len,0===l.type)return void(void 0!==i.error&&i.error(new Y("throw",[l.value])));var p=i.context_module,u=e.session.modules[p].rules["term_expansion/2"];if(u&&u.length>0){i.term_expansion=!0;var _=new L(e.session),c=l.value.body?new Y(":-",[l.value.head,l.value.body]):l.value.head;return e.session.renamed_variables={},c=c.rename(e.session),_.query(p+":term_expansion("+c.toString({quoted:!0})+", X)."),void _.answer(function(e,r,t,i){return function(n){if(n&&!H.type.is_error(n)&&H.type.is_term(n.links.X)){var a=n.links.X,o=":-/2"===a.indicator?new z(a.args[0],a.args[1]):new z(a,null);T(e,r,t,{value:o,len:i.len,type:i.type})}else T(e,r,t,i)}}(e,i,n,l))}if(i.term_expansion=!1,T(e,i,n,l))return;s=l.len}for(var d=i.success,w=new L(e.session),f=i.initialization.length-1;f>0;f--){var y=function(e,r){return function(t){null===t?w.answer():H.type.is_error(t)?i.error(t):(w.add_goal(e),w.answer(r))}}(i.initialization[f],d);d=y}i.initialization.length>0?(w.add_goal(i.initialization[0]),w.answer(d)):d()}function x(e,r,t){var i=new L(e.session);i.__goal_expansion=!0;var n=e.next_free_variable(),a=e.next_free_variable(),o=a+" = "+t.value.head+", goal_expansion("+t.value.body.toString({quoted:!0})+", "+n.toString({quoted:!0})+").";i.query(o),i.answer((function(i){i&&!H.type.is_error(i)&&i.links[n]?(t.value.head=i.links[a],t.value.body=O(i.links[n]),x(e,r,t)):(e.add_rule(t.value,r),b(e,r.string,r))}))}function k(e,r,t){var i=new L(e.session);i.__goal_expansion=!0;var n=e.next_free_variable(),a="goal_expansion("+r.toString({quoted:!0})+", "+n.toString({quoted:!0})+").";i.query(a);var o=i.head_point().substitution.domain();i.answer((function(i){if(i&&!H.type.is_error(i)&&i.links[n]){for(var a=0;a<o.length;a++)if(o[a]!==n.id&&i.links[o[a]]){var s=new D;s.links[i.links[o[a]]]=o[a],i.links[n]=i.links[n].apply(s)}k(e,O(i.links[n]),t)}else e.add_goal(r),t.success(r),S(e,t.string,t)}))}function T(e,r,t,i){var n=!0===r.term_expansion;if(null===i.value.body&&"?-/1"===i.value.head.indicator){n=!0;var a=new L(e.session);a.add_goal(i.value.head.args[0]),a.answer((function(t){H.type.is_error(t)?e.throw_warning(t.args[0]):!1!==t&&null!==t||e.throw_warning(H.warning.failed_goal(i.value.head.args[0],i.len)),b(e,r.string,r)}))}else if(null===i.value.body&&":-/1"===i.value.head.indicator){var s=e.run_directive(i.value.head.args[0],r);(n=n||!0===s)&&b(e,r.string,r)}else{var l=r.context_module,p=i.value.head.indicator;if(":/2"===i.value.head.indicator&&(l=i.value.head.args[0].id,p=i.value.head.args[1].indicator),t.hasOwnProperty(l)||(t[l]={}),!1!==r.reconsult&&!0!==t[l][p]&&!e.is_multifile_predicate(p)){var u=e.session.modules[l];"system"!==l&&u&&u.rules[p]&&(u.rules[p]=o(u.rules[p],(function(e){return e.dynamic})),u.update_indices_predicate(p)),t[l][p]=!0}var _=e.session.modules.user.rules["goal_expansion/2"];if(null!==i.value.body&&_&&_.length>0){n=!0,e.session.renamed_variables={};x(e,r,i,O(i.value.body))}else e.add_rule(i.value,r),n&&b(e,r.string,r)}return n}function S(e,r,t){var i={},n="function"==typeof t?t:function(){};t=void 0===t||"function"==typeof t?{}:t,i.success=void 0===t.success?n:t.success,i.error=void 0===t.error?n:t.error,i.tokenizer=void 0===t.tokenizer?null:t.tokenizer,i.current_token=void 0===t.current_token?0:t.current_token,i.string=r;var a=i.tokenizer,o=i.current_token;for(null===a&&(a=new g(e),i.tokenizer=a,a.new_text(r));;){var s=a.get_tokens(o);if(null===s)break;var l=v(e,s,0,e.__get_max_priority(),!1);if(0===l.type)return void i.error(new Y("throw",[l.value]));var p=l.len;if(o=l.len+1,i.current_token=o,!s[p]||"atom"!==s[p].name||"."!==s[p].raw){var u=s[p];return void i.error(new Y("throw",[H.error.syntax(u||s[p-1],u&&u.error?u.error:". or operator expected",!u)]))}l.value=O(l.value);var _=e.session.modules.user.rules["goal_expansion/2"];if(!e.__goal_expansion&&_&&_.length>0)return void k(e,l.value,i);e.add_goal(l.value),i.success(l.value)}}function A(e,r,t){var i;if(H.type.is_term(e)&&"!/0"===e.indicator)return{value:new Y(",",[e,new Y("=",[r,i=t.next_free_variable()])]),variable:i,error:!1};if(H.type.is_term(e)&&":/2"===e.indicator)return(a=A(e.args[1],r,t)).error?a:{value:new Y(":",[e.args[0],a.value]),variable:a.variable,error:!1};if(H.type.is_term(e)&&"\\+/1"===e.indicator)return(n=A(e.args[0],r,t)).error?n:(i=t.next_free_variable(),{value:new Y(",",[new Y(e.id,[n.value]),new Y("=",[r,i])]),variable:i,error:!1});if(!H.type.is_term(e)||",/2"!==e.indicator&&"->/2"!==e.indicator){var n,a;if(H.type.is_term(e)&&";/2"===e.indicator)return(n=A(e.args[0],r,t)).error?n:(a=A(e.args[1],r,t)).error?a:{value:new Y(",",[new Y(";",[n.value,a.value]),new Y("=",[n.variable,a.variable])]),variable:a.variable,error:!1};if(H.type.is_term(e)&&"{}/1"===e.indicator)return i=t.next_free_variable(),{value:new Y(",",[e.args[0],new Y("=",[r,i])]),variable:i,error:!1};if(H.type.is_empty_list(e))return{value:new Y("true",[]),variable:r,error:!1};if(H.type.is_list(e)){i=t.next_free_variable();for(var o,s=e;"./2"===s.indicator;)o=s,s=s.args[1];return H.type.is_variable(s)?{value:H.error.instantiation("DCG/0"),variable:r,error:!0}:H.type.is_empty_list(s)?(o.args[1]=i,{value:new Y("=",[r,e]),variable:i,error:!1}):{value:H.error.type("list",e,"DCG/0"),variable:r,error:!0}}return H.type.is_callable(e)?(i=t.next_free_variable(),{value:e=new Y(e.id,e.args.concat([r,i])),variable:i,error:!1}):{value:H.error.type("callable",e,"DCG/0"),variable:r,error:!0}}return(n=A(e.args[0],r,t)).error?n:(a=A(e.args[1],n.variable,t)).error?a:{value:new Y(e.id,[n.value,a.value]),variable:a.variable,error:!1}}function O(e){if(H.type.is_variable(e))return new Y("call",[e]);if(H.type.is_term(e)&&-1!==[",/2",";/2","->/2"].indexOf(e.indicator))return new Y(e.id,[O(e.args[0]),O(e.args[1])]);if(H.type.is_term(e)&&":/2"===e.indicator){var r=O(e.args[1]);return new Y(":",[e.args[0],r])}return e}function V(e,r){for(var t=r||new Y("[]",[]),i=e.length-1;i>=0;i--)t=new Y(".",[e[i],t]);return t}function I(e,r){for(var t=e.length-1;t>=0;t--)e[t]===r&&e.splice(t,1)}function P(e){for(var r={},t=[],i=0;i<e.length;i++)e[i]in r||(t.push(e[i]),r[e[i]]=!0);return t}function E(e){return function(r,t,i){var n,a=i.args[0],o=i.args.slice(1,e);if(H.type.is_term(a)&&":/2"===a.indicator){if(!H.type.is_atom(a.args[0]))return void r.throw_error(H.error.type("module",a.args[0],i.indicator));n=a.args[0],a=a.args[1]}if(H.type.is_variable(a))r.throw_error(H.error.instantiation(i.indicator));else if(H.type.is_callable(a)){var s=O(new Y(a.id,a.args.concat(o)));if(!H.type.is_callable(s))return void r.throw_error(H.error.type("callable",s,i.indicator));n&&(s=new Y(":",[n,s])),r.prepend([new $(t.goal.replace(s),t.substitution,t)])}else r.throw_error(H.error.type("callable",a,i.indicator))}}function R(e){for(var r=e.length-1;r>=0;r--)if("/"===e.charAt(r))return new Y("/",[new Y(e.substring(0,r)),new M(parseInt(e.substring(r+1)),!1)])}function F(e,r){return 0===r?e:Math.abs(F(r,e%r))}function X(e){this.id=e,this.ground=!1}function M(e,r){this.is_float=void 0!==r?r:Math.trunc(e)!==e,this.value=this.is_float?e:Math.trunc(e),this.index=this.value,this.ground=!0}g.prototype.set_last_tokens=function(e){return this.tokens=e},g.prototype.new_text=function(e){this.text=e,this.tokens=[]},g.prototype.get_tokens=function(e){var r,t,i=0,n=0,a=0,o=[];e?(i=(_=this.tokens[e-1]).len,r=function(e,r){return"on"===e.get_flag("char_conversion").id?r.replace(/./g,(function(r){return e.get_char_conversion(r)})):r}(this.thread,this.text.substr(_.len)),n=_.line,a=_.start):r=this.text;if(/^\s*$/.test(r))return null;for(;""!==r;){var s=[];if(t=!1,null===/^\n/.exec(r)){for(var l in h)if(h.hasOwnProperty(l)){var p=h[l].exec(r);p&&s.push({value:p[0],name:l,matches:p})}if(!s.length)return this.set_last_tokens([{value:r,matches:[],name:"lexical",line:n,start:a}]);var _;(_=u(s,(function(e,r){return e.value.length>=r.value.length?e:r}))).start=a,_.line=n,r=r.replace(_.value,""),a+=_.value.length,i+=_.value.length;var c=(_.value.match(/\n/g)||[]).length;switch(n+=c,c>0&&(a=_.value.length-_.value.lastIndexOf("\n")-1),_.line_count=n,_.line_position=a,_.name){case"atom":_.raw=_.value,"'"===_.value.charAt(0)&&(_.value=w(_.value.substring(1,_.value.length-1),"'"),null===_.value&&(_.name="lexical",_.value=_.raw,_.error="unknown_escape_sequence"));break;case"number":var d=_.value.substring(0,2);_.raw=_.value,_.float="0x"!==d&&"0'"!==d&&null!==_.value.match(/[.eE]/),_.value=f(_.value),_.blank=t,!_.float&&"true/0"===H.flag.bounded.value.indicator&&_.value>H.flag.max_integer.value.value&&(_.name="lexical",_.value=_.raw,_.error="int_overflow");break;case"string":var y=_.value.charAt(0);_.raw=_.value,_.value=w(_.value.substring(1,_.value.length-1),y),null===_.value&&(_.name="lexical",_.value=_.raw,_.error="unknown_escape_sequence");break;case"whitespace":var g=o[o.length-1];g&&(g.space=!0),t=!0;continue;case"r_bracket":o.length>0&&"l_bracket"===o[o.length-1].name&&((_=o.pop()).name="atom",_.value="{}",_.raw="{}",_.space=!1);break;case"r_brace":o.length>0&&"l_brace"===o[o.length-1].name&&((_=o.pop()).name="atom",_.value="[]",_.raw="[]",_.space=!1)}_.len=i,o.push(_),t=!1}else n++,a=0,i++,r=r.replace(/\n/,""),t=!0}var v=this.set_last_tokens(o);return 0===v.length?null:v};var N=0;function Y(e,r,t){N++,this.ref=t||N,this.id=e,this.args=r||[],this.indicator=e+"/"+this.args.length,this.index=this.indicator,this.ground=!0;for(var i=0;i<this.args.length;i++)if(this.args[i].hasOwnProperty("ground")&&!1===this.args[i].ground){this.ground=!1;break}}var C=0;function q(e,r,t,i,n,a){this.id=C++,this.stream=e,this.mode=r,this.alias=t,this.type=void 0!==i?i:"text",this.reposition=void 0===n||n,this.eof_action=void 0!==a?a:"eof_code",this.position="append"===this.mode?"end_of_stream":0,this.output="write"===this.mode||"append"===this.mode,this.input="read"===this.mode,this.line_position=0,this.line_count=1,this.char_count=0}function D(e,r){e=e||{},r=r||{},this.links=e,this.attrs=r}function $(e,r,t){r=r||new D,t=t||null,this.goal=e,this.substitution=r,this.parent=t}function z(e,r,t){this.head=e,this.body=r,this.dynamic=t||!1}function G(e){e="number"==typeof e&&e>0?e:null,this.rename=0,this.modules={},this.modules.user=new j("user",{},"all",{session:this,dependencies:["system"]}),this.modules.system=H.modules.system,this.rules=this.modules.user.rules,this.total_threads=0,this.renamed_variables={},this.public_predicates=this.modules.user.public_predicates,this.multifile_predicates=this.modules.user.multifile_predicates,this.limit=e,this.streams={user_input:new q(B?nodejs_user_input:tau_user_input,"read","user_input","text",!1,"reset"),user_output:new q(B?nodejs_user_output:tau_user_output,"append","user_output","text",!1,"reset"),user_error:new q(B?nodejs_user_error:tau_user_error,"append","user_error","text",!1,"reset")},this.file_system=B?nodejs_file_system:tau_file_system,this.standard_input=this.streams.user_input,this.standard_output=this.streams.user_output,this.standard_error=this.streams.user_error,this.current_input=this.streams.user_input,this.current_output=this.streams.user_output,this.working_directory="/",this.format_success=function(e){return e.substitution},this.format_error=function(e){return e.goal},this.flag={bounded:H.flag.bounded.value,max_integer:H.flag.max_integer.value,min_integer:H.flag.min_integer.value,integer_rounding_function:H.flag.integer_rounding_function.value,char_conversion:H.flag.char_conversion.value,debug:H.flag.debug.value,max_arity:H.flag.max_arity.value,unknown:H.flag.unknown.value,double_quotes:H.flag.double_quotes.value,occurs_check:H.flag.occurs_check.value,dialect:H.flag.dialect.value,version_data:H.flag.version_data.value,nodejs:H.flag.nodejs.value,argv:H.flag.argv.value},this.__loaded_modules=[],this.__char_conversion={},this.__operators={1200:{":-":["fx","xfx"],"--\x3e":["xfx"],"?-":["fx"]},1150:{meta_predicate:["fx"]},1100:{";":["xfy"]},1050:{"->":["xfy"],"*->":["xfy"]},1e3:{",":["xfy"]},900:{"\\+":["fy"]},700:{"=":["xfx"],"\\=":["xfx"],"==":["xfx"],"\\==":["xfx"],"@<":["xfx"],"@=<":["xfx"],"@>":["xfx"],"@>=":["xfx"],"=..":["xfx"],is:["xfx"],"=:=":["xfx"],"=\\=":["xfx"],"<":["xfx"],"=<":["xfx"],">":["xfx"],">=":["xfx"]},600:{":":["xfy"]},500:{"+":["yfx"],"-":["yfx"],"/\\":["yfx"],"\\/":["yfx"]},400:{"*":["yfx"],"/":["yfx"],"//":["yfx"],rem:["yfx"],mod:["yfx"],"<<":["yfx"],">>":["yfx"],div:["yfx"]},200:{"**":["xfx"],"^":["xfy"],"-":["fy"],"+":["fy"],"\\":["fy"]}},this.thread=new L(this)}function L(e){this.epoch=Date.now(),this.session=e,this.session.total_threads++,this.format_success=e.format_success,this.format_error=e.format_error,this.total_steps=0,this.cpu_time=0,this.points=[],this.debugger=!1,this.debugger_states=[],this.level=new Y("top_level"),this.current_limit=this.session.limit,this.has_limit=null!==this.session.limit,this.warnings=[],this.__calls=[],this.__goal_expansion=!1,this.__stacks={}}function j(e,r,t,i){if((i=void 0===i?{}:i).public_predicates=void 0===i.public_predicates?{}:i.public_predicates,i.multifile_predicates=void 0===i.multifile_predicates?{}:i.multifile_predicates,i.meta_predicates=void 0===i.meta_predicates?{}:i.meta_predicates,i.session=void 0===i.session?null:i.session,i.dependencies=void 0===i.dependencies?[]:i.dependencies,this.id=e,this.rules=r,this.indexed_clauses={},this.non_indexable_clauses={},this.public_predicates=i.public_predicates,this.multifile_predicates=i.multifile_predicates,this.meta_predicates=i.meta_predicates,this.src_predicates={},this.dependencies=i.dependencies,this.exports=t,this.is_library=null===i.session,this.modules={},i.session){i.session.modules[e]=this;for(var n=0;n<i.dependencies.length;n++){var a=i.dependencies[n];i.session.modules.hasOwnProperty(a)||(i.session.modules[a]=H.modules[a])}}else H.modules[e]=this;if("all"!==t)for(n=0;n<t.length;n++)this.public_predicates[t[n]]=i.public_predicates.hasOwnProperty(t[n])&&!0===i.public_predicates[t[n]];this.update_indices_clauses()}j.prototype.exports_predicate=function(r){return"all"===this.exports||-1!==e(this.exports,r)},j.prototype.is_public_predicate=function(e){return!this.public_predicates.hasOwnProperty(e)||!0===this.public_predicates[e]},j.prototype.is_multifile_predicate=function(e){return this.multifile_predicates.hasOwnProperty(e)&&!0===this.multifile_predicates[e]},j.prototype.is_meta_predicate=function(e){return this.meta_predicates.hasOwnProperty(e)?this.meta_predicates[e]:null},j.prototype.update_indices_clauses=function(){for(var e in this.indexed_clauses={},this.non_indexable_clauses={},this.rules)this.update_indices_predicate(e)},j.prototype.update_indices_predicate=function(e){if(this.indexed_clauses[e]={},this.non_indexable_clauses[e]=[],Array.isArray(this.rules[e]))for(var r=0;r<this.rules[e].length;r++){var t=this.rules[e][r];this.add_index_predicate(t)}},j.prototype.add_index_predicate=function(e){var r=e.head.indicator;if(i=e.head.args.length>0?e.head.args[0].index:void 0){if(this.indexed_clauses.hasOwnProperty(r)||(this.indexed_clauses[r]={}),!this.indexed_clauses[r].hasOwnProperty(i)&&(this.indexed_clauses[r][i]=[],this.non_indexable_clauses.hasOwnProperty(r)))for(var t=0;t<this.non_indexable_clauses[r].length;t++)this.indexed_clauses[r][i].push(this.non_indexable_clauses[r][t]);this.indexed_clauses[r][i].push(e)}else for(var i in this.non_indexable_clauses.hasOwnProperty(r)||(this.non_indexable_clauses[r]=[]),this.non_indexable_clauses[r].push(e),this.indexed_clauses[r])this.indexed_clauses[r][i].push(e)},X.prototype.unify=function(r,t){if(t&&-1!==e(r.variables(),this.id)&&!H.type.is_variable(r))return null;var i={};return i[this.id]=r,new D(i)},M.prototype.unify=function(e,r){return H.type.is_number(e)&&this.value===e.value&&this.is_float===e.is_float?new D:null},Y.prototype.unify=function(e,r){if(!H.type.is_term(e)&&void 0!==e.unify)return e.unify(this,r);if(H.type.is_term(e)&&this.indicator===e.indicator){for(var t=new D,i=0;i<this.args.length;i++){var n=H.unify(this.args[i].apply(t),e.args[i].apply(t),r);if(null===n)return null;for(var a in n.links)t.links[a]=n.links[a];t=t.apply(n)}return t}return null},q.prototype.unify=function(e,r){return H.type.is_stream(e)&&this.id===e.id?new D:null},q.prototype.compare=function(e){return this.id<e.id?-1:this.id===e.id?0:1},X.prototype.toString=function(e){if((e=void 0===e?{}:e).variable_names)for(var r=e.variable_names;H.type.is_term(r)&&"./2"===r.indicator;){var t=r.args[0];if(H.type.is_term(t)&&"=/2"===t.indicator&&H.type.is_variable(t.args[1])&&t.args[1].id===this.id&&H.type.is_atom(t.args[0]))return t.args[0].id;r=r.args[1]}return this.id},M.prototype.toString=function(r){var t=this.value.toString();return-1!==t.indexOf("e")?-1!==t.indexOf(".")?t:t.replace("e",".0e"):this.is_float&&-1===e(t,".")?this.value+".0":t},Y.prototype.toString=function(r,t,i){(r=r||{}).quoted=void 0!==r.quoted&&r.quoted,r.ignore_ops=void 0!==r.ignore_ops&&r.ignore_ops,r.numbervars=void 0!==r.numbervars&&r.numbervars,r.variable_names=void 0!==r.variable_names&&r.variable_names,t=void 0===t?{priority:1200,class:"",indicator:""}:t,i=void 0===i?"":i;var n={priority:999,class:"",indicator:""};if(r.numbervars&&"$VAR/1"===this.indicator&&H.type.is_integer(this.args[0])&&this.args[0].value>=0){var o=this.args[0].value,s=Math.floor(o/26);return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[o%26]+(0!==s?s:"")}switch(this.indicator){case"[]/0":case"{}/0":case"!/0":return this.id;case"{}/1":return!1===r.ignore_ops?"{"+this.args[0].toString(r)+"}":"{}("+this.args[0].toString(r)+")";case"./2":if(!1===r.ignore_ops){for(var l="["+this.args[0].toString(r,n),p=this.args[1];"./2"===p.indicator;)l+=","+p.args[0].toString(r,n),p=p.args[1];return"[]/0"!==p.indicator&&(l+="|"+p.toString(r,n)),l+="]"}default:var u=this.id,_=r.session?r.session.lookup_operator(this.id,this.args.length):null;if(void 0===r.session||r.ignore_ops||null===_)return r.quoted&&(!/^(!|[a-z][0-9a-zA-Z_]*|[#\$\&\*\+\-\.\/\:\<\=\>\?\@\^\~\\]+)$/.test(u)&&"{}"!==u&&"[]"!==u||-1!==e([".",",",";"],u)||"/*"===u.substring(0,2))&&(u="'"+function(e){for(var r="",t=0;t<e.length;t++)switch(e.charAt(t)){case"'":r+="\\'";break;case"\\":r+="\\\\";break;case"\b":r+="\\b";break;case"\f":r+="\\f";break;case"\n":r+="\\n";break;case"\r":r+="\\r";break;case"\t":r+="\\t";break;case"\v":r+="\\v";break;default:r+=e.charAt(t)}return r}(u)+"'"),0===this.args.length&&y(this.id)&&""!==t.indicator?"("+u+")":u+(this.args.length>0?"("+a(this.args,(function(e){return e.toString(r,n)})).join(",")+")":"");var c=parseInt(_.priority),d=parseInt(t.priority),w=c>d||c===d&&("xfx"===_.class||"xfy"===_.class&&this.indicator!==t.indicator||"yfx"===_.class&&this.indicator!==t.indicator||this.indicator===t.indicator&&"yfx"===_.class&&"right"===i||this.indicator===t.indicator&&"xfy"===_.class&&"left"===i||this.indicator===t.indicator&&"xf"===_.class&&"left"===i||this.indicator===t.indicator&&"fx"===_.class&&"right"===i);_.indicator=this.indicator;var f=w?"(":"",h=w?")":"",g=!y(this.id)&&","!==this.id&&";"!==this.id||2===_.class.length||3===_.class.length&&H.type.is_number(this.args[1])&&this.args[1].value<0?" ":"";return 0===this.args.length?f+this.id+h:-1!==["fy","fx"].indexOf(_.class)?f+u+g+this.args[0].toString(r,_,"right")+h:-1!==["yf","xf"].indexOf(_.class)?f+this.args[0].toString(r,_,"left")+g+u+h:f+this.args[0].toString(r,_,"left")+g+this.id+g+this.args[1].toString(r,_,"right")+h}},q.prototype.toString=function(e){return"<stream>("+this.id+")"},D.prototype.toString=function(e){var r="{";for(var t in this.links)this.links.hasOwnProperty(t)&&("{"!==r&&(r+=", "),r+=t+"/"+this.links[t].toString(e));return r+="}"},$.prototype.toString=function(e){return null===this.goal?"<"+this.substitution.toString(e)+">":"<"+this.goal.toString(e)+", "+this.substitution.toString(e)+">"},z.prototype.toString=function(e){return this.body?this.head.toString(e,1200,"left")+" :- "+this.body.toString(e,1200,"right")+".":this.head.toString(e)+"."},G.prototype.toString=function(e){var r="";for(var t in this.modules)this.modules.hasOwnProperty(t)&&this.modules[t].is_library&&(r+=":- use_module(library("+this.modules[t]+")).\n");for(var n in r+="\n",this.modules.user.rules)if(this.modules.user.rules.hasOwnProperty(n))for(i=0;i<this.modules.user.rules[n].length;i++)r+=this.modules.user.rules[n][i].toString(e),r+="\n";return r},X.prototype.clone=function(){return new X(this.id)},M.prototype.clone=function(){return new M(this.value,this.is_float)},Y.prototype.clone=function(){var e=new Y(this.id,a(this.args,(function(e){return e.clone()})));return this.definition_module&&(e.definition_module=this.definition_module),e},q.prototype.clone=function(){return new q(this.stream,this.mode,this.alias,this.type,this.reposition,this.eof_action)},D.prototype.clone=function(){var e={},r={};for(var t in this.links)this.links.hasOwnProperty(t)&&(e[t]=this.links[t].clone());for(var i in this.attrs)if(this.attrs.hasOwnProperty(r))for(var n in r[i]={},this.attrs[i])this.attrs[i].hasOwnProperty(n)&&(r[i][n]=this.attrs[i][n].clone());return new D(e,r)},$.prototype.clone=function(){return new $(this.goal.clone(),this.substitution.clone(),this.parent)},z.prototype.clone=function(){return new z(this.head.clone(),null!==this.body?this.body.clone():null)},X.prototype.equals=function(e){return H.type.is_variable(e)&&this.id===e.id},M.prototype.equals=function(e){return H.type.is_number(e)&&this.value===e.value&&this.is_float===e.is_float},Y.prototype.equals=function(e){if(!H.type.is_term(e)||this.indicator!==e.indicator)return!1;for(var r=0;r<this.args.length;r++)if(!this.args[r].equals(e.args[r]))return!1;return!0},q.prototype.equals=function(e){return H.type.is_stream(e)&&this.id===e.id},D.prototype.equals=function(e){var r;if(!H.type.is_substitution(e))return!1;for(r in this.links)if(this.links.hasOwnProperty(r)&&(!e.links[r]||!this.links[r].equals(e.links[r])))return!1;for(r in e.links)if(e.links.hasOwnProperty(r)&&!this.links[r])return!1;return!0},$.prototype.equals=function(e){return H.type.is_state(e)&&this.goal.equals(e.goal)&&this.substitution.equals(e.substitution)&&this.parent===e.parent},z.prototype.equals=function(e){return H.type.is_rule(e)&&this.head.equals(e.head)&&(null===this.body&&null===e.body||null!==this.body&&this.body.equals(e.body))},X.prototype.rename=function(e){return e.get_free_variable(this)},M.prototype.rename=function(e){return this},Y.prototype.rename=function(e){if(this.ground)return new Y(this.id,this.args);if("./2"===this.indicator){for(var r=[],t=this;"./2"===t.indicator&&!t.ground;){var i=t.args[0].rename(e);r.push(i),t=t.args[1]}for(var n=t.rename(e),a=r.length-1;a>=0;a--)n=new Y(".",[r[a],n]);return n}var o=[];for(a=0;a<this.args.length;a++){i=this.args[a].rename(e);o.push(i)}return new Y(this.id,o)},q.prototype.rename=function(e){return this},z.prototype.rename=function(e){return new z(this.head.rename(e),null!==this.body?this.body.rename(e):null)},X.prototype.is_rename=function(e,r){return r=r||{},!(!H.type.is_variable(e)||r.hasOwnProperty(this.id)&&r[this.id]!==e.id||r.hasOwnProperty(e.id)&&r[e.id]!==this.id)&&(r[this.id]=e.id,r[e.id]=this.id,!0)},M.prototype.is_rename=function(e,r){return this.equals(e)},Y.prototype.is_rename=function(e,r){if(r=r||{},!H.type.is_term(e)||this.indicator!==e.indicator)return!1;for(var t=0;t<this.args.length;t++)if(!H.is_rename(this.args[t],e.args[t],r))return!1;return!0},q.prototype.is_rename=function(e,r){return this.equals(e)},X.prototype.variables=function(){return[this.id]},M.prototype.variables=function(){return[]},Y.prototype.variables=function(){return this.ground?[]:[].concat.apply([],a(this.args,(function(e){return e.variables()})))},q.prototype.variables=function(){return[]},z.prototype.variables=function(){return null===this.body?this.head.variables():this.head.variables().concat(this.body.variables())},X.prototype.apply=function(e){return e.lookup(this.id)?e.lookup(this.id):this},M.prototype.apply=function(e){return this},Y.prototype.apply=function(e){if(this.ground)return this;if("./2"===this.indicator){for(var r=[],t=this;"./2"===t.indicator&&!t.ground;){var i=t.args[0].apply(e);r.push(i),t=t.args[1]}for(var n=t.apply(e),a=r.length-1;a>=0;a--)n=new Y(".",[r[a],n]);return n}var o=[];for(a=0;a<this.args.length;a++){i=this.args[a].apply(e);o.push(i)}return new Y(this.id,o,this.ref)},q.prototype.apply=function(e){return this},z.prototype.apply=function(e){return new z(this.head.apply(e),null!==this.body?this.body.apply(e):null)},D.prototype.apply=function(e){var r,t,i,n={},a={};for(r in this.links)this.links.hasOwnProperty(r)&&(n[r]=this.links[r].apply(e));for(t in this.attrs)if(this.attrs.hasOwnProperty(t))for(i in a[t]={},this.attrs[t])this.attrs[t].hasOwnProperty(i)&&(a[t][i]=this.attrs[t][i].apply(e));return new D(n,a)},Y.prototype.select=function(){for(var e=this;H.type.is_term(e)&&",/2"===e.indicator;)e=e.args[0];return e},Y.prototype.replace=function(e){return",/2"===this.indicator?",/2"===this.args[0].indicator?new Y(",",[this.args[0].replace(e),this.args[1]]):null===e?this.args[1]:new Y(",",[e,this.args[1]]):e},Y.prototype.search=function(e){if(this==e||this.ref===e.ref)return!0;for(var r=0;r<this.args.length;r++)if(H.type.is_term(this.args[r])&&this.args[r].search(e))return!0;return!1},G.prototype.push_global_stack=function(e,r){return this.thread.push_global_stack(e,r)},L.prototype.push_global_stack=function(e,r){this.__stacks.hasOwnProperty(e)||(this.__stacks[e]=[]),this.__stacks[e].push(r)},G.prototype.flush_global_stack=function(e,r){return this.thread.push_global_stack(e,r)},L.prototype.flush_global_stack=function(e,r){var t=r||new Y("[]",[]);if(this.__stacks.hasOwnProperty(e)){for(;this.__stacks[e].length>0;)t=new Y(".",[this.__stacks[e].pop(),t]);delete this.__stacks[e]}return t},G.prototype.setMaxInferences=function(e){this.limit="number"==typeof e&&e>0?e:null},L.prototype.setMaxInferences=function(e){this.session.setMaxInferences(e),this.current_limit=this.session.limit,this.has_limit=null!==this.session.limit},G.prototype.format_answer=function(e,r){return this.thread.format_answer(e,r)},L.prototype.format_answer=function(e,r){return H.format_answer(e,this,r)},G.prototype.get_current_input=function(){return this.current_input},L.prototype.get_current_input=function(){return this.session.get_current_input()},G.prototype.get_current_output=function(){return this.current_output},L.prototype.get_current_output=function(){return this.session.get_current_output()},G.prototype.set_current_input=function(e){this.current_input=e},L.prototype.set_current_input=function(e){return this.session.set_current_input(e)},G.prototype.set_current_output=function(e){this.current_output=e},L.prototype.set_current_output=function(e){return this.session.set_current_output(e)},G.prototype.get_stream_by_alias=function(e){return this.streams[e]},L.prototype.get_stream_by_alias=function(e){return this.session.get_stream_by_alias(e)},G.prototype.file_system_open=function(e,r,t){return"false/0"===this.get_flag("nodejs").indicator&&(e=this.absolute_file_name(e)),this.file_system.open(e,r,t)},L.prototype.file_system_open=function(e,r,t){return this.session.file_system_open(e,r,t)},G.prototype.absolute_file_name=function(e){var r;if("true/0"===this.get_flag("nodejs").indicator){var t=require("path");for(var i in r=e,process.env)process.env.hasOwnProperty(i)&&(r=r.replace(new RegExp("\\$"+i,"g"),process.env[i]));return t.resolve(r)}for(var n=this.working_directory,a=(r=(r="/"===e[0]?e:n+("/"===n[n.length-1]?e:"/"+e)).replace(/\/\.\//g,"/")).split("/"),o=[],s=0;s<a.length;s++)".."!==a[s]?o.push(a[s]):0!==o.length&&o.pop();return r=o.join("/").replace(/\/\.$/,"/")},L.prototype.absolute_file_name=function(e,r){return this.session.absolute_file_name(e,r)},G.prototype.get_char_conversion=function(e){return this.__char_conversion[e]||e},L.prototype.get_char_conversion=function(e){return this.session.get_char_conversion(e)},G.prototype.parse=function(e){return this.thread.parse(e)},L.prototype.parse=function(e){var r=new g(this);r.new_text(e);var t=r.get_tokens();if(null===t)return!1;var i=v(this,t,0,this.__get_max_priority(),!1);return i.len===t.length&&{value:i.value,expr:i,tokens:t}},G.prototype.get_flag=function(e){return this.flag[e]},L.prototype.get_flag=function(e){return this.session.get_flag(e)},G.prototype.add_rule=function(e,r){return this.thread.add_rule(e,r)},L.prototype.add_rule=function(e,r){var t,i;if((r=r||{}).from=r.from?r.from:"$tau-js",H.type.is_term(e.head)&&":/2"===e.head.indicator){if(!H.type.is_atom(e.head.args[0]))return void this.throw_warning(H.error.type("module",e.head.args[0],"top_level/0"));t=e.head.args[0].id,e.head=e.head.args[1]}return t?(i=this.session.modules[t],H.type.is_module(i)||(i=new j(t,{},"all",{session:this.session}),this.session.modules[t]=i)):i=this.session.modules[r.context_module],i.src_predicates[e.head.indicator]=r.from,i.rules.hasOwnProperty(e.head.indicator)||(i.rules[e.head.indicator]=[]),i.rules[e.head.indicator].push(e),i.public_predicates.hasOwnProperty(e.head.indicator)||(i.public_predicates[e.head.indicator]=!1),i.add_index_predicate(e),!0},G.prototype.run_directive=function(e,r){return this.thread.run_directive(e,r)},L.prototype.run_directive=function(e,r){return!!H.type.is_directive(e)&&(H.directive[e.indicator]?H.directive[e.indicator](this,e,r):H.directive[e.id+"/*"](this,e,r))},G.prototype.__get_max_priority=function(){return"1200"},L.prototype.__get_max_priority=function(){return this.session.__get_max_priority()},G.prototype.__get_next_priority=function(e){var r=0;for(var t in e=parseInt(e),this.__operators)if(this.__operators.hasOwnProperty(t)){var i=parseInt(t);i>r&&i<e&&(r=i)}return r.toString()},L.prototype.__get_next_priority=function(e){return this.session.__get_next_priority(e)},G.prototype.__lookup_operator_classes=function(e,r){return this.__operators.hasOwnProperty(e)&&this.__operators[e][r]instanceof Array&&this.__operators[e][r]||!1},L.prototype.__lookup_operator_classes=function(e,r){return this.session.__lookup_operator_classes(e,r)},G.prototype.lookup_operator=function(e,r){for(var t in this.__operators)if(this.__operators[t][e])for(var i=0;i<this.__operators[t][e].length;i++)if(this.__operators[t][e][i].length===r+1)return{priority:t,class:this.__operators[t][e][i]};return null},L.prototype.lookup_operator=function(e,r){return this.session.lookup_operator(e,r)},G.prototype.throw_warning=function(e){this.thread.throw_warning(e)},L.prototype.throw_warning=function(e){this.warnings.push(e)},G.prototype.get_warnings=function(){return this.thread.get_warnings()},L.prototype.get_warnings=function(){return this.warnings},G.prototype.add_goal=function(e,r){this.thread.add_goal(e,r)},L.prototype.add_goal=function(e,r,t){t=t||null,!0===r&&(this.points=[]);for(var i=e.variables(),n={},a=0;a<i.length;a++)n[i[a]]=new X(i[a]);this.points.push(new $(e,new D(n),t))},G.prototype.consult=function(e,r){return this.thread.consult(e,r)},L.prototype.consult=function(e,r){var t="",i=!1,n={},a="function"==typeof r?r:function(){};if(r=void 0===r||"function"==typeof r?{}:r,n.context_module=void 0===r.context_module?"user":r.context_module,n.text=void 0===r.text||r.text,n.html=void 0===r.html||r.html,n.url=void 0===r.url||r.url,n.file=void 0===r.file||r.file,n.script=void 0===r.script||r.script,n.success=void 0===r.success?a:r.success,n.error=void 0===r.error?a:r.error,"string"==typeof e){if(t=e,n.script&&"false/0"===this.get_flag("nodejs").indicator&&""!=e&&document.getElementById(t)){var o=document.getElementById(t),s=o.getAttribute("type");null!==s&&"text/prolog"===s.replace(/ /g,"").toLowerCase()&&(t=o.text,i=!0)}if(!i&&n.file&&"true/0"===this.get_flag("nodejs").indicator){var l=require("fs"),p=this;return void l.readFile(e,(function(r,t){r?(n.file=!1,p.consult(e,n)):b(p,t.toString(),n)}))}if(!i&&"false/0"===this.get_flag("nodejs").indicator&&n.url&&""!==e&&!/\s/.test(e))try{var u=new XMLHttpRequest;p=this;return u.onreadystatechange=function(){4==this.readyState&&(200==this.status?(t=u.responseText,i=!0,b(p,t,n)):(n.url=!1,p.consult(e,n)))},u.open("GET",e,!0),void u.send()}catch(e){return void n.error(e)}!i&&n.text&&(i=!0)}else if(n.html&&e.nodeName)switch(e.nodeName.toLowerCase()){case"input":case"textarea":t=e.value,i=!0;break;default:t=e.innerHTML,i=!0}else n.error(H.error.existence("source_sink",new Y(t),"top_level/0"));this.warnings=[],b(this,t,n)},G.prototype.query=function(e,r){return this.thread.query(e,r)},L.prototype.query=function(e,r){return this.points=[],this.debugger_states=[],this.level=new Y("top_level"),S(this,e,r)},G.prototype.head_point=function(){return this.thread.head_point()},L.prototype.head_point=function(){return this.points[this.points.length-1]},G.prototype.get_free_variable=function(e){return this.thread.get_free_variable(e)},L.prototype.get_free_variable=function(r){var t=[];if("_"===r.id||void 0===this.session.renamed_variables[r.id]){for(this.session.rename++,this.current_point&&(t=this.current_point.substitution.domain());-1!==e(t,H.format_variable(this.session.rename,r.id));)this.session.rename++;if("_"===r.id)return new X(H.format_variable(this.session.rename,r.id));this.session.renamed_variables[r.id]=H.format_variable(this.session.rename,r.id)}return new X(this.session.renamed_variables[r.id])},G.prototype.next_free_variable=function(){return this.thread.next_free_variable()},L.prototype.next_free_variable=function(){this.session.rename++;var r=[];for(this.current_point&&(r=this.current_point.substitution.domain());-1!==e(r,H.format_variable(this.session.rename));)this.session.rename++;return new X(H.format_variable(this.session.rename))},G.prototype.is_public_predicate=function(e,r){return r=void 0===r?"user":r,H.type.is_module(this.modules[r])&&this.modules[r].is_public_predicate(e)},L.prototype.is_public_predicate=function(e,r){return this.session.is_public_predicate(e,r)},G.prototype.is_multifile_predicate=function(e,r){return r=void 0===r?"user":r,H.type.is_module(this.modules[r])&&this.modules[r].is_multifile_predicate(e)},L.prototype.is_multifile_predicate=function(e,r){return this.session.is_multifile_predicate(e,r)},G.prototype.is_meta_predicate=function(e,r){return r=void 0===r?"user":r,H.type.is_module(this.modules[r])?this.modules[r].is_meta_predicate(e):null},L.prototype.is_meta_predicate=function(e,r){return this.session.is_meta_predicate(e,r)},G.prototype.prepend=function(e){return this.thread.prepend(e)},L.prototype.prepend=function(e){for(var r=e.length-1;r>=0;r--)this.points.push(e[r])},G.prototype.success=function(e,r){return this.thread.success(e,r)},L.prototype.success=function(e,r){r=void 0===r?e:r;this.prepend([new $(e.goal.replace(null),e.substitution,r)])},G.prototype.throw_error=function(e){return this.thread.throw_error(e)},L.prototype.throw_error=function(e){H.type.is_variable(e)&&(e=H.error.instantiation(this.level.indicator));var r=new $(new Y("throw",[e]),new D,null);r.error=!0,this.prepend([r])},G.prototype.lookup_module=function(e,r){return this.thread.lookup_module(e,r)},L.prototype.lookup_module=function(e,r){var t=this.session.modules[r];if(H.type.is_module(t)||(t=this.session.modules.user),t.rules.hasOwnProperty(e.indicator)&&(t.exports_predicate(e.indicator)||t.rules.hasOwnProperty(this.level.indicator)||r===t.id))return t;for(var i in t.modules.system=H.modules.system,t.modules.user=this.session.modules.user,t.modules){if(this.session.modules.hasOwnProperty(i))if((t=this.session.modules[i]).rules.hasOwnProperty(e.indicator)&&(t.exports_predicate(e.indicator)||t.rules.hasOwnProperty(this.level.indicator)||r===t.id))return t}return null},G.prototype.expand_meta_predicate=function(e,r,t){return this.thread.expand_meta_predicate(e,r,t)},L.prototype.expand_meta_predicate=function(r,t,i){var n=this.session.modules[t];if(n){var a=n.is_meta_predicate(r.indicator);if(a)for(var o=0;o<a.args.length;o++)if(H.type.is_integer(a.args[o])||H.type.is_atom(a.args[o])&&-1!==e([":"],a.args[o].id))H.type.is_term(r.args[o])&&":/2"===r.args[o].indicator||(r.args[o]=new Y(":",[new Y(i),r.args[o]]));else if(H.type.is_atom(a.args[o])&&"^"===a.args[o].id){for(var s=r,l=o,p=r.args[o];H.type.is_term(p)&&"^/2"===p.indicator;)s=p,l=1,p=p.args[1];H.type.is_term(p)&&":/2"===p.indicator||(s.args[l]=new Y(":",[new Y(i),p]))}}},G.prototype.step=function(){return this.thread.step()},L.prototype.step=function(){if(0!==this.points.length){var e=!1,r=this.points.pop();this.current_point=r,this.debugger&&this.debugger_states.push(r);var t=H.type.is_term(r.goal)?r.goal.select():r.goal;if(H.type.is_term(t)&&(":/2"!==t.indicator||H.type.is_term(t.args[1]))){var i=null,n=[];if(null!==t){this.total_steps++;for(var a=r;null!==a.parent&&a.parent.goal.search(t);)a=a.parent;if(null===a.parent?this.level=new Y("top_level"):(this.level=a.parent.goal.select(),":/2"===this.level.indicator&&(this.level=this.level.args[1])),H.type.is_term(t)&&":/2"===t.indicator){if(i=t.args[0],t=t.args[1],!H.type.is_atom(i))return void this.throw_error(H.error.type("module",i,this.level.indicator));i=i.id}else i=this.level.definition_module?this.level.definition_module:"user";if(t.context_module=i,",/2"===t.indicator)return void this.prepend([new $(r.goal.replace(new Y(",",[new Y(":",[new Y(i),t.args[0]]),new Y(":",[new Y(i),t.args[1]])])),r.substitution,r)]);this.__call_indicator=t.indicator;var o=this.lookup_module(t,i);t.definition_module=H.type.is_module(o)?o.id:"user",this.expand_meta_predicate(t,t.definition_module,i);var s=null;if(null===(s=o&&t.args.length>0&&t.args[0].index&&o.indexed_clauses.hasOwnProperty(t.indicator)&&o.indexed_clauses[t.indicator].hasOwnProperty(t.args[0].index)?o.indexed_clauses[t.indicator][t.args[0].index]:null===o?null:o.rules[t.indicator]))this.session.modules.user.rules.hasOwnProperty(t.indicator)||("error"===this.get_flag("unknown").id?this.throw_error(H.error.existence("procedure",t.indicator,this.level.indicator)):"warning"===this.get_flag("unknown").id&&this.throw_warning("unknown procedure "+t.indicator+" (from "+this.level.indicator+")"));else if(s instanceof Function)e=s(this,r,t);else{this.__goal_expansion&&"goal_expansion/2"===t.indicator&&(s=s.concat(H.builtin.rules["goal_expansion/2"]));for(var l=0;l<s.length;l++){this.session.renamed_variables={};var p=s[l].rename(this),u="true/0"===this.get_flag("occurs_check").indicator,_=H.unify(t,p.head,u);if(null!==_){var c=new $;c.goal=r.goal.replace(p.body),null!==c.goal&&(c.goal=c.goal.apply(_)),c.substitution=r.substitution.apply(_),c.parent=r,n.push(c)}}this.prepend(n)}}}else{var d=H.type.is_term(t)&&":/2"===t.indicator?t.args[1]:t;H.type.is_variable(d)?this.throw_error(H.error.instantiation(this.level.indicator)):this.throw_error(H.error.type("callable",d,this.level.indicator))}return e}},G.prototype.answer=function(e){return this.thread.answer(e)},L.prototype.answer=function(e){var r={};"function"==typeof(e=e||function(){})?r={success:e,error:e,fail:e,limit:e}:(r.success=void 0===e.success?function(){}:e.success,r.error=void 0===e.error?function(){}:e.error,r.fail=void 0===e.fail?function(){}:e.fail,r.limit=void 0===e.limit?function(){}:e.limit),this.__calls.push(r),this.__calls.length>1||this.again()},G.prototype.answers=function(e,r,t){return this.thread.answers(e,r,t)},L.prototype.answers=function(e,r,t){var i=void 0===r?1e3:r,n=this;i<=0?t&&t():this.answer((function(r){e(r),!1!==r?setTimeout((function(){n.answers(e,i-1,t)}),0):t&&t()}))},G.prototype.again=function(e){return this.thread.again(e)},L.prototype.again=function(e){for(;this.__calls.length>0;){for(this.warnings=[],!1!==e&&(this.current_limit=this.session.limit);(!this.has_limit||this.current_limit>0)&&this.points.length>0&&null!==this.head_point().goal&&!H.type.is_error_state(this.head_point());){this.has_limit&&this.current_limit--;var r=Date.now(),t=this.step(),i=Date.now();if(this.cpu_time+=i-r,!0===t)return}var n=this.__calls.shift();if(this.has_limit&&this.current_limit<=0)!function(e){setTimeout((function(){e.limit(null)}),0)}(n);else if(0===this.points.length)!function(e){setTimeout((function(){e.fail(!1)}),0)}(n);else if(H.type.is_error(this.head_point().goal)){var a=this.format_error(this.points.pop());this.points=[],function(e,r){setTimeout((function(){r.error(e)}),0)}(a,n)}else{this.debugger&&this.debugger_states.push(this.head_point()),function(e,r){setTimeout((function(){r.success(e)}),0)}(this.format_success(this.points.pop()),n)}}},G.prototype.unfold=function(r){if(null===r.body)return!1;var t=r.head,i=r.body,n=i.select(),a=new L(this),o=[];a.add_goal(n),a.step();for(var s=a.points.length-1;s>=0;s--){var l=a.points[s],p=t.apply(l.substitution),u=i.replace(l.goal);null!==u&&(u=u.apply(l.substitution)),o.push(new z(p,u))}var _=this.modules.user.rules[t.indicator],c=e(_,r);return o.length>0&&-1!==c&&(_.splice.apply(_,[c,1].concat(o)),!0)},L.prototype.unfold=function(e){return this.session.unfold(e)},X.prototype.interpret=function(e){return H.error.instantiation(e.level.indicator)},M.prototype.interpret=function(e){return this},Y.prototype.interpret=function(e){return H.type.is_unitary_list(this)?this.args[0].interpret(e):H.operate(e,this)},X.prototype.compare=function(e){return this.id<e.id?-1:this.id>e.id?1:0},M.prototype.compare=function(e){return this.value===e.value&&this.is_float===e.is_float?0:this.value<e.value||this.value===e.value&&this.is_float&&!e.is_float?-1:this.value>e.value?1:void 0},Y.prototype.compare=function(e){if(this.args.length<e.args.length||this.args.length===e.args.length&&this.id<e.id)return-1;if(this.args.length>e.args.length||this.args.length===e.args.length&&this.id>e.id)return 1;for(var r=0;r<this.args.length;r++){var t=H.compare(this.args[r],e.args[r]);if(0!==t)return t}return 0},D.prototype.lookup=function(e){return this.links[e]?this.links[e]:null},D.prototype.filter=function(e){var r={};for(var t in this.links)if(this.links.hasOwnProperty(t)){var i=this.links[t];e(t,i)&&(r[t]=i)}return new D(r,this.attrs)},D.prototype.exclude=function(r){var t={};for(var i in this.links)this.links.hasOwnProperty(i)&&-1===e(r,i)&&(t[i]=this.links[i]);return new D(t,this.attrs)},D.prototype.add=function(e,r){this.links[e]=r},D.prototype.domain=function(e){var r=!0===e?function(e){return e}:function(e){return new X(e)},t=[];for(var i in this.links)t.push(r(i));return t},D.prototype.get_attribute=function(e,r){if(this.attrs[e])return this.attrs[e][r]},D.prototype.set_attribute=function(e,r,t){var i=new D(this.links);for(var n in this.attrs)if(n===e)for(var a in i.attrs[n]={},this.attrs[n])i.attrs[n][a]=this.attrs[n][a];else i.attrs[n]=this.attrs[n];return i.attrs[e]||(i.attrs[e]={}),i.attrs[e][r]=t,i},D.prototype.has_attributes=function(e){return this.attrs[e]&&this.attrs[e]!=={}},X.prototype.compile=function(){return'new pl.type.Var("'+this.id.toString()+'")'},M.prototype.compile=function(){return"new pl.type.Num("+this.value.toString()+", "+this.is_float.toString()+")"},Y.prototype.compile=function(){return'new pl.type.Term("'+this.id.replace(/"/g,'\\"')+'", ['+a(this.args,(function(e){return e.compile()}))+"])"},z.prototype.compile=function(){return"new pl.type.Rule("+this.head.compile()+", "+(null===this.body?"null":this.body.compile())+")"},G.prototype.compile=function(){var e,r,t=[];for(var i in this.modules.user.rules)if(this.modules.user.rules.hasOwnProperty(i)){var n=this.modules.user.rules[i];r=[],e='"'+i+'": [';for(var a=0;a<n.length;a++)r.push(n[a].compile());e+=r.join(),e+="]",t.push(e)}return"{"+t.join()+"};"},j.prototype.compile=function(){var e=0,r=0,t="var pl;\n";for(var i in t+="(function(pl) {\n",t+='\tvar name = "'+this.id+'";\n',t+="\tvar predicates = function() {\n",t+="\t\treturn {\n",this.rules){if(e>0&&(t+=",\n"),t+='\t\t\t"'+i+'": ',"function"==typeof this.rules[i])t+=this.rules[i];else{t+="[\n";for(var n=0;n<this.rules[i].length;n++)t+="\t\t\t\t"+this.rules[i][n].compile(),n<this.rules[i].length-1&&(t+=","),t+="\n";t+="\t\t\t]"}e++}t+="\n\t\t};\n",t+="\t};\n",t+="\tvar exports = [";for(n=0;n<this.exports.length;n++)n>0&&(t+=", "),t+='"'+this.exports[n]+'"';for(var i in t+="];\n",t+="\tvar options = function() {\n",t+="\t\treturn {\n",t+="\t\t\tdependencies: [",this.modules)r>0&&(t+=", "),t+='"'+i+'"',r++;return t+="]\n",t+="\t\t};\n",t+="};\n",t+="\tif(typeof module !== 'undefined') {\n",t+="\t\tmodule.exports = function(p) {\n",t+="\t\t\tpl = p;\n",t+="\t\t\tnew pl.type.Module(name, predicates(), exports, options());\n",t+="\t\t};\n",t+="\t} else {\n",t+="\t\tnew pl.type.Module(name, predicates(), exports, options());\n",t+="\t}\n",t+="})(pl);\n"},X.prototype.toJavaScript=function(){return this.toString()},M.prototype.toJavaScript=function(){return this.value},Y.prototype.toJavaScript=function(e){if(0===this.args.length&&"[]/0"!==this.indicator)return this.toString(e);if(H.type.is_list(this)){for(var r,t=!0,i=[],n={},a=this;"./2"===a.indicator;)r=a.args[0].toJavaScript(e),i.push(r),(t=t&&H.type.is_term(a.args[0])&&"-/2"===a.args[0].indicator&&H.type.is_atom(a.args[0].args[0]))&&(n[a.args[0].args[0].id]=a.args[0].args[1].toJavaScript(e)),a=a.args[1];if("[]/0"===a.indicator)return t&&i.length>0?n:i}return this.toString(e)},z.prototype.singleton_variables=function(e){e=e||!1;var r=this.head.variables(),t={},i=[];null!==this.body&&(r=r.concat(this.body.variables()));for(var n=0;n<r.length;n++)void 0===t[r[n]]&&(t[r[n]]=0),t[r[n]]++;for(var a in t)if(t.hasOwnProperty(a)&&1===t[a]){var o=s(a,1);if((!e||"_"===a)&&("_"===a||"_"===a[0]&&(95===o||o>=65&&o<=90)))continue;i.push(a)}return i};var B="undefined"!=typeof process&&!process.browser,U=B?V(a(process.argv.slice(1),(function(e){return new Y(e)}))):new Y("[]",[]),H={__env:B?global:window,modules:{},version:r,parser:{tokenizer:g,expression:v},utils:{str_indicator:R,codePointAt:s,fromCodePoint:l,stringLength:p},statistics:{getCountTerms:function(){return N}},fromJavaScript:{test:{boolean:function(e,r){return!0===e||!1===e},number:function(e,r){return"number"==typeof e},string:function(e,r){return"string"==typeof e},list:function(e,r){return e instanceof Array},variable:function(e,r){return void 0===e},object:function(e,r){return(r=void 0!==r&&r)&&!(e instanceof Array)&&"object"==typeof e},any:function(e,r){return!0}},conversion:{boolean:function(e,r){return new Y(e?"true":"false",[])},number:function(e,r){return new M(e,e%1!=0)},string:function(e,r){return new Y(e,[])},list:function(e,r){r=void 0!==r&&r;for(var t,i=[],n=0;n<e.length;n++){if(void 0===(t=H.fromJavaScript.apply(e[n],r)))return;i.push(t)}return V(i)},variable:function(e,r){return new X("_")},object:function(e,r){r=void 0!==r&&r;new Y("[]",[]);var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(new Y("-",[H.fromJavaScript.apply(i,r),H.fromJavaScript.apply(e[i],r)]));return V(t)},any:function(e,r){}},apply:function(e,r){for(var t in r=void 0!==r&&r,H.fromJavaScript.test)if("any"!==t&&H.fromJavaScript.test[t](e,r))return H.fromJavaScript.conversion[t](e,r);return H.fromJavaScript.conversion.any(e,r)}},type:{Var:X,Num:M,Term:Y,Rule:z,State:$,Stream:q,Module:j,Thread:L,Session:G,Substitution:D,File:t,Directory:n,order:[X,M,Y,q],compare:function(r,t){var i=e(H.type.order,r.constructor),n=e(H.type.order,t.constructor);if(i<n)return-1;if(i>n)return 1;if(r.constructor===M){if(r.is_float&&t.is_float)return 0;if(r.is_float)return-1;if(t.is_float)return 1}return 0},is_substitution:function(e){return e instanceof D},is_state:function(e){return e instanceof $},is_rule:function(e){return e instanceof z},is_variable:function(e){return e instanceof X},is_stream:function(e){return e instanceof q},is_anonymous_var:function(e){return e instanceof X&&"_"===e.id},is_callable:function(r){return r instanceof Y&&(-1===e([",/2",";/2","->/2"],r.indicator)||H.type.is_callable(r.args[0])&&H.type.is_callable(r.args[1]))||r instanceof X},is_number:function(e){return e instanceof M},is_integer:function(e){return e instanceof M&&!e.is_float},is_float:function(e){return e instanceof M&&e.is_float},is_term:function(e){return e instanceof Y},is_atom:function(e){return e instanceof Y&&0===e.args.length},is_ground:function(e){if(e instanceof X)return!1;if(e instanceof Y)for(var r=0;r<e.args.length;r++)if(!H.type.is_ground(e.args[r]))return!1;return!0},is_atomic:function(e){return e instanceof Y&&0===e.args.length||e instanceof M},is_compound:function(e){return e instanceof Y&&e.args.length>0},is_list:function(e){return e instanceof Y&&("[]/0"===e.indicator||"./2"===e.indicator)},is_empty_list:function(e){return e instanceof Y&&"[]/0"===e.indicator},is_non_empty_list:function(e){return e instanceof Y&&"./2"===e.indicator},is_fully_list:function(e){for(;e instanceof Y&&"./2"===e.indicator;)e=e.args[1];return e instanceof X||e instanceof Y&&"[]/0"===e.indicator},is_instantiated_list:function(e){for(;e instanceof Y&&"./2"===e.indicator;)e=e.args[1];return e instanceof Y&&"[]/0"===e.indicator},is_unitary_list:function(e){return e instanceof Y&&"./2"===e.indicator&&e.args[1]instanceof Y&&"[]/0"===e.args[1].indicator},is_character:function(e){return e instanceof Y&&0===e.args.length&&(1===e.id.length||e.id.length>0&&e.id.length<=2&&s(e.id,0)>=65536)},is_in_character:function(e){return e instanceof Y&&("end_of_file/0"===e.indicator||1===e.id.length||e.id.length>0&&e.id.length<=2&&s(e.id,0)>=65536)},is_character_code:function(e){return e instanceof M&&!e.is_float&&e.value>=0&&e.value<=1114111},is_in_character_code:function(e){return e instanceof M&&!e.is_float&&e.value>=-1&&e.value<=1114111},is_byte:function(e){return e instanceof M&&!e.is_float&&e.value>=0&&e.value<=255},is_in_byte:function(e){return e instanceof M&&!e.is_float&&e.value>=-1&&e.value<=255},is_operator:function(e){return e instanceof Y&&H.arithmetic.evaluation[e.indicator]},is_directive:function(e){return e instanceof Y&&(void 0!==H.directive[e.indicator]||void 0!==H.directive[e.id+"/*"])},is_builtin:function(e){return e instanceof Y&&H.builtin.rules.hasOwnProperty(e.indicator)&&"goal_expansion/2"!==e.indicator},is_error:function(e){return e instanceof Y&&"throw/1"===e.indicator},is_error_state:function(e){return H.type.is_state(e)&&e.error&&!0===e.error},is_predicate_indicator:function(e){return e instanceof Y&&"//2"===e.indicator&&e.args[0]instanceof Y&&0===e.args[0].args.length&&e.args[1]instanceof M&&!1===e.args[1].is_float},is_flag:function(e){return e instanceof Y&&0===e.args.length&&void 0!==H.flag[e.id]},is_value_flag:function(e,r){if(!H.type.is_flag(e))return!1;for(var t in H.flag[e.id].allowed)if(H.flag[e.id].allowed.hasOwnProperty(t)&&H.flag[e.id].allowed[t].equals(r))return!0;return!1},is_io_mode:function(e){return H.type.is_atom(e)&&-1!==["read","write","append"].indexOf(e.id)},is_stream_option:function(e){return H.type.is_term(e)&&("alias/1"===e.indicator&&H.type.is_atom(e.args[0])||"reposition/1"===e.indicator&&H.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"type/1"===e.indicator&&H.type.is_atom(e.args[0])&&("text"===e.args[0].id||"binary"===e.args[0].id)||"eof_action/1"===e.indicator&&H.type.is_atom(e.args[0])&&("error"===e.args[0].id||"eof_code"===e.args[0].id||"reset"===e.args[0].id))},is_stream_position:function(e){return H.type.is_term(e)&&("end_of_stream/0"===e.indicator||"past_end_of_stream/0"===e.indicator||"position/3"===e.indicator&&H.type.is_integer(e.args[0])&&H.type.is_integer(e.args[1])&&H.type.is_integer(e.args[2]))},is_stream_property:function(e){return H.type.is_term(e)&&("input/0"===e.indicator||"output/0"===e.indicator||"alias/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0]))||"file_name/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0]))||"reposition/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id))||"type/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0])&&("text"===e.args[0].id||"binary"===e.args[0].id))||"mode/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0])&&("read"===e.args[0].id||"write"===e.args[0].id||"append"===e.args[0].id))||"eof_action/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0])&&("error"===e.args[0].id||"eof_code"===e.args[0].id||"reset"===e.args[0].id))||"end_of_stream/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_atom(e.args[0])&&("at"===e.args[0].id||"past"===e.args[0].id||"not"===e.args[0].id))||"position/1"===e.indicator&&(H.type.is_variable(e.args[0])||H.type.is_term(e.args[0])&&"position/3"===e.args[0].indicator&&(H.type.is_variable(e.args[0].args[0])||H.type.is_integer(e.args[0].args[0]))&&(H.type.is_variable(e.args[0].args[1])||H.type.is_integer(e.args[0].args[1]))&&(H.type.is_variable(e.args[0].args[2])||H.type.is_integer(e.args[0].args[2]))))},is_streamable:function(e){return void 0!==e.__proto__.stream},is_read_option:function(e){return H.type.is_term(e)&&-1!==["variables/1","variable_names/1","singletons/1"].indexOf(e.indicator)},is_write_option:function(e){return H.type.is_term(e)&&("quoted/1"===e.indicator&&H.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"ignore_ops/1"===e.indicator&&H.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"numbervars/1"===e.indicator&&H.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"variable_names/1"===e.indicator&&H.type.is_fully_list(e.args[0]))},is_close_option:function(e){return H.type.is_term(e)&&"force/1"===e.indicator&&H.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)},is_modifiable_flag:function(e){return H.type.is_flag(e)&&H.flag[e.id].changeable},is_module:function(e){return e instanceof j},is_file:function(e){return e instanceof t},is_directory:function(e){return e instanceof n},is_predicate_property:function(e){return H.type.is_term(e)&&("built_in/0"===e.indicator||"static/0"===e.indicator||"dynamic/0"===e.indicator||"native_code/0"===e.indicator||"multifile/0"===e.indicator||"meta_predicate/1"===e.indicator)},is_meta_argument_specifier:function(r){return H.type.is_integer(r)&&r.value>=0||H.type.is_atom(r)&&-1!==e(["+","-","?","*","^",":","//"],r.id)},is_time_property:function(r){return H.type.is_term(r)&&1===r.args.length&&(H.type.is_variable(r.args[0])||H.type.is_integer(r.args[0]))&&-1!==e(["year","month","day","hours","minutes","seconds","milliseconds","weekday"],r.id)}},arithmetic:{evaluation:{"e/0":{type_args:null,type_result:!0,fn:function(e){return Math.E}},"pi/0":{type_args:null,type_result:!0,fn:function(e){return Math.PI}},"tau/0":{type_args:null,type_result:!0,fn:function(e){return 2*Math.PI}},"epsilon/0":{type_args:null,type_result:!0,fn:function(e){return Number.EPSILON}},"+/1":{type_args:null,type_result:null,fn:function(e,r){return e}},"-/1":{type_args:null,type_result:null,fn:function(e,r){return-e}},"\\/1":{type_args:!1,type_result:!1,fn:function(e,r){return~e}},"abs/1":{type_args:null,type_result:null,fn:function(e,r){return Math.abs(e)}},"sign/1":{type_args:null,type_result:null,fn:function(e,r){return Math.sign(e)}},"float_integer_part/1":{type_args:!0,type_result:!1,fn:function(e,r){return parseInt(e)}},"float_fractional_part/1":{type_args:!0,type_result:!0,fn:function(e,r){return e-parseInt(e)}},"float/1":{type_args:null,type_result:!0,fn:function(e,r){return parseFloat(e)}},"floor/1":{type_args:!0,type_result:!1,fn:function(e,r){return Math.floor(e)}},"truncate/1":{type_args:!0,type_result:!1,fn:function(e,r){return parseInt(e)}},"round/1":{type_args:!0,type_result:!1,fn:function(e,r){return Math.round(e)}},"ceiling/1":{type_args:!0,type_result:!1,fn:function(e,r){return Math.ceil(e)}},"sin/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.sin(e)}},"cos/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.cos(e)}},"tan/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.tan(e)}},"asin/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.abs(e)<=1?Math.asin(e):H.error.evaluation("undefined",r.__call_indicator)}},"acos/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.abs(e)<=1?Math.acos(e):H.error.evaluation("undefined",r.__call_indicator)}},"atan/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.atan(e)}},"atan2/2":{type_args:null,type_result:!0,fn:function(e,r,t){return 0===e&&0===r?H.error.evaluation("undefined",t.__call_indicator):Math.atan2(e,r)}},"acosh/1":{type_args:null,type_result:!0,fn:function(e,r){return e>=1?Math.acosh(e):H.error.evaluation("undefined",r.__call_indicator)}},"asinh/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.asinh(e)}},"atanh/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.abs(e)<1?Math.atanh(e):H.error.evaluation("undefined",r.__call_indicator)}},"cosh/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.cosh(e)}},"sinh/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.sinh(e)}},"tanh/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.tanh(e)}},"exp/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.exp(e)}},"sqrt/1":{type_args:null,type_result:!0,fn:function(e,r){return e>=0?Math.sqrt(e):H.error.evaluation("undefined",r.__call_indicator)}},"log/1":{type_args:null,type_result:!0,fn:function(e,r){return e>0?Math.log(e):H.error.evaluation("undefined",r.__call_indicator)}},"log/2":{type_args:null,type_result:!0,fn:function(e,r,t){return e>0&&r>0?Math.log(r)/Math.log(e):H.error.evaluation("undefined",t.__call_indicator)}},"log10/1":{type_args:null,type_result:!0,fn:function(e,r){return e>0?Math.log(e)/Math.log(10):H.error.evaluation("undefined",r.__call_indicator)}},"+/2":{type_args:null,type_result:null,fn:function(e,r,t){return e+r}},"-/2":{type_args:null,type_result:null,fn:function(e,r,t){return e-r}},"*/2":{type_args:null,type_result:null,fn:function(e,r,t){return e*r}},"//2":{type_args:null,type_result:!0,fn:function(e,r,t){return r?e/r:H.error.evaluation("zero_divisor",t.__call_indicator)}},"///2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?Math.trunc(e/r):H.error.evaluation("zero_divisor",t.__call_indicator)}},"div/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?Math.floor(e/r):H.error.evaluation("zero_divisor",t.__call_indicator)}},"**/2":{type_args:null,type_result:!0,fn:function(e,r,t){return 0==e&&r<0?H.error.evaluation("zero_divisor",t.__call_indicator):Math.pow(e,r)}},"^/2":{type_args:null,type_result:null,fn:function(e,r,t){return 0==e&&r<0?H.error.evaluation("zero_divisor",t.__call_indicator):Math.pow(e,r)}},"<</2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e<<r}},">>/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e>>r}},"/\\/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e&r}},"\\//2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e|r}},"xor/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e^r}},"rem/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?e%r:H.error.evaluation("zero_divisor",t.__call_indicator)}},"mod/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?e-Math.floor(e/r)*r:H.error.evaluation("zero_divisor",t.__call_indicator)}},"max/2":{type_args:null,type_result:null,fn:function(e,r,t){return Math.max(e,r)}},"min/2":{type_args:null,type_result:null,fn:function(e,r,t){return Math.min(e,r)}},"gcd/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return F(e,r)}}}},directive:{"dynamic/1":function(e,r,t){var i=r.args[0];H.type.is_list(i)||(i=V([i]));for(var n=i;H.type.is_term(n)&&"./2"===n.indicator;){if(indicator=n.args[0],H.type.is_variable(indicator))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_compound(indicator)&&"//2"===indicator.indicator)if(H.type.is_variable(indicator.args[0])||H.type.is_variable(indicator.args[1]))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_atom(indicator.args[0]))if(H.type.is_integer(indicator.args[1])){var a=indicator.args[0].id+"/"+indicator.args[1].value,o=e.session.modules[t.context_module];o.public_predicates[a]=!0,o.rules[a]||(o.rules[a]=[])}else e.throw_warning(H.error.type("integer",indicator.args[1],r.indicator));else e.throw_warning(H.error.type("atom",indicator.args[0],r.indicator));else e.throw_warning(H.error.type("predicate_indicator",indicator,r.indicator));n=n.args[1]}H.type.is_variable(n)?e.throw_warning(H.error.instantiation(r.indicator)):H.type.is_term(n)&&"[]/0"===n.indicator||e.throw_warning(H.error.type("predicate_indicator",indicator,r.indicator))},"dynamic/*":function(e,r){for(var t=0;t<r.args.length;t++)H.directive["dynamic/1"](e,new Y("dynamic",[r.args[t]]))},"multifile/1":function(e,r,t){var i=r.args[0];if(H.type.is_variable(i))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_compound(i)&&"//2"===i.indicator)if(H.type.is_variable(i.args[0])||H.type.is_variable(i.args[1]))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_atom(i.args[0]))if(H.type.is_integer(i.args[1])){var n=r.args[0].args[0].id+"/"+r.args[0].args[1].value,a=e.session.modules[t.context_module];a.multifile_predicates[n]=!0,a.rules.hasOwnProperty(n)||(a.rules[n]=[],a.public_predicates[n]=!1)}else e.throw_warning(H.error.type("integer",i.args[1],r.indicator));else e.throw_warning(H.error.type("atom",i.args[0],r.indicator));else e.throw_warning(H.error.type("predicate_indicator",i,r.indicator))},"meta_predicate/1":function(e,r,t){t=void 0===t?{}:t;var i=r.args[0];if(H.type.is_variable(i))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_callable(i)){for(var n=0;n<i.args.length;n++){var a=i.args[n];if(!H.type.is_meta_argument_specifier(a))return void e.throw_warning(H.error.type("meta_argument_specifier",a,r.indicator))}e.session.modules[t.context_module].meta_predicates[i.indicator]=i}else e.throw_warning(H.error.type("callable",i,r.indicator))},"set_prolog_flag/2":function(e,r){var t=r.args[0],i=r.args[1];H.type.is_variable(t)||H.type.is_variable(i)?e.throw_warning(H.error.instantiation(r.indicator)):H.type.is_atom(t)?H.type.is_flag(t)?H.type.is_modifiable_flag(t)?H.type.is_value_flag(t,i)?e.session.flag[t.id]=i:e.throw_warning(H.error.domain("flag_value",new Y("+",[t,i]),r.indicator)):e.throw_warning(H.error.permission("modify","flag",t,r.indicator)):e.throw_warning(H.error.domain("prolog_flag",t,r.indicator)):e.throw_warning(H.error.type("atom",t,r.indicator))},"module/2":function(e,r,t){(t=void 0===t?{}:t).context_module=void 0===t.context_module?"user":t.context_module;var i=r.args[0],n=r.args[1];if(H.type.is_variable(i)||H.type.is_variable(n))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_atom(i))if(H.type.is_list(n))if(H.type.is_module(e.session.modules[i.indicator]))e.throw_warning(H.error.permission("create","module",i,r.indicator));else{for(var a=n,o=[];H.type.is_term(a)&&"./2"===a.indicator;){var s=a.args[0];H.type.is_predicate_indicator(s)?o.push(s.args[0].id+"/"+s.args[1].value):e.throw_warning(H.error.type("predicate_indicator",s,r.indicator)),a=a.args[1]}H.type.is_variable(a)?e.throw_warning(H.error.instantiation(r.indicator)):H.type.is_empty_list(a)||e.throw_warning(H.error.type("list",n,r.indicator));var l=new j(i.id,{},o,{session:e.session});e.session.modules[i.id]=l,e.session.modules[t.context_module].modules[i.id]=l,t.context_module=i.id}else e.throw_warning(H.error.type("list",n,r.indicator));else e.throw_warning(H.error.type("atom",i,r.indicator))},"use_module/1":function(e,r,t){(t=void 0===t?{}:t).context_module=void 0===t.context_module?"user":t.context_module;var i=r.args[0];if(H.type.is_variable(i))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_term(i)){if("library/1"!==i.indicator){n=i.id;return e.consult(n,{context_module:t.context_module,text:!1,success:function(){b(e,t.string,t)},error:function(){t.error(H.error.existence("module",i,r.indicator))}}),!0}var n=i.args[0].id,a=H.modules[n];if(H.type.is_module(a)){if(!e.session.modules[t.context_module].modules.hasOwnProperty(n)){e.session.modules[n]=a,e.session.modules[t.context_module].modules[n]=a;for(var o=0;o<a.dependencies.length;o++){var s=new Y("use_module",[new Y("library",[new Y(a.dependencies[o])])]);H.directive["use_module/1"](e,s,{context_module:n})}}}else e.throw_warning(H.error.existence("module",i,r.indicator))}else e.throw_warning(H.error.type("term",i,r.indicator))},"char_conversion/2":function(e,r,t){var i=r.args[0],n=r.args[1];if(H.type.is_variable(i)||H.type.is_variable(n))e.throw_warning(H.error.instantiation(r.indicator));else if(H.type.is_character(i)){if(H.type.is_character(n))return i.id===n.id?delete e.session.__char_conversion[i.id]:e.session.__char_conversion[i.id]=n.id,t.tokens=t.tokenizer.get_tokens(t.current_token),t.current_token=0,!0;e.throw_warning(H.error.type("character",n,r.indicator))}else e.throw_warning(H.error.type("character",i,r.indicator))},"op/3":function(r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_atom(a)&&(a=new Y(".",[a,new Y("[]")])),H.type.is_variable(i)||H.type.is_variable(n)||H.type.is_variable(a))r.throw_warning(H.error.instantiation(t.indicator));else if(H.type.is_integer(i))if(H.type.is_atom(n))if(H.type.is_list(a))if(H.type.is_empty_list(a))r.throw_warning(H.error.permission("create","operator",a,t.indicator));else{for(var o=a;H.type.is_term(o)&&"./2"===o.indicator;){var s=o.args[0];if(o=o.args[1],H.type.is_variable(s))r.throw_warning(H.error.instantiation(t.indicator));else if(H.type.is_atom(s))if(i.value<0||i.value>1200)r.throw_warning(H.error.domain("operator_priority",i,t.indicator));else if(","===s.id)r.throw_error(H.error.permission("modify","operator",s,t.indicator));else if("{}"===s.id)r.throw_warning(H.error.permission("create","operator",s,t.indicator));else if("[]"===s.id)r.throw_warning(H.error.permission("create","operator",s,t.indicator));else if("|"===s.id&&0!==i.value&&(i.value<1001||3!==n.id.length))r.throw_warning(H.error.permission("create","operator",s,t.indicator));else if(-1===["fy","fx","yf","xf","xfx","yfx","xfy"].indexOf(n.id))r.throw_warning(H.error.domain("operator_specifier",n,t.indicator));else{var l,p={prefix:null,infix:null,postfix:null};for(var u in r.session.__operators)if(r.session.__operators.hasOwnProperty(u)){var _=r.session.__operators[u][s.id];_&&(-1!==e(_,"fx")&&(p.prefix={priority:u,type:"fx"}),-1!==e(_,"fy")&&(p.prefix={priority:u,type:"fy"}),-1!==e(_,"xf")&&(p.postfix={priority:u,type:"xf"}),-1!==e(_,"yf")&&(p.postfix={priority:u,type:"yf"}),-1!==e(_,"xfx")&&(p.infix={priority:u,type:"xfx"}),-1!==e(_,"xfy")&&(p.infix={priority:u,type:"xfy"}),-1!==e(_,"yfx")&&(p.infix={priority:u,type:"yfx"}))}switch(n.id){case"fy":case"fx":l="prefix";break;case"yf":case"xf":l="postfix";break;default:l="infix"}p.infix&&"postfix"===l||p.postfix&&"infix"===l?r.throw_warning(H.error.permission("create","operator",s,t.indicator)):(p[l]&&(I(r.session.__operators[p[l].priority][s.id],p[l].type),0===r.session.__operators[p[l].priority][s.id].length&&delete r.session.__operators[p[l].priority][s.id]),i.value>0&&(r.session.__operators[i.value]||(r.session.__operators[i.value.toString()]={}),r.session.__operators[i.value][s.id]||(r.session.__operators[i.value][s.id]=[]),r.session.__operators[i.value][s.id].push(n.id)))}else r.throw_warning(H.error.type("atom",s,t.indicator))}if(H.type.is_variable(o))return void r.throw_warning(H.error.instantiation(t.indicator));if(!H.type.is_term(o)||"[]/0"!==o.indicator)return void r.throw_warning(H.error.type("list",a,t.indicator))}else r.throw_warning(H.error.type("list",a,t.indicator));else r.throw_warning(H.error.type("atom",n,t.indicator));else r.throw_warning(H.error.type("integer",i,t.indicator))},"initialization/1":function(e,r,t){var i=r.args[0];t.initialization.push(i)}},flag:{bounded:{allowed:[new Y("true"),new Y("false")],value:new Y("true"),changeable:!1},max_integer:{allowed:[new M(Number.MAX_SAFE_INTEGER)],value:new M(Number.MAX_SAFE_INTEGER),changeable:!1},min_integer:{allowed:[new M(Number.MIN_SAFE_INTEGER)],value:new M(Number.MIN_SAFE_INTEGER),changeable:!1},integer_rounding_function:{allowed:[new Y("down"),new Y("toward_zero")],value:new Y("toward_zero"),changeable:!1},char_conversion:{allowed:[new Y("on"),new Y("off")],value:new Y("on"),changeable:!0},debug:{allowed:[new Y("on"),new Y("off")],value:new Y("off"),changeable:!0},max_arity:{allowed:[new Y("unbounded")],value:new Y("unbounded"),changeable:!1},unknown:{allowed:[new Y("error"),new Y("fail"),new Y("warning")],value:new Y("error"),changeable:!0},double_quotes:{allowed:[new Y("chars"),new Y("codes"),new Y("atom")],value:new Y("chars"),changeable:!0},occurs_check:{allowed:[new Y("false"),new Y("true")],value:new Y("false"),changeable:!0},dialect:{allowed:[new Y("tau")],value:new Y("tau"),changeable:!1},version_data:{allowed:[new Y("tau",[new M(r.major,!1),new M(r.minor,!1),new M(r.patch,!1),new Y(r.status)])],value:new Y("tau",[new M(r.major,!1),new M(r.minor,!1),new M(r.patch,!1),new Y(r.status)]),changeable:!1},nodejs:{allowed:[new Y("true"),new Y("false")],value:new Y(B?"true":"false"),changeable:!1},argv:{allowed:[U],value:U,changeble:!1}},unify:function(r,t,i){i=void 0!==i&&i;var n=Array.isArray(r)?r:[r],a=Array.isArray(t)?t:[t];if(n.length!==a.length)return null;for(var o=new D;n.length>0;){var s=n.pop(),l=a.pop();if(H.type.is_variable(s)&&(s=s.apply(o)),H.type.is_variable(l)&&(l=l.apply(o)),s!=l)if(H.type.is_term(s)&&H.type.is_term(l)){if(s.indicator!==l.indicator)return null;for(var p=s.args.length-1;p>=0;p--)n.push(s.args[p]),a.push(l.args[p])}else if(H.type.is_number(s)&&H.type.is_number(l)){if(s.value!==l.value||s.is_float!==l.is_float)return null}else if(H.type.is_variable(s)){if(l=l.apply(o),H.type.is_variable(l)&&s.id===l.id)continue;if(!0===i&&-1!==e(l.variables(),s.id))return null;"_"!==s.id&&o.add(s.id,l)}else if(H.type.is_variable(l))n.push(l),a.push(s);else{if(void 0===s.unify)return null;var u=s.apply(o).unify(l.apply(o),i);if(null==u)return null;for(var p in u.links)o.add(p,u.links[p])}}return o.apply(o)},is_rename:function(e,r,t){return t=t||{},e.is_rename&&r.is_rename?e.is_rename(r,t):!(!e.equals||!r.equals)&&e.equals(r)},compare:function(e,r){var t=H.type.compare(e,r);return 0!==t?t:e.compare(r)},arithmetic_compare:function(e,r,t){var i=r.interpret(e);if(H.type.is_number(i)){var n=t.interpret(e);return H.type.is_number(n)?i.value<n.value?-1:i.value>n.value?1:0:n}return i},operate:function(e,r){if(H.type.is_operator(r)){for(var t,i=H.type.is_operator(r),n=[],a=!1,o=0;o<r.args.length;o++){if(t=r.args[o].interpret(e),!H.type.is_number(t))return t;if(null!==i.type_args&&t.is_float!==i.type_args)return H.error.type(i.type_args?"float":"integer",t,e.__call_indicator);n.push(t.value),a=a||t.is_float}return n.push(e),t=H.arithmetic.evaluation[r.indicator].fn.apply(this,n),"^/2"!==r.indicator||a||t===parseInt(t,10)?(a=null===i.type_result?a:i.type_result,H.type.is_term(t)?t:t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY?H.error.evaluation("float_overflow",e.__call_indicator):!1===a&&"true"===e.get_flag("bounded").id&&(t>e.get_flag("max_integer").value||t<e.get_flag("min_integer").value)?H.error.evaluation("int_overflow",e.__call_indicator):new M(t,a)):H.error.type("float",new M(n[0],!1),e.__call_indicator)}return H.error.type("evaluable",R(r.indicator),e.__call_indicator)},error:{existence:function(e,r,t){return"string"==typeof r&&(r=R(r)),new Y("error",[new Y("existence_error",[new Y(e),r]),R(t)])},type:function(e,r,t){return new Y("error",[new Y("type_error",[new Y(e),r]),R(t)])},instantiation:function(e){return new Y("error",[new Y("instantiation_error"),R(e)])},uninstantiation:function(e,r){return new Y("error",[new Y("uninstantiation_error",[new Y(e)]),R(r)])},domain:function(e,r,t){return new Y("error",[new Y("domain_error",[new Y(e),r]),R(t)])},representation:function(e,r){return new Y("error",[new Y("representation_error",[new Y(e)]),R(r)])},permission:function(e,r,t,i){return new Y("error",[new Y("permission_error",[new Y(e),new Y(r),t]),R(i)])},evaluation:function(e,r){return new Y("error",[new Y("evaluation_error",[new Y(e)]),R(r)])},syntax:function(e,r,t){e=e||{value:"",line:0,column:0,matches:[""],start:0};var i=t&&e.matches.length>0?e.start+e.matches[0].length:e.start,n=t?new Y("token_not_found"):new Y("found",[new Y(e.value.toString())]),a=new Y(".",[new Y("line",[new M(e.line+1)]),new Y(".",[new Y("column",[new M(i)]),new Y(".",[n,new Y("[]",[])])])]);return new Y("error",[new Y("syntax_error",[new Y(r)]),a])},syntax_by_predicate:function(e,r){return new Y("error",[new Y("syntax_error",[new Y(e)]),R(r)])}},warning:{singleton:function(e,r,t){for(var i=new Y("[]"),n=e.length-1;n>=0;n--)i=new Y(".",[new X(e[n]),i]);return new Y("warning",[new Y("singleton_variables",[i,R(r)]),new Y(".",[new Y("line",[new M(t,!1)]),new Y("[]")])])},failed_goal:function(e,r){return new Y("warning",[new Y("failed_goal",[e]),new Y(".",[new Y("line",[new M(r,!1)]),new Y("[]")])])}},format_variable:function(e,r){var t=r&&r.length>0?s(r,1):0;return"_"===r||r&&"_"===r[0]&&(95===t||t>=65&&t<=90)?"__"+e:"_"+e},format_answer:function(r,t,i){if(t instanceof G&&(t=t.thread),(i=i||{}).session=t?t.session:void 0,H.type.is_error(r))return"uncaught exception: "+r.args[0].toString(i);if(!1===r)return"false";if(null===r)return"limit exceeded";var n=0,a="";if(H.type.is_substitution(r)){var o=r.domain(!0);for(var s in r.links)if(r.links.hasOwnProperty(s)&&H.type.is_variable(r.links[s])){var l={};l[r.links[s].id]=new X(s),r=r.apply(new D(l))}r=r.filter((function(t,i){return!H.type.is_variable(i)||H.type.is_variable(i)&&r.has_attributes(t)||-1!==e(o,i.id)&&t!==i.id}))}for(var s in r.links)if(r.links.hasOwnProperty(s))if(H.type.is_variable(r.links[s])&&s===r.links[s].id){var p=r.attrs[s];for(var u in p)p.hasOwnProperty(u)&&(n++,""!==a&&(a+=", "),a+="put_attr("+s+", "+u+", "+p[u].toString(i)+")")}else n++,""!==a&&(a+=", "),a+=s.toString(i)+" = "+r.links[s].toString(i,{priority:"700",class:"xfx",indicator:"=/2"},"right");return 0===n?"true":a},flatten_error:function(e){if(!H.type.is_error(e))return null;e=e.args[0];var r={};return r.type=e.args[0].id,r.thrown="syntax_error"===r.type?null:e.args[1].id,r.expected=null,r.found=null,r.representation=null,r.existence=null,r.existence_type=null,r.line=null,r.column=null,r.permission_operation=null,r.permission_type=null,r.evaluation_type=null,"type_error"===r.type||"domain_error"===r.type?(r.expected=e.args[0].args[0].id,r.found=e.args[0].args[1].toString()):"syntax_error"===r.type?"./2"===e.args[1].indicator?(r.expected=e.args[0].args[0].id,r.found=e.args[1].args[1].args[1].args[0],r.found="token_not_found"===r.found.id?r.found.id:r.found.args[0].id,r.line=e.args[1].args[0].args[0].value,r.column=e.args[1].args[1].args[0].args[0].value):r.thrown=e.args[1].id:"permission_error"===r.type?(r.found=e.args[0].args[2].toString(),r.permission_operation=e.args[0].args[0].id,r.permission_type=e.args[0].args[1].id):"evaluation_error"===r.type?r.evaluation_type=e.args[0].args[0].id:"representation_error"===r.type?r.representation=e.args[0].args[0].id:"existence_error"===r.type&&(r.existence=e.args[0].args[1].toString(),r.existence_type=e.args[0].args[0].id),r},create:function(e){return new H.type.Session(e)}};H.builtin=new j("system",{"goal_expansion/2":[new z(new Y("goal_expansion",[new Y(",",[new X("X"),new X("Y")]),new Y(",",[new X("X_"),new X("Y_")])]),new Y(";",[new Y(",",[new Y("goal_expansion",[new X("X"),new X("X_")]),new Y(";",[new Y("goal_expansion",[new X("Y"),new X("Y_")]),new Y("=",[new X("Y_"),new X("Y")])])]),new Y(",",[new Y("=",[new X("X"),new X("X_")]),new Y("goal_expansion",[new X("Y"),new X("Y_")])])])),new z(new Y("goal_expansion",[new Y(";",[new X("X"),new X("Y")]),new Y(";",[new X("X_"),new X("Y_")])]),new Y(";",[new Y(",",[new Y("goal_expansion",[new X("X"),new X("X_")]),new Y(";",[new Y("goal_expansion",[new X("Y"),new X("Y_")]),new Y("=",[new X("Y_"),new X("Y")])])]),new Y(",",[new Y("=",[new X("X"),new X("X_")]),new Y("goal_expansion",[new X("Y"),new X("Y_")])])])),new z(new Y("goal_expansion",[new Y("->",[new X("X"),new X("Y")]),new Y("->",[new X("X_"),new X("Y_")])]),new Y(";",[new Y(",",[new Y("goal_expansion",[new X("X"),new X("X_")]),new Y(";",[new Y("goal_expansion",[new X("Y"),new X("Y_")]),new Y("=",[new X("Y_"),new X("Y")])])]),new Y(",",[new Y("=",[new X("X"),new X("X_")]),new Y("goal_expansion",[new X("Y"),new X("Y_")])])])),new z(new Y("goal_expansion",[new Y("catch",[new X("X"),new X("Y"),new X("Z")]),new Y("catch",[new X("X_"),new X("Y"),new X("Z_")])]),new Y(";",[new Y(",",[new Y("goal_expansion",[new X("X"),new X("X_")]),new Y(";",[new Y("goal_expansion",[new X("Z"),new X("Z_")]),new Y("=",[new X("Z_"),new X("Z")])])]),new Y(",",[new Y("=",[new X("X_"),new X("X")]),new Y("goal_expansion",[new X("Z"),new X("Z_")])])])),new z(new Y("goal_expansion",[new Y("\\+",[new X("X")]),new Y("\\+",[new X("X_")])]),new Y(",",[new Y("nonvar",[new X("X")]),new Y("goal_expansion",[new X("X"),new X("X_")])])),new z(new Y("goal_expansion",[new Y("once",[new X("X")]),new Y("once",[new X("X_")])]),new Y(",",[new Y("nonvar",[new X("X")]),new Y("goal_expansion",[new X("X"),new X("X_")])])),new z(new Y("goal_expansion",[new Y("findall",[new X("X"),new X("Y"),new X("Z")]),new Y("findall",[new X("X"),new X("Y_"),new X("Z")])]),new Y("goal_expansion",[new X("Y"),new X("Y_")])),new z(new Y("goal_expansion",[new Y("setof",[new X("X"),new X("Y"),new X("Z")]),new Y("findall",[new X("X"),new X("Y_"),new X("Z")])]),new Y("goal_expansion",[new X("Y"),new X("Y_")])),new z(new Y("goal_expansion",[new Y("bagof",[new X("X"),new X("Y"),new X("Z")]),new Y("findall",[new X("X"),new X("Y_"),new X("Z")])]),new Y("goal_expansion",[new X("Y"),new X("Y_")])),new z(new Y("goal_expansion",[new Y("call",[new X("X")]),new Y("call",[new X("X_")])]),new Y(",",[new Y("nonvar",[new X("X")]),new Y("goal_expansion",[new X("X"),new X("X_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y("[]",[])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1"),new X("A2")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y(".",[new X("A2"),new Y("[]",[])])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1"),new X("A2"),new X("A3")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y(".",[new X("A2"),new Y(".",[new X("A3"),new Y("[]",[])])])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1"),new X("A2"),new X("A3"),new X("A4")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y(".",[new X("A2"),new Y(".",[new X("A3"),new Y(".",[new X("A4"),new Y("[]",[])])])])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1"),new X("A2"),new X("A3"),new X("A4"),new X("A5")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y(".",[new X("A2"),new Y(".",[new X("A3"),new Y(".",[new X("A4"),new Y(".",[new X("A5"),new Y("[]",[])])])])])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1"),new X("A2"),new X("A3"),new X("A4"),new X("A5"),new X("A6")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y(".",[new X("A2"),new Y(".",[new X("A3"),new Y(".",[new X("A4"),new Y(".",[new X("A5"),new Y(".",[new X("A6"),new Y("[]",[])])])])])])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])])),new z(new Y("goal_expansion",[new Y("call",[new X("X"),new X("A1"),new X("A2"),new X("A3"),new X("A4"),new X("A5"),new X("A6"),new X("A7")]),new Y("call",[new X("F_")])]),new Y(",",[new Y("=..",[new X("F"),new Y(".",[new X("X"),new Y(".",[new X("A1"),new Y(".",[new X("A2"),new Y(".",[new X("A3"),new Y(".",[new X("A4"),new Y(".",[new X("A5"),new Y(".",[new X("A6"),new Y(".",[new X("A7"),new Y("[]",[])])])])])])])])])]),new Y("goal_expansion",[new X("F"),new X("F_")])]))],"$push_global_stack/2":function(e,r,t){var i=t.args[0],n=t.args[1];H.type.is_variable(i)?(e.push_global_stack(i.id,n),e.success(r)):e.throw_error(H.error.instantiation(t.indicator))},"$flush_global_stack/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i)){var o=e.flush_global_stack(i.id,a);e.prepend([new $(r.goal.replace(new Y("=",[n,o])),r.substitution,r)])}else e.throw_error(H.error.instantiation(t.indicator))},"$free_variable_set/3":function(r,t,i){for(var n=i.args[0],o=i.args[1],s=i.args[2],l=[],p=n;H.type.is_term(p)&&"^/2"===p.indicator;)l=l.concat(p.args[0].variables()),p=p.args[1];var u=p.variables(),_=V(a(function(r,t){for(var i=[],n=0;n<r.length;n++)-1===e(i,r[n])&&-1===e(t,r[n])&&i.push(r[n]);return i}(u,l),(function(e){return new X(e)})));r.prepend([new $(t.goal.replace(new Y(",",[new Y("=",[o,p]),new Y("=",[s,_])])),t.substitution,t)])},"$member/2":[new H.type.Rule(new H.type.Term("$member",[new H.type.Var("X"),new H.type.Term(".",[new H.type.Var("X"),new H.type.Var("_")])]),null),new H.type.Rule(new H.type.Term("$member",[new H.type.Var("X"),new H.type.Term(".",[new H.type.Var("_"),new H.type.Var("Xs")])]),new H.type.Term("$member",[new H.type.Var("X"),new H.type.Var("Xs")]))],"$bind_bagof_keys/2":[new H.type.Rule(new H.type.Term("$bind_bagof_keys",[new H.type.Term("[]",[]),new H.type.Var("_")]),null),new H.type.Rule(new H.type.Term("$bind_bagof_keys",[new H.type.Term(".",[new H.type.Term("-",[new H.type.Var("Key"),new H.type.Var("_")]),new H.type.Var("Bag")]),new H.type.Var("Vars")]),new H.type.Term(",",[new H.type.Term("term_variables",[new H.type.Var("Key"),new H.type.Var("Vars"),new H.type.Var("_")]),new H.type.Term("$bind_bagof_keys",[new H.type.Var("Bag"),new H.type.Var("Vars")])]))],"$findall/4":[new H.type.Rule(new H.type.Term("$findall",[new H.type.Var("Template0"),new H.type.Var("Goal0"),new H.type.Var("Instances"),new H.type.Var("Tail")]),new H.type.Term(";",[new H.type.Term(",",[new H.type.Term("copy_term",[new H.type.Term("-",[new H.type.Var("Template0"),new H.type.Var("Goal0")]),new H.type.Term("-",[new H.type.Var("Template1"),new H.type.Var("Goal1")])]),new H.type.Term(",",[new H.type.Term("call",[new H.type.Var("Goal1")]),new H.type.Term(",",[new H.type.Term("copy_term",[new H.type.Var("Template1"),new H.type.Var("Template2")]),new H.type.Term(",",[new H.type.Term("$push_global_stack",[new H.type.Var("Var"),new H.type.Var("Template2")]),new H.type.Term("false",[])])])])]),new H.type.Term("$flush_global_stack",[new H.type.Var("Var"),new H.type.Var("Instances"),new H.type.Var("Tail")])]))],"$bagof/3":[new H.type.Rule(new H.type.Term("$bagof",[new H.type.Var("Template"),new H.type.Var("Goal0"),new H.type.Var("Answer")]),new H.type.Term(",",[new H.type.Term("$free_variable_set",[new H.type.Term("^",[new H.type.Var("Template"),new H.type.Var("Goal0")]),new H.type.Var("Goal1"),new H.type.Var("FV")]),new H.type.Term(",",[new H.type.Term("findall",[new H.type.Term("-",[new H.type.Var("FV"),new H.type.Var("Template")]),new H.type.Var("Goal1"),new H.type.Var("Answers"),new H.type.Term("[]",[])]),new H.type.Term(",",[new H.type.Term("$bind_bagof_keys",[new H.type.Var("Answers"),new H.type.Var("_")]),new H.type.Term(",",[new H.type.Term("keygroup",[new H.type.Var("Answers"),new H.type.Var("KeyGroups")]),new H.type.Term(",",[new H.type.Term("keysort",[new H.type.Var("KeyGroups"),new H.type.Var("KeySorted")]),new H.type.Term("$member",[new H.type.Term("-",[new H.type.Var("FV"),new H.type.Var("Answer")]),new H.type.Var("KeySorted")])])])])])]))],"$setof/3":[new H.type.Rule(new H.type.Term("$setof",[new H.type.Var("Template"),new H.type.Var("Goal0"),new H.type.Var("Answer")]),new H.type.Term(",",[new H.type.Term("$free_variable_set",[new H.type.Term("^",[new H.type.Var("Template"),new H.type.Var("Goal0")]),new H.type.Var("Goal1"),new H.type.Var("FV")]),new H.type.Term(",",[new H.type.Term("findall",[new H.type.Term("-",[new H.type.Var("FV"),new H.type.Var("Template")]),new H.type.Var("Goal1"),new H.type.Var("Answers"),new H.type.Term("[]",[])]),new H.type.Term(",",[new H.type.Term("$bind_bagof_keys",[new H.type.Var("Answers"),new H.type.Var("_")]),new H.type.Term(",",[new H.type.Term("keygroup",[new H.type.Var("Answers"),new H.type.Var("KeyGroups")]),new H.type.Term(",",[new H.type.Term("keysort",[new H.type.Var("KeyGroups"),new H.type.Var("KeySorted")]),new H.type.Term(",",[new H.type.Term("$member",[new H.type.Term("-",[new H.type.Var("FV"),new H.type.Var("Unsorted")]),new H.type.Var("KeySorted")]),new H.type.Term("sort",[new H.type.Var("Unsorted"),new H.type.Var("Answer")])])])])])])]))],"$if/3":[new H.type.Rule(new H.type.Term("$if",[new H.type.Var("If"),new H.type.Var("Then"),new H.type.Var("Else")]),new H.type.Term(";",[new H.type.Term(",",[new H.type.Term("call",[new H.type.Var("If")]),new H.type.Term(",",[new H.type.Term("$push_global_stack",[new H.type.Var("Stack"),new H.type.Var("_")]),new H.type.Term("call",[new H.type.Var("Then")])])]),new H.type.Term(",",[new H.type.Term("$flush_global_stack",[new H.type.Var("Stack"),new H.type.Term("[]",[]),new H.type.Term("[]",[])]),new H.type.Term("call",[new H.type.Var("Else")])])]))],"put_attr/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i))if(H.type.is_atom(n)){var o=r.substitution.set_attribute(i.id,n,a);e.prepend([new $(r.goal.replace(null),o,r)])}else e.throw_error(H.error.type("atom",n,t.indicator));else e.throw_error(H.error.type("variable",i,t.indicator))},"get_attr/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i))if(H.type.is_atom(n)){var o=r.substitution.get_attribute(i.id,n);o&&e.prepend([new $(r.goal.replace(new Y("=",[a,o])),r.substitution,r)])}else e.throw_error(H.error.type("atom",n,t.indicator));else e.throw_error(H.error.type("variable",i,t.indicator))},"op/3":function(r,t,i){var n=i.args[0],a=i.args[1],o=i.args[2];if(H.type.is_atom(o)&&(o=new Y(".",[o,new Y("[]")])),H.type.is_variable(n)||H.type.is_variable(a)||H.type.is_variable(o))r.throw_error(H.error.instantiation(i.indicator));else if(H.type.is_integer(n))if(H.type.is_atom(a))if(H.type.is_list(o))if(H.type.is_empty_list(o))r.throw_error(H.error.permission("create","operator",o,i.indicator));else{for(var s=o;H.type.is_term(s)&&"./2"===s.indicator;){var l=s.args[0];if(s=s.args[1],H.type.is_variable(l))return void r.throw_error(H.error.instantiation(i.indicator));if(!H.type.is_atom(l))return void r.throw_error(H.error.type("atom",l,i.indicator));if(n.value<0||n.value>1200)return void r.throw_error(H.error.domain("operator_priority",n,i.indicator));if(","===l.id)return void r.throw_error(H.error.permission("modify","operator",l,i.indicator));if("{}"===l.id)return void r.throw_error(H.error.permission("create","operator",l,i.indicator));if("[]"===l.id)return void r.throw_error(H.error.permission("create","operator",l,i.indicator));if("|"===l.id&&0!==n.value&&(n.value<1001||3!==a.id.length))return void r.throw_error(H.error.permission("create","operator",l,i.indicator));if(-1===["fy","fx","yf","xf","xfx","yfx","xfy"].indexOf(a.id))return void r.throw_error(H.error.domain("operator_specifier",a,i.indicator));var p,u={prefix:null,infix:null,postfix:null};for(var _ in r.session.__operators)if(r.session.__operators.hasOwnProperty(_)){var c=r.session.__operators[_][l.id];c&&(-1!==e(c,"fx")&&(u.prefix={priority:_,type:"fx"}),-1!==e(c,"fy")&&(u.prefix={priority:_,type:"fy"}),-1!==e(c,"xf")&&(u.postfix={priority:_,type:"xf"}),-1!==e(c,"yf")&&(u.postfix={priority:_,type:"yf"}),-1!==e(c,"xfx")&&(u.infix={priority:_,type:"xfx"}),-1!==e(c,"xfy")&&(u.infix={priority:_,type:"xfy"}),-1!==e(c,"yfx")&&(u.infix={priority:_,type:"yfx"}))}switch(a.id){case"fy":case"fx":p="prefix";break;case"yf":case"xf":p="postfix";break;default:p="infix"}if(u.infix&&"postfix"===p||u.postfix&&"infix"===p)return void r.throw_error(H.error.permission("create","operator",l,i.indicator));u[p]&&(I(r.session.__operators[u[p].priority][l.id],u[p].type),0===r.session.__operators[u[p].priority][l.id].length&&delete r.session.__operators[u[p].priority][l.id]),n.value>0&&(r.session.__operators[n.value]||(r.session.__operators[n.value.toString()]={}),r.session.__operators[n.value][l.id]||(r.session.__operators[n.value][l.id]=[]),r.session.__operators[n.value][l.id].push(a.id))}if(H.type.is_variable(s))return void r.throw_error(H.error.instantiation(i.indicator));if(!H.type.is_term(s)||"[]/0"!==s.indicator)return void r.throw_error(H.error.type("list",o,i.indicator));r.success(t)}else r.throw_error(H.error.type("list",o,i.indicator));else r.throw_error(H.error.type("atom",a,i.indicator));else r.throw_error(H.error.type("integer",n,i.indicator))},"current_op/3":function(r,t,i){var n=i.args[0],a=i.args[1],o=i.args[2],s=[];if(H.type.is_variable(n)||H.type.is_integer(n))if(H.type.is_integer(n)&&(n.value<0||n.value>1200))r.throw_error(H.error.domain("operator_priority",n,i.indicator));else if(H.type.is_variable(a)||H.type.is_atom(a))if(H.type.is_atom(a)&&-1===e(["fy","fx","yf","xf","xfx","yfx","xfy"],a.id))r.throw_error(H.error.domain("operator_specifier",a,i.indicator));else if(H.type.is_variable(o)||H.type.is_atom(o)){for(var l in r.session.__operators)for(var p in r.session.__operators[l])for(var u=0;u<r.session.__operators[l][p].length;u++)s.push(new $(t.goal.replace(new Y(",",[new Y("=",[new M(l,!1),n]),new Y(",",[new Y("=",[new Y(r.session.__operators[l][p][u],[]),a]),new Y("=",[new Y(p,[]),o])])])),t.substitution,t));r.prepend(s)}else r.throw_error(H.error.type("atom",o,i.indicator));else r.throw_error(H.error.type("atom",a,i.indicator));else r.throw_error(H.error.type("integer",n,i.indicator))},";/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=i.args[0],o=":/2"===i.indicator?i.args[1]:i;if(H.type.is_term(o)&&"->/2"===o.indicator){var s=":/2"===i.indicator?new Y(":",[a,new Y("call",[o.args[0]])]):o.args[0],l=":/2"===i.indicator?new Y(":",[a,o.args[1]]):o.args[1],p=n,u=r.goal.replace(new Y(",",[s,new Y(",",[new Y("!"),l])])),_=r.goal.replace(new Y(",",[new Y("!"),p]));e.prepend([new $(u,r.substitution,r),new $(_,r.substitution,r)])}else if(H.type.is_term(o)&&"*->/2"===o.indicator){s=":/2"===i.indicator?new Y(":",[a,o.args[0]]):o.args[0],l=":/2"===i.indicator?new Y(":",[a,o.args[1]]):o.args[1],p=n;e.prepend([new $(r.goal.replace(new Y("$if",[s,l,p])),r.substitution,r)])}else e.prepend([new $(r.goal.replace(i),r.substitution,r),new $(r.goal.replace(n),r.substitution,r)])},"!/0":function(e,r,t){var i,n,a=[];for(i=r,n=null;null!==i.parent&&i.parent.goal.search(t);)if(n=i,null!==(i=i.parent).goal){var o=i.goal.select();if(o&&":/2"===o.indicator&&(o=o.args[1]),o&&"call"===o.id&&o.search(t)){i=n;break}}for(var s=null,l=e.points.length-1;l>=0;l--){for(var p=e.points[l],u=p.parent;null!==u&&u!==i.parent;)u=u.parent;null===u&&u!==i.parent?a.push(p):p.setup_call_cleanup_goal&&(s=p.setup_call_cleanup_goal)}e.points=a.reverse(),e.prepend([new $(r.goal.replace(s),r.substitution,r)])},"\\+/1":function(e,r,t){var i=t.args[0];H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(i)?e.prepend([new $(r.goal.replace(new Y(",",[new Y(",",[new Y("call",[i]),new Y("!",[])]),new Y("fail",[])])),r.substitution,r),new $(r.goal.replace(null),r.substitution,r)]):e.throw_error(H.error.type("callable",i,t.indicator))},"->/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=r.goal.replace(new Y(",",[new Y("call",[i]),new Y(",",[new Y("!"),n])]));e.prepend([new $(a,r.substitution,r)])},"*->/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=r.goal.replace(new Y(",",[new Y("call",[i]),n]));e.prepend([new $(a,r.substitution,r)])},"fail/0":function(e,r,t){},"false/0":function(e,r,t){},"true/0":function(e,r,t){e.success(r)},"call/1":E(1),"call/2":E(2),"call/3":E(3),"call/4":E(4),"call/5":E(5),"call/6":E(6),"call/7":E(7),"call/8":E(8),"once/1":function(e,r,t){var i=t.args[0];e.prepend([new $(r.goal.replace(new Y(",",[new Y("call",[i]),new Y("!",[])])),r.substitution,r)])},"forall/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.prepend([new $(r.goal.replace(new Y("\\+",[new Y(",",[new Y("call",[i]),new Y("\\+",[new Y("call",[n])])])])),r.substitution,r)])},"repeat/0":function(e,r,t){e.prepend([new $(r.goal.replace(null),r.substitution,r),r])},"throw/1":function(e,r,t){var i=t.args[0];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(e.level.indicator));else{for(var n=0;n<e.points.length;n++){var a=e.points[n];if(a.setup_call_cleanup_catch)return void(e.points=[new $(new Y(",",[new Y("catch",[a.setup_call_cleanup_catch,new X("_"),new Y("throw",[i])]),new Y("throw",[i])]),r.substitution,r)])}e.throw_error(i)}},"catch/3":function(e,r,t){var i,n=t.args[0],a=t.args[1],o=t.args[2];r.catch?i=r.catch:((i=new L(e.session)).debugger=e.debugger,i.format_success=function(e){return e.substitution},i.format_error=function(e){return e.goal},i.add_goal(n,!0,r),r.catch=i);return i.answer((function(t){if(H.type.is_error(t)){var i="true/0"===e.get_flag("occurs_check").indicator,n=new $,s=H.unify(t.args[0],a,i);null!==s?(n.substitution=r.substitution.apply(s),n.goal=r.goal.replace(o).apply(s),n.parent=r,e.prepend([n])):e.throw_error(t.args[0])}else if(!1!==t&&null!==t){n=null===t?[]:new $(r.goal.apply(t).replace(null),r.substitution.apply(t),r);e.prepend([n,r])}else null===t&&(e.prepend([r]),e.has_limit&&(e.current_limit=0));e.again(null!==t)})),!0},"call_cleanup/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i)||H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_callable(i)){if(H.type.is_callable(n)){var a,o;if(r.hasOwnProperty("setup_call_cleanup_thread"))a=r.setup_call_cleanup_thread,o=r.setup_call_cleanup_callback;else{var s=new Y("call",[i]);(a=new L(e.session)).add_goal(s,!0,r),o=function(t){if(null===t)(s=new $(r.goal,r.substitution,r)).setup_call_cleanup_thread=a,s.setup_call_cleanup_callback=o,e.prepend([s]);else if(!1===t){var i=new Y(",",[new Y("call",[n]),new Y("fail")]),s=new $(r.goal.replace(i),r.substitution,r);e.prepend([s])}else if(H.type.is_error(t)){var l=new Y(",",[new Y("call",[n]),t]);s=new $(r.goal.replace(l),r.substitution,r);e.prepend([s])}else if(0===a.points.length){s=new $(r.goal.replace(new Y("call",[n])).apply(t),r.substitution.apply(t),r);e.prepend([s])}else{var p=new $(r.goal.apply(t).replace(null),r.substitution.apply(t),r),u=new $(r.goal,r.substitution,r);u.setup_call_cleanup_thread=a,u.setup_call_cleanup_callback=o,u.setup_call_cleanup_goal=n.apply(t),u.setup_call_cleanup_catch=n,e.prepend([p,u])}e.again()}}return a.answer(o),!0}e.throw_error(H.error.type("callable",n,t.indicator))}else e.throw_error(H.error.type("callable",i,t.indicator))},"setup_call_cleanup/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];H.type.is_variable(i)||H.type.is_variable(n)||H.type.is_variable(a)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(i)?H.type.is_callable(n)?H.type.is_callable(a)?e.prepend([new $(r.goal.replace(new Y(",",[new Y("once",[i]),new Y("call_cleanup",[n,a])])),r.substitution,r)]):e.throw_error(H.error.type("callable",a,t.indicator)):e.throw_error(H.error.type("callable",n,t.indicator)):e.throw_error(H.error.type("callable",i,t.indicator))},"=/2":function(e,r,t){var i="true/0"===e.get_flag("occurs_check").indicator,n=new $,a=H.unify(t.args[0],t.args[1],i);null!==a&&(n.goal=r.goal.apply(a).replace(null),n.substitution=r.substitution.apply(a),n.parent=r,e.prepend([n]))},"unify_with_occurs_check/2":function(e,r,t){var i=new $,n=H.unify(t.args[0],t.args[1],!0);null!==n&&(i.goal=r.goal.apply(n).replace(null),i.substitution=r.substitution.apply(n),i.parent=r,e.prepend([i]))},"\\=/2":function(e,r,t){var i="true/0"===e.get_flag("occurs_check").indicator;null===H.unify(t.args[0],t.args[1],i)&&e.success(r)},"subsumes_term/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=e.next_free_variable(),o=e.next_free_variable();e.prepend([new $(r.goal.replace(new Y("\\+",[new Y("\\+",[new Y(",",[new Y("term_variables",[n,a]),new Y(",",[new Y("unify_with_occurs_check",[i,n]),new Y(",",[new Y("term_variables",[a,o]),new Y("==",[a,o])])])])])])),r.substitution,r)])},"findall/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2],o=new Y("[]",[]);e.prepend([new $(r.goal.replace(new Y("findall",[i,n,a,o])),r.substitution,r)])},"findall/4":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2],o=t.args[3],s=n;H.type.is_term(n)&&":/2"===n.indicator&&(s=n.args[1]),H.type.is_variable(s)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(s)?H.type.is_variable(a)||H.type.is_list(a)?H.type.is_variable(o)||H.type.is_list(o)?e.prepend([new $(r.goal.replace(new Y("$findall",[i,n,a,o])),r.substitution,r)]):e.throw_error(H.error.type("list",o,t.indicator)):e.throw_error(H.error.type("list",a,t.indicator)):e.throw_error(H.error.type("callable",n,t.indicator))},"bagof/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(n)?H.type.is_variable(a)||H.type.is_list(a)?e.prepend([new $(r.goal.replace(new Y("$bagof",[i,n,a])),r.substitution,r)]):e.throw_error(H.error.type("list",a,t.indicator)):e.throw_error(H.error.type("callable",n,t.indicator))},"setof/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(n)?H.type.is_variable(a)||H.type.is_list(a)?e.prepend([new $(r.goal.replace(new Y("$setof",[i,n,a])),r.substitution,r)]):e.throw_error(H.error.type("list",a,t.indicator)):e.throw_error(H.error.type("callable",n,t.indicator))},"functor/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i)&&(H.type.is_variable(n)||H.type.is_variable(a)))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(a)||H.type.is_integer(a))if(H.type.is_variable(n)||H.type.is_atomic(n))if(H.type.is_variable(i)&&!H.type.is_atom(n)&&H.type.is_integer(a)&&a.value>0)e.throw_error(H.error.type("atom",t.args[1],t.indicator));else if(H.type.is_variable(i)&&H.type.is_integer(a)&&a.value<0)e.throw_error(H.error.domain("not_less_than_zero",t.args[2],t.indicator));else if(H.type.is_variable(i)){if(t.args[2].value>=0){for(var o=[],s=0;s<a.value;s++)o.push(e.next_free_variable());var l=H.type.is_number(n)?n:new Y(n.id,o);e.prepend([new $(r.goal.replace(new Y("=",[i,l])),r.substitution,r)])}}else{var p=H.type.is_number(i)?i:new Y(i.id,[]),u=H.type.is_number(i)?new M(0,!1):new M(i.args.length,!1),_=new Y(",",[new Y("=",[p,n]),new Y("=",[u,a])]);e.prepend([new $(r.goal.replace(_),r.substitution,r)])}else e.throw_error(H.error.type("atomic",t.args[1],t.indicator));else e.throw_error(H.error.type("integer",t.args[2],t.indicator))},"arg/3":function(e,r,t){if(H.type.is_variable(t.args[0])||H.type.is_variable(t.args[1]))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_integer(t.args[0]))if(t.args[0].value<0)e.throw_error(H.error.domain("not_less_than_zero",t.args[0],t.indicator));else if(H.type.is_compound(t.args[1])){var i=t.args[0].value;if(i>0&&i<=t.args[1].args.length){var n=new Y("=",[t.args[1].args[i-1],t.args[2]]);e.prepend([new $(r.goal.replace(n),r.substitution,r)])}}else e.throw_error(H.error.type("compound",t.args[1],t.indicator));else e.throw_error(H.error.type("integer",t.args[0],t.indicator))},"=../2":function(e,r,t){var i;if(H.type.is_variable(t.args[0])&&(H.type.is_variable(t.args[1])||H.type.is_non_empty_list(t.args[1])&&H.type.is_variable(t.args[1].args[0])))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_fully_list(t.args[1]))if(H.type.is_variable(t.args[0])&&H.type.is_empty_list(t.args[1]))e.throw_error(H.error.domain("non_empty_list",t.args[1],t.indicator));else if(H.type.is_variable(t.args[0])){if(!H.type.is_variable(t.args[1])){var n=[];for(i=t.args[1].args[1];"./2"===i.indicator;)n.push(i.args[0]),i=i.args[1];H.type.is_variable(t.args[0])&&H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):0===n.length&&H.type.is_compound(t.args[1].args[0])?e.throw_error(H.error.type("atomic",t.args[1].args[0],t.indicator)):n.length>0&&(H.type.is_compound(t.args[1].args[0])||H.type.is_number(t.args[1].args[0]))?e.throw_error(H.error.type("atom",t.args[1].args[0],t.indicator)):0===n.length?e.prepend([new $(r.goal.replace(new Y("=",[t.args[1].args[0],t.args[0]],r)),r.substitution,r)]):e.prepend([new $(r.goal.replace(new Y("=",[new Y(t.args[1].args[0].id,n),t.args[0]])),r.substitution,r)])}}else{if(H.type.is_term(t.args[0])&&t.args[0].args.length>0){i=new Y("[]");for(var a=t.args[0].args.length-1;a>=0;a--)i=new Y(".",[t.args[0].args[a],i]);i=new Y(".",[new Y(t.args[0].id),i])}else i=new Y(".",[t.args[0],new Y("[]")]);e.prepend([new $(r.goal.replace(new Y("=",[i,t.args[1]])),r.substitution,r)])}else e.throw_error(H.error.type("list",t.args[1],t.indicator))},"copy_term/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.session.renamed_variables={};var a=i.rename(e);e.session.renamed_variables={},e.prepend([new $(r.goal.replace(new Y("=",[n,a])),r.substitution,r)])},"term_variables/2":[new H.type.Rule(new H.type.Term("term_variables",[new H.type.Var("Term"),new H.type.Var("Vars")]),new H.type.Term("term_variables",[new H.type.Var("Term"),new H.type.Var("Vars"),new H.type.Term("[]",[])]))],"term_variables/3":function(e,r,t){var i=t.args[0],n=t.args[1],o=t.args[2];if(H.type.is_fully_list(n)){var s=V(a(P(i.variables()),(function(e){return new X(e)})),o);e.prepend([new $(r.goal.replace(new Y("=",[n,s])),r.substitution,r)])}else e.throw_error(H.error.type("list",n,t.indicator))},"numbervars/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_integer(n))if(H.type.is_variable(a)||H.type.is_integer(a)){for(var o=P(i.variables()),s=n.value,l=new Y("true"),p=0;p<o.length;p++)l=new Y(",",[new Y("=",[new X(o[p]),new Y("$VAR",[new M(s,!1)])]),l]),s++;var u=new Y("=",[a,new M(s,!1)]);(H.type.is_variable(a)||a.value===s)&&e.prepend([new $(r.goal.replace(new Y(",",[l,u])),r.substitution,r)])}else e.throw_error(H.error.type("integer",a,t.indicator));else e.throw_error(H.error.type("integer",n,t.indicator))},"clause/2":function(e,r,t){var i=t.args[0],n=t.args[1],a="user";if(H.type.is_term(i)&&":/2"===i.indicator){if(!H.type.is_atom(i.args[0]))return void e.throw_error(H.error.type("module",i.args[0],t.indicator));a=i.args[0].id,i=i.args[1]}var o=e.session.modules[a];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_callable(i))if(H.type.is_variable(n)||H.type.is_callable(n)){if(",/2"===i.indicator||e.session.modules.system.rules.hasOwnProperty(i.indicator))e.throw_error(H.error.permission("access","private_procedure",R(i.indicator),t.indicator));else if(H.type.is_module(o)&&o.rules[i.indicator])if(o.is_public_predicate(i.indicator)){var s=[];if("function"==typeof o.rules[i.indicator])return void e.throw_error(H.error.permission("modify","static_procedure",R(i.indicator),t.indicator));for(var l=0;l<o.rules[i.indicator].length;l++){var p=o.rules[i.indicator][l];e.session.renamed_variables={},null===(p=p.rename(e)).body&&(p.body=new Y("true"));var u=new Y(",",[new Y("=",[p.head,i]),new Y("=",[p.body,n])]);s.push(new $(r.goal.replace(u),r.substitution,r))}e.prepend(s)}else e.throw_error(H.error.permission("access","private_procedure",R(i.indicator),t.indicator))}else e.throw_error(H.error.type("callable",n,t.indicator));else e.throw_error(H.error.type("callable",i,t.indicator))},"current_predicate/1":function(e,r,t){var i,n=t.args[0];if(H.type.is_term(n)&&":/2"===n.indicator){if(!H.type.is_atom(n.args[0]))return void e.throw_error(H.error.type("module",n.args[0],t.indicator));i=n.args[0].id,n=n.args[1]}else i="user";if(H.type.is_variable(n)||H.type.is_compound(n)&&"//2"===n.indicator)if(H.type.is_variable(n)||H.type.is_variable(n.args[0])||H.type.is_atom(n.args[0]))if(H.type.is_variable(n)||H.type.is_variable(n.args[1])||H.type.is_integer(n.args[1]))if(!H.type.is_variable(n)&&H.type.is_integer(n.args[1])&&n.args[1].value<0)e.throw_error(H.error.domain("not_less_than_zero",n.args[1],t.indicator));else{var a=[],o=e.session.modules[i];if(H.type.is_module(o)){for(var s in o.rules)if(o.rules.hasOwnProperty(s)){var l=new Y("=",[R(s),n]);a.push(new $(r.goal.replace(l),r.substitution,r))}e.prepend(a)}}else e.throw_error(H.error.type("integer",n.args[1],t.indicator));else e.throw_error(H.error.type("atom",n.args[0],t.indicator));else e.throw_error(H.error.type("predicate_indicator",n,t.indicator))},"current_module/1":function(e,r,t){var i=t.args[0];if(H.type.is_variable(i)||H.type.is_atom(i))if(H.type.is_variable(i)){var n=[];for(var a in e.session.modules)e.session.modules.hasOwnProperty(a)&&n.push(new $(r.goal.replace(new Y("=",[i,new Y(a)])),r.substitution,r));e.prepend(n)}else e.session.modules.hasOwnProperty(i.id)&&e.success(r);else e.throw_error(H.error.type("atom",i,t.indicator))},"predicate_property/2":function(e,r,t){var i,n=t.args[0],a=t.args[1];if(H.type.is_term(n)&&":/2"===n.indicator){if(!H.type.is_atom(n.args[0]))return void e.throw_error(H.error.type("module",n.args[0],t.indicator));i=n.args[0].id,n=n.args[1]}if(H.type.is_variable(n)||H.type.is_callable(n))if(H.type.is_variable(a)||H.type.is_predicate_property(a)){var o=i?e.session.modules[i]:e.session.modules.user,s=[];if(H.type.is_variable(n)){if(!i)for(var l in H.builtin.rules)if(H.builtin.rules.hasOwnProperty(l)){for(var p=R(l),u=[],_=0;_<p.args[1].value;_++)u.push(e.next_free_variable());var c=new Y(p.args[0].id,u),d=[new Y("static"),new Y("built_in"),new Y("native_code")];H.builtin.meta_predicates.hasOwnProperty(l)&&d.push(new Y("meta_predicate",[H.builtin.meta_predicates[l]]));for(_=0;_<d.length;_++)(H.type.is_variable(a)||d[_].indicator===a.indicator)&&s.push(new $(r.goal.replace(new Y(",",[new Y("=",[n,c]),new Y("=",[a,d[_]])])),r.substitution,r))}if(H.type.is_module(o))for(var l in o.rules)if(o.rules.hasOwnProperty(l)){for(p=R(l),u=[],_=0;_<p.args[1].value;_++)u.push(e.next_free_variable());c=new Y(p.args[0].id,u),d=[];e.is_public_predicate(l,i)?d.push(new Y("dynamic")):d.push(new Y("static")),o.rules[l]instanceof Function&&d.push(new Y("native_code")),e.is_multifile_predicate(l,i)&&d.push(new Y("multifile")),o.meta_predicates.hasOwnProperty(l)&&d.push(new Y("meta_predicate",[o.meta_predicates[l]]));for(_=0;_<d.length;_++)(H.type.is_variable(a)||d[_].indicator===a.indicator)&&s.push(new $(r.goal.replace(new Y(",",[new Y("=",[n,c]),new Y("=",[a,d[_]])])),r.substitution,r))}}else{var w=!i&&H.type.is_builtin(n),f=w?H.builtin.rules[n.indicator]:o.rules[n.indicator];if(o=w?H.builtin:o,f){w?d=[new Y("static"),new Y("built_in"),new Y("native_code")]:(d=[],e.is_public_predicate(n.indicator,i)?d.push(new Y("dynamic")):d.push(new Y("static")),f instanceof Function&&d.push(new Y("native_code")),e.is_multifile_predicate(n.indicator,i)&&d.push(new Y("multifile"))),o.meta_predicates.hasOwnProperty(n.indicator)&&d.push(new Y("meta_predicate",[o.meta_predicates[n.indicator]]));for(u=[],_=0;_<n.args.length;_++)u.push(e.next_free_variable());for(c=new Y(n.id,u),_=0;_<d.length;_++)(H.type.is_variable(a)||d[_].indicator===a.indicator)&&s.push(new $(r.goal.replace(new Y(",",[new Y("=",[n,c]),new Y("=",[a,d[_]])])),r.substitution,r))}}e.prepend(s)}else e.throw_error(H.error.domain("predicate_property",a,t.indicator));else e.throw_error(H.error.type("callable",n,t.indicator))},"listing/0":function(e,r,t){var i=t.context_module?t.context_module:"user",n={};H.type.is_module(e.session.modules[i])&&(n=e.session.modules[i].rules);var a="";for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];if(a+="% "+o+"\n",s instanceof Array)for(var l=0;l<s.length;l++)a+=s[l].toString({session:e.session})+"\n";else a+="/*\n"+s.toString()+"\n*/";a+="\n"}e.prepend([new $(r.goal.replace(new Y("write",[new Y(a,[])])),r.substitution,r)])},"listing/1":function(e,r,t){var i=t.args[0],n="user";if(":/2"===i.indicator&&(n=i.args[0].id,i=i.args[1]),H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_predicate_indicator(i)){var a={};H.type.is_module(e.session.modules[n])&&(a=e.session.modules[n].rules);var o="",s=i.args[0].id+"/"+i.args[1].value;if(a.hasOwnProperty(s)){var l=a[s];if(l instanceof Array)for(var p=0;p<l.length;p++)o+=l[p].toString({session:e.session})+"\n";else o+="/*\n"+l.toString()+"\n*/";o+="\n"}e.prepend([new $(r.goal.replace(new Y("write",[new Y(o,[])])),r.substitution,r)])}else e.throw_error(H.error.type("predicate_indicator",i,t.indicator))},"sort/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_fully_list(n)){for(var a=[],o=i;"./2"===o.indicator;)a.push(o.args[0]),o=o.args[1];if(H.type.is_variable(o))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_empty_list(o)){for(var s=a.sort(H.compare),l=s.length-1;l>0;l--)s[l].equals(s[l-1])&&s.splice(l,1);var p=new Y("[]");for(l=s.length-1;l>=0;l--)p=new Y(".",[s[l],p]);e.prepend([new $(r.goal.replace(new Y("=",[p,n])),r.substitution,r)])}else e.throw_error(H.error.type("list",i,t.indicator))}else e.throw_error(H.error.type("list",n,t.indicator))},"keysort/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_fully_list(n)){for(var a,o=[],s=i;"./2"===s.indicator;){if(a=s.args[0],H.type.is_variable(a))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_term(a)||"-/2"!==a.indicator)return void e.throw_error(H.error.type("pair",a,t.indicator));a.args[0].pair=a.args[1],o.push(a.args[0]),s=s.args[1]}if(H.type.is_variable(s))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_empty_list(s)){if(!H.type.is_variable(n)){for(s=n;H.type.is_term(s)&&"./2"===s.indicator;){var l=s.args[0];if(!(H.type.is_variable(l)||H.type.is_term(l)&&"-/2"===l.indicator))return void e.throw_error(H.error.type("pair",l,t.indicator));s=s.args[1]}if(!H.type.is_variable(s)&&!H.type.is_empty_list(s))return void e.throw_error(H.error.type("list",n,t.indicator))}for(var p=o.sort(H.compare),u=new H.type.Term("[]"),_=p.length-1;_>=0;_--)u=new H.type.Term(".",[new H.type.Term("-",[p[_],p[_].pair]),u]),delete p[_].pair;e.prepend([new H.type.State(r.goal.replace(new H.type.Term("=",[u,n])),r.substitution,r)])}else e.throw_error(H.error.type("list",i,t.indicator))}else e.throw_error(H.error.type("list",n,t.indicator))},"keygroup/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_fully_list(n)){for(var a=[],o=[],s=i;H.type.is_term(s)&&"./2"===s.indicator;){var l=s.args[0];if(H.type.is_variable(l))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_term(l)||"-/2"!==l.indicator)return void e.throw_error(H.error.type("pair",l,t.indicator));for(var p=l.args[0],u=l.args[1],_=-1,c=0;c<a.length;c++)if(0===H.compare(p,a[c])){_=c;break}-1===_&&(_=a.length,a.push(p),o.push([])),o[_].push(u),s=s.args[1]}if(H.type.is_variable(s))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_empty_list(s)){if(!H.type.is_variable(n)){for(s=n;H.type.is_term(s)&&"./2"===s.indicator;){var d=s.args[0];if(!(H.type.is_variable(d)||H.type.is_term(d)&&"-/2"===d.indicator))return void e.throw_error(H.error.type("pair",d,t.indicator));s=s.args[1]}if(!H.type.is_variable(s)&&!H.type.is_empty_list(s))return void e.throw_error(H.error.type("list",n,t.indicator))}group=new Y("[]",[]);for(c=a.length-1;c>=0;c--)group=new Y(".",[new Y("-",[a[c],V(o[c])]),group]);e.prepend([new $(r.goal.replace(new H.type.Term("=",[n,group])),r.substitution,r)])}else e.throw_error(H.error.type("list",i,t.indicator))}else e.throw_error(H.error.type("list",n,t.indicator))},"asserta/1":function(e,r,t){var i=t.args[0],n="user";if(H.type.is_term(i)&&":/2"===i.indicator&&(n=i.args[0].id,i=i.args[1]),H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_callable(i)){var a,o,s;":-/2"===i.indicator?(a=i.args[0],o=O(i.args[1])):(a=i,o=null),H.type.is_variable(a)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(a)?null===o||H.type.is_callable(o)?H.type.is_module(e.session.modules[n])&&!e.is_public_predicate(a.indicator,n)||",/2"===a.indicator||e.session.modules.system.rules.hasOwnProperty(a.indicator)?e.throw_error(H.error.permission("modify","static_procedure",R(a.indicator),t.indicator)):(H.type.is_module(e.session.modules[n])?s=e.session.modules[n]:(s=new j(n,{},"all",{session:e.session}),e.session.modules[n]=s),void 0===s.rules[a.indicator]&&(s.rules[a.indicator]=[]),s.public_predicates[a.indicator]=!0,s.rules[a.indicator]=[new z(a,o,!0)].concat(s.rules[a.indicator]),s.update_indices_predicate(a.indicator),e.success(r)):e.throw_error(H.error.type("callable",o,t.indicator)):e.throw_error(H.error.type("callable",a,t.indicator))}else e.throw_error(H.error.type("callable",i,t.indicator))},"assertz/1":function(e,r,t){var i=t.args[0],n="user";if(H.type.is_term(i)&&":/2"===i.indicator&&(n=i.args[0].id,i=i.args[1]),H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_callable(i)){var a,o,s;":-/2"===i.indicator?(a=i.args[0],o=O(i.args[1])):(a=i,o=null),H.type.is_variable(a)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(a)?null===o||H.type.is_callable(o)?H.type.is_module(e.session.modules[n])&&!e.is_public_predicate(a.indicator,n)||",/2"===a.indicator||e.session.modules.system.rules.hasOwnProperty(a.indicator)?e.throw_error(H.error.permission("modify","static_procedure",R(a.indicator),t.indicator)):(H.type.is_module(e.session.modules[n])?s=e.session.modules[n]:(s=new j(n,{},"all",{session:e.session}),e.session.modules[n]=s),void 0===s.rules[a.indicator]&&(s.rules[a.indicator]=[]),s.public_predicates[a.indicator]=!0,s.rules[a.indicator].push(new z(a,o,!0)),s.update_indices_predicate(a.indicator),e.success(r)):e.throw_error(H.error.type("callable",o,t.indicator)):e.throw_error(H.error.type("callable",a,t.indicator))}else e.throw_error(H.error.type("callable",i,t.indicator))},"retract/1":function(e,r,t){var i=t.args[0];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_callable(i)){var n,a,o,s;if(":/2"===i.indicator){if(o=i.args[0],i=i.args[1],!H.type.is_atom(o))return void e.throw_error(H.error.type("module",o,t.indicator))}else o=new Y("user");if(":-/2"===i.indicator?(n=i.args[0],a=i.args[1]):(n=i,a=new Y("true")),H.type.is_variable(n))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_callable(n))return void e.throw_error(H.error.type("callable",n,t.indicator));s=o.id;var l=e.session.modules[s];if(!H.type.is_module(l))return;if(r.retract)!function(e,r,t,i,n){if(n.rules[t])for(var a=0;a<n.rules[t].length;a++)if(n.rules[t][a]===i){n.rules[t].splice(a,1),n.update_indices_predicate(t),e.success(r);break}}(e,r,n.indicator,r.retract,l);else if(e.is_public_predicate(n.indicator,s)&&",/2"!==n.indicator&&!e.session.modules.system.rules.hasOwnProperty(n.indicator)){if(void 0!==l.rules[n.indicator]){var p=[];if("function"==typeof l.rules[n.indicator])return void e.throw_error(H.error.permission("modify","static_procedure",R(n.indicator),t.indicator));for(var u=0;u<l.rules[n.indicator].length;u++){e.session.renamed_variables={};var _=l.rules[n.indicator][u],c=_.rename(e);null===c.body&&(c.body=new Y("true",[]));var d="true/0"===e.get_flag("occurs_check").indicator;if(null!==H.unify(new Y(",",[n,a]),new Y(",",[c.head,c.body]),d)){var w=new $(r.goal.replace(new Y(",",[new Y(":",[o,new Y("retract",[new Y(":-",[n,a])])]),new Y(",",[new Y("=",[n,c.head]),new Y("=",[a,c.body])])])),r.substitution,r);w.retract=_,p.push(w)}}e.prepend(p)}}else e.throw_error(H.error.permission("modify","static_procedure",R(n.indicator),t.indicator))}else e.throw_error(H.error.type("callable",i,t.indicator))},"retractall/1":function(e,r,t){var i=t.args[0],n="user";H.type.is_term(i)&&":/2"===i.indicator&&(n=i.args[0].id,i=i.args[1]),H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_callable(i)?!e.is_public_predicate(i.indicator,n)||",/2"===i.indicator||e.session.modules.system.rules.hasOwnProperty(i.indicator)?e.throw_error(H.error.permission("modify","static_procedure",R(i.indicator),t.indicator)):e.prepend([new $(r.goal.replace(new Y(",",[new Y(":",[new Y(n),new Y("retract",[new H.type.Term(":-",[i,new X("_")])])]),new Y("fail",[])])),r.substitution,r),new $(r.goal.replace(null),r.substitution,r)]):e.throw_error(H.error.type("callable",i,t.indicator))},"abolish/1":function(e,r,t){var i,n=t.args[0];if(H.type.is_term(n)&&":/2"===n.indicator){if(!H.type.is_atom(n.args[0]))return void e.throw_error(H.error.type("module",n.args[0],t.indicator));i=n.args[0].id,n=n.args[1]}else i="user";if(H.type.is_variable(n)||H.type.is_term(n)&&"//2"===n.indicator&&(H.type.is_variable(n.args[0])||H.type.is_variable(n.args[1])))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_term(n)&&"//2"===n.indicator)if(H.type.is_atom(n.args[0]))if(H.type.is_integer(n.args[1]))if(n.args[1].value<0)e.throw_error(H.error.domain("not_less_than_zero",n.args[1],t.indicator));else if(H.type.is_number(e.get_flag("max_arity"))&&n.args[1].value>e.get_flag("max_arity").value)e.throw_error(H.error.representation("max_arity",t.indicator));else{var a=e.session.modules[i];if(H.type.is_module(a)){var o=n.args[0].id+"/"+n.args[1].value;e.is_public_predicate(o,i)&&",/2"!==o&&!e.session.modules.system.rules.hasOwnProperty(o)?(delete a.rules[o],delete a.indexed_clauses[o],delete a.non_indexable_clauses[o],delete a.public_predicates[o],delete a.multifile_predicates[o],e.success(r)):e.throw_error(H.error.permission("modify","static_procedure",t.args[0],t.indicator))}else e.success(r)}else e.throw_error(H.error.type("integer",n.args[1],t.indicator));else e.throw_error(H.error.type("atom",n.args[0],t.indicator));else e.throw_error(H.error.type("predicate_indicator",n,t.indicator))},"atom_length/2":function(e,r,t){if(H.type.is_variable(t.args[0]))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_atom(t.args[0]))if(H.type.is_variable(t.args[1])||H.type.is_integer(t.args[1]))if(H.type.is_integer(t.args[1])&&t.args[1].value<0)e.throw_error(H.error.domain("not_less_than_zero",t.args[1],t.indicator));else{var i=new M(p(t.args[0].id),!1);e.prepend([new $(r.goal.replace(new Y("=",[i,t.args[1]])),r.substitution,r)])}else e.throw_error(H.error.type("integer",t.args[1],t.indicator));else e.throw_error(H.error.type("atom",t.args[0],t.indicator))},"atom_concat/3":function(e,r,t){var i,n,a=t.args[0],o=t.args[1],s=t.args[2];if(H.type.is_variable(s)&&(H.type.is_variable(a)||H.type.is_variable(o)))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(a)||H.type.is_atom(a))if(H.type.is_variable(o)||H.type.is_atom(o))if(H.type.is_variable(s)||H.type.is_atom(s)){var l=H.type.is_variable(a),p=H.type.is_variable(o);if(l||p)if(l&&!p)(i=s.id.substr(0,s.id.length-o.id.length))+o.id===s.id&&(n=new Y("=",[a,new Y(i)]),e.prepend([new $(r.goal.replace(n),r.substitution,r)]));else if(p&&!l)i=s.id.substr(a.id.length),a.id+i===s.id&&(n=new Y("=",[o,new Y(i)]),e.prepend([new $(r.goal.replace(n),r.substitution,r)]));else{for(var u=[],_=0;_<=s.id.length;_++){var c=new Y(s.id.substr(0,_)),d=new Y(s.id.substr(_));n=new Y(",",[new Y("=",[c,a]),new Y("=",[d,o])]),u.push(new $(r.goal.replace(n),r.substitution,r))}e.prepend(u)}else n=new Y("=",[s,new Y(a.id+o.id)]),e.prepend([new $(r.goal.replace(n),r.substitution,r)])}else e.throw_error(H.error.type("atom",s,t.indicator));else e.throw_error(H.error.type("atom",o,t.indicator));else e.throw_error(H.error.type("atom",a,t.indicator))},"sub_atom/5":function(r,t,i){var n,a=i.args[0],o=i.args[1],s=i.args[2],l=i.args[3],p=i.args[4];if(H.type.is_variable(a))r.throw_error(H.error.instantiation(i.indicator));else if(H.type.is_atom(a))if(H.type.is_variable(o)||H.type.is_integer(o))if(H.type.is_variable(s)||H.type.is_integer(s))if(H.type.is_variable(l)||H.type.is_integer(l))if(H.type.is_integer(o)&&o.value<0)r.throw_error(H.error.domain("not_less_than_zero",o,i.indicator));else if(H.type.is_integer(s)&&s.value<0)r.throw_error(H.error.domain("not_less_than_zero",s,i.indicator));else if(H.type.is_integer(l)&&l.value<0)r.throw_error(H.error.domain("not_less_than_zero",l,i.indicator));else if(H.type.is_variable(p)||H.type.is_atom(p)){var u=[],_=[],c=[];if(H.type.is_variable(o))for(n=0;n<=a.id.length;n++)u.push(n);else u.push(o.value);if(H.type.is_variable(s))for(n=0;n<=a.id.length;n++)_.push(n);else _.push(s.value);if(H.type.is_variable(l))for(n=0;n<=a.id.length;n++)c.push(n);else c.push(l.value);var d=[];for(var w in u)if(u.hasOwnProperty(w))for(var f in n=u[w],_)if(_.hasOwnProperty(f)){var y=_[f],h=a.id.length-n-y;if(-1!==e(c,h)&&n+y+h===a.id.length){var g=a.id.substr(n,y);if(a.id===a.id.substr(0,n)+g+a.id.substr(n+y,h)){var v=new Y("=",[new Y(g),p]),m=new Y("=",[o,new M(n)]),b=new Y("=",[s,new M(y)]),x=new Y("=",[l,new M(h)]),k=new Y(",",[new Y(",",[new Y(",",[m,b]),x]),v]);d.push(new $(t.goal.replace(k),t.substitution,t))}}}r.prepend(d)}else r.throw_error(H.error.type("atom",p,i.indicator));else r.throw_error(H.error.type("integer",l,i.indicator));else r.throw_error(H.error.type("integer",s,i.indicator));else r.throw_error(H.error.type("integer",o,i.indicator));else r.throw_error(H.error.type("atom",a,i.indicator))},"atom_chars/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i)&&H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(i)||H.type.is_atom(i))if(H.type.is_variable(i)){s=n;for(var a=H.type.is_variable(i),o="";"./2"===s.indicator;){if(H.type.is_character(s.args[0]))o+=s.args[0].id;else{if(H.type.is_variable(s.args[0])&&a)return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_variable(s.args[0]))return void e.throw_error(H.error.type("character",s.args[0],t.indicator))}s=s.args[1]}H.type.is_variable(s)&&a?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_empty_list(s)||H.type.is_variable(s)?e.prepend([new $(r.goal.replace(new Y("=",[new Y(o),i])),r.substitution,r)]):e.throw_error(H.error.type("list",n,t.indicator))}else{if(!H.type.is_variable(n))for(var s=n;H.type.is_term(s)&&"./2"===s.indicator;){if(!H.type.is_character(s.args[0])&&!H.type.is_variable(s.args[0]))return void e.throw_error(H.error.type("character",s.args[0],t.indicator));s=s.args[1]}for(var l=new Y("[]"),u=p(i.id)-1;u>=0;u--)l=new Y(".",[new Y(i.id.charAt(u)),l]);e.prepend([new $(r.goal.replace(new Y("=",[n,l])),r.substitution,r)])}else e.throw_error(H.error.type("atom",i,t.indicator))},"atom_codes/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i)&&H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(i)||H.type.is_atom(i))if(H.type.is_variable(i)){u=n;for(var a=H.type.is_variable(i),o="";"./2"===u.indicator;){if(H.type.is_character_code(u.args[0]))o+=l(u.args[0].value);else{if(H.type.is_variable(u.args[0])&&a)return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_variable(u.args[0]))return void e.throw_error(H.error.representation("character_code",t.indicator))}u=u.args[1]}H.type.is_variable(u)&&a?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_empty_list(u)||H.type.is_variable(u)?e.prepend([new $(r.goal.replace(new Y("=",[new Y(o),i])),r.substitution,r)]):e.throw_error(H.error.type("list",n,t.indicator))}else{if(!H.type.is_variable(n))for(var u=n;H.type.is_term(u)&&"./2"===u.indicator;){if(!H.type.is_character_code(u.args[0])&&!H.type.is_variable(u.args[0]))return void e.throw_error(H.error.type("integer",u.args[0],t.indicator));u=u.args[1]}for(var _=new Y("[]"),c=p(i.id)-1;c>=0;c--)_=new Y(".",[new M(s(i.id,c),!1),_]);e.prepend([new $(r.goal.replace(new Y("=",[n,_])),r.substitution,r)])}else e.throw_error(H.error.type("atom",i,t.indicator))},"char_code/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i)&&H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(i)||H.type.is_character(i))if(H.type.is_variable(n)||H.type.is_integer(n))if(H.type.is_variable(n)||H.type.is_character_code(n))if(H.type.is_variable(n)){var a=new M(s(i.id,0),!1);e.prepend([new $(r.goal.replace(new Y("=",[a,n])),r.substitution,r)])}else{var o=new Y(l(n.value));e.prepend([new $(r.goal.replace(new Y("=",[o,i])),r.substitution,r)])}else e.throw_error(H.error.representation("character_code",t.indicator));else e.throw_error(H.error.type("integer",n,t.indicator));else e.throw_error(H.error.type("character",i,t.indicator))},"number_chars/2":function(e,r,t){var i,n=t.args[0],a=t.args[1];if(H.type.is_variable(n)&&H.type.is_variable(a))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_number(n))if(H.type.is_variable(a)||H.type.is_list(a)){var o=H.type.is_variable(n);if(!H.type.is_variable(a)){var s=a,l=!0;for(i="";"./2"===s.indicator;){if(H.type.is_character(s.args[0]))i+=s.args[0].id;else if(H.type.is_variable(s.args[0]))l=!1;else if(!H.type.is_variable(s.args[0]))return void e.throw_error(H.error.type("character",s.args[0],t.indicator));s=s.args[1]}if(l=l&&H.type.is_empty_list(s),!H.type.is_empty_list(s)&&!H.type.is_variable(s))return void e.throw_error(H.error.type("list",a,t.indicator));if(!l&&o)return void e.throw_error(H.error.instantiation(t.indicator));if(l){if(H.type.is_variable(s)&&o)return void e.throw_error(H.error.instantiation(t.indicator));var p=e.parse(i),u=p.value;return void(!H.type.is_number(u)||p.tokens[p.tokens.length-1].space?e.throw_error(H.error.syntax_by_predicate("parseable_number",t.indicator)):e.prepend([new $(r.goal.replace(new Y("=",[n,u])),r.substitution,r)]))}}if(!o){i=n.toString();for(var _=new Y("[]"),c=i.length-1;c>=0;c--)_=new Y(".",[new Y(i.charAt(c)),_]);e.prepend([new $(r.goal.replace(new Y("=",[a,_])),r.substitution,r)])}}else e.throw_error(H.error.type("list",a,t.indicator));else e.throw_error(H.error.type("number",n,t.indicator))},"number_codes/2":function(e,r,t){var i,n=t.args[0],a=t.args[1];if(H.type.is_variable(n)&&H.type.is_variable(a))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_number(n))if(H.type.is_variable(a)||H.type.is_list(a)){var o=H.type.is_variable(n);if(!H.type.is_variable(a)){var p=a,u=!0;for(i="";"./2"===p.indicator;){if(H.type.is_character_code(p.args[0]))i+=l(p.args[0].value);else if(H.type.is_variable(p.args[0]))u=!1;else if(!H.type.is_variable(p.args[0]))return void e.throw_error(H.error.representation("character_code",t.indicator));p=p.args[1]}if(u=u&&H.type.is_empty_list(p),!H.type.is_empty_list(p)&&!H.type.is_variable(p))return void e.throw_error(H.error.type("list",a,t.indicator));if(!u&&o)return void e.throw_error(H.error.instantiation(t.indicator));if(u){if(H.type.is_variable(p)&&o)return void e.throw_error(H.error.instantiation(t.indicator));var _=e.parse(i),c=_.value;return void(!H.type.is_number(c)||_.tokens[_.tokens.length-1].space?e.throw_error(H.error.syntax_by_predicate("parseable_number",t.indicator)):e.prepend([new $(r.goal.replace(new Y("=",[n,c])),r.substitution,r)]))}}if(!o){i=n.toString();for(var d=new Y("[]"),w=i.length-1;w>=0;w--)d=new Y(".",[new M(s(i,w),!1),d]);e.prepend([new $(r.goal.replace(new Y("=",[a,d])),r.substitution,r)])}}else e.throw_error(H.error.type("list",a,t.indicator));else e.throw_error(H.error.type("number",n,t.indicator))},"upcase_atom/2":function(e,r,t){var i=t.args[0],n=t.args[1];H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_atom(i)?H.type.is_variable(n)||H.type.is_atom(n)?e.prepend([new $(r.goal.replace(new Y("=",[n,new Y(i.id.toUpperCase(),[])])),r.substitution,r)]):e.throw_error(H.error.type("atom",n,t.indicator)):e.throw_error(H.error.type("atom",i,t.indicator))},"downcase_atom/2":function(e,r,t){var i=t.args[0],n=t.args[1];H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_atom(i)?H.type.is_variable(n)||H.type.is_atom(n)?e.prepend([new $(r.goal.replace(new Y("=",[n,new Y(i.id.toLowerCase(),[])])),r.substitution,r)]):e.throw_error(H.error.type("atom",n,t.indicator)):e.throw_error(H.error.type("atom",i,t.indicator))},"atomic_concat/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i)||H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_atomic(i))if(H.type.is_atomic(n))if(H.type.is_variable(a)||H.type.is_atom(a)){var o="";H.type.is_atom(i)?o+=i.id:o+=""+i.value,H.type.is_atom(n)?o+=n.id:o+=""+n.value;t=new Y(o,[]);e.prepend([new $(r.goal.replace(new Y("=",[t,a])),r.substitution,r)])}else e.throw_error(H.error.type("atom",a,t.indicator));else e.throw_error(H.error.type("atomic",n,t.indicator));else e.throw_error(H.error.type("atomic",i,t.indicator))},"atomic_list_concat/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.prepend([new $(r.goal.replace(new Y("atomic_list_concat",[i,new Y("",[]),n])),r.substitution,r)])},"atomic_list_concat/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(n)||H.type.is_variable(i)&&H.type.is_variable(a))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(i)||H.type.is_list(i))if(H.type.is_atom(n)||H.type.is_number(n))if(H.type.is_variable(a)||H.type.is_atom(a)){for(var o="",s=i;H.type.is_term(s)&&"./2"===s.indicator;){if(H.type.is_variable(s.args[0]))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_atom(s.args[0])&&!H.type.is_number(s.args[0]))return void e.throw_error(H.error.type("atomic",s.args[0],t.indicator));""!==o&&(o+=n.id),H.type.is_atom(s.args[0])?o+=s.args[0].id:o+=""+s.args[0].value,s=s.args[1]}o=new Y(o,[]),H.type.is_variable(s)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_term(s)&&"[]/0"===s.indicator?e.prepend([new $(r.goal.replace(new Y("=",[o,a])),r.substitution,r)]):e.throw_error(H.error.type("list",i,t.indicator))}else e.throw_error(H.error.type("atom",a,t.indicator));else e.throw_error(H.error.type("atomic",n,t.indicator));else e.throw_error(H.error.type("list",i,t.indicator))},"@=</2":function(e,r,t){H.compare(t.args[0],t.args[1])<=0&&e.success(r)},"==/2":function(e,r,t){0===H.compare(t.args[0],t.args[1])&&e.success(r)},"\\==/2":function(e,r,t){0!==H.compare(t.args[0],t.args[1])&&e.success(r)},"@</2":function(e,r,t){H.compare(t.args[0],t.args[1])<0&&e.success(r)},"@>/2":function(e,r,t){H.compare(t.args[0],t.args[1])>0&&e.success(r)},"@>=/2":function(e,r,t){H.compare(t.args[0],t.args[1])>=0&&e.success(r)},"compare/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i)||H.type.is_atom(i))if(H.type.is_atom(i)&&-1===["<",">","="].indexOf(i.id))e.throw_error(H.error.domain("order",i,t.indicator));else{var o=H.compare(n,a);o=0===o?"=":-1===o?"<":">",e.prepend([new $(r.goal.replace(new Y("=",[i,new Y(o,[])])),r.substitution,r)])}else e.throw_error(H.error.type("atom",i,t.indicator))},"is/2":function(e,r,t){var i=t.args[1].interpret(e);H.type.is_number(i)?e.prepend([new $(r.goal.replace(new Y("=",[t.args[0],i],t.indicator)),r.substitution,r)]):e.throw_error(i)},"between/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(i)||H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_integer(i))if(H.type.is_integer(n))if(H.type.is_variable(a)||H.type.is_integer(a))if(H.type.is_variable(a)){if(i.value<=n.value){var o=[new $(r.goal.replace(new Y("=",[a,i])),r.substitution,r)];o.push(new $(r.goal.replace(new Y("between",[new M(i.value+1,!1),n,a])),r.substitution,r)),e.prepend(o)}}else i.value<=a.value&&n.value>=a.value&&e.success(r);else e.throw_error(H.error.type("integer",a,t.indicator));else e.throw_error(H.error.type("integer",n,t.indicator));else e.throw_error(H.error.type("integer",i,t.indicator))},"succ/2":function(e,r,t){var i=t.args[0],n=t.args[1];H.type.is_variable(i)&&H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_variable(i)||H.type.is_integer(i)?H.type.is_variable(n)||H.type.is_integer(n)?!H.type.is_variable(i)&&i.value<0?e.throw_error(H.error.domain("not_less_than_zero",i,t.indicator)):!H.type.is_variable(n)&&n.value<0?e.throw_error(H.error.domain("not_less_than_zero",n,t.indicator)):(H.type.is_variable(n)||n.value>0)&&(H.type.is_variable(i)?e.prepend([new $(r.goal.replace(new Y("=",[i,new M(n.value-1,!1)])),r.substitution,r)]):e.prepend([new $(r.goal.replace(new Y("=",[n,new M(i.value+1,!1)])),r.substitution,r)])):e.throw_error(H.error.type("integer",n,t.indicator)):e.throw_error(H.error.type("integer",i,t.indicator))},"=:=/2":function(e,r,t){var i=H.arithmetic_compare(e,t.args[0],t.args[1]);H.type.is_term(i)?e.throw_error(i):0===i&&e.success(r)},"=\\=/2":function(e,r,t){var i=H.arithmetic_compare(e,t.args[0],t.args[1]);H.type.is_term(i)?e.throw_error(i):0!==i&&e.success(r)},"</2":function(e,r,t){var i=H.arithmetic_compare(e,t.args[0],t.args[1]);H.type.is_term(i)?e.throw_error(i):i<0&&e.success(r)},"=</2":function(e,r,t){var i=H.arithmetic_compare(e,t.args[0],t.args[1]);H.type.is_term(i)?e.throw_error(i):i<=0&&e.success(r)},">/2":function(e,r,t){var i=H.arithmetic_compare(e,t.args[0],t.args[1]);H.type.is_term(i)?e.throw_error(i):i>0&&e.success(r)},">=/2":function(e,r,t){var i=H.arithmetic_compare(e,t.args[0],t.args[1]);H.type.is_term(i)?e.throw_error(i):i>=0&&e.success(r)},"var/1":function(e,r,t){H.type.is_variable(t.args[0])&&e.success(r)},"atom/1":function(e,r,t){H.type.is_atom(t.args[0])&&e.success(r)},"atomic/1":function(e,r,t){H.type.is_atomic(t.args[0])&&e.success(r)},"compound/1":function(e,r,t){H.type.is_compound(t.args[0])&&e.success(r)},"integer/1":function(e,r,t){H.type.is_integer(t.args[0])&&e.success(r)},"float/1":function(e,r,t){H.type.is_float(t.args[0])&&e.success(r)},"number/1":function(e,r,t){H.type.is_number(t.args[0])&&e.success(r)},"nonvar/1":function(e,r,t){H.type.is_variable(t.args[0])||e.success(r)},"ground/1":function(e,r,t){0===t.variables().length&&e.success(r)},"acyclic_term/1":function(e,r,t){for(var i=r.substitution.apply(r.substitution),n=t.args[0].variables(),a=0;a<n.length;a++)if(void 0!==r.substitution.links[n[a]]&&!r.substitution.links[n[a]].equals(i.links[n[a]]))return;e.success(r)},"callable/1":function(e,r,t){var i=t.args[0];H.type.is_term(i)&&e.success(r)},"is_list/1":function(e,r,t){for(var i=t.args[0];H.type.is_term(i)&&"./2"===i.indicator;)i=i.args[1];H.type.is_term(i)&&"[]/0"===i.indicator&&e.success(r)},"current_input/1":function(e,r,t){var i=t.args[0];H.type.is_variable(i)||H.type.is_stream(i)&&(e.get_stream_by_alias(i.alias)||e.get_stream_by_alias(i.id))||H.type.is_atom(i)&&e.get_stream_by_alias(i.id)?(H.type.is_atom(i)&&(i=e.get_stream_by_alias(i.id)),e.prepend([new $(r.goal.replace(new Y("=",[i,e.get_current_input()])),r.substitution,r)])):e.throw_error(H.error.domain("stream",i,t.indicator))},"current_output/1":function(e,r,t){var i=t.args[0];H.type.is_variable(i)||H.type.is_stream(i)&&(e.get_stream_by_alias(i.alias)||e.get_stream_by_alias(i.id))||H.type.is_atom(i)&&e.get_stream_by_alias(i.id)?(H.type.is_atom(i)&&(i=e.get_stream_by_alias(i.id)),e.prepend([new $(r.goal.replace(new Y("=",[i,e.get_current_output()])),r.substitution,r)])):e.throw_error(H.error.domain("stream",i,t.indicator))},"set_input/1":function(e,r,t){var i=t.args[0],n=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(n)&&(e.get_stream_by_alias(i.alias)||e.get_stream_by_alias(i.id))?!0===n.output?e.throw_error(H.error.permission("input","stream",i,t.indicator)):(e.set_current_input(n),e.success(r)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator))},"set_output/1":function(e,r,t){var i=t.args[0],n=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(n)&&(e.get_stream_by_alias(i.alias)||e.get_stream_by_alias(i.id))?!0===n.input?e.throw_error(H.error.permission("output","stream",i,t.indicator)):(e.set_current_output(n),e.success(r)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator))},"open/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];e.prepend([new $(r.goal.replace(new Y("open",[i,n,a,new Y("[]",[])])),r.substitution,r)])},"open/4":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2],o=t.args[3];if(H.type.is_variable(i)||H.type.is_variable(n)||H.type.is_variable(o))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_atom(n))if(H.type.is_list(o))if(H.type.is_variable(a))if(H.type.is_atom(i)||H.type.is_streamable(i))if(H.type.is_io_mode(n)){for(var s,l={},p=o;H.type.is_term(p)&&"./2"===p.indicator;){if(s=p.args[0],H.type.is_variable(s))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_stream_option(s))return void e.throw_error(H.error.domain("stream_option",s,t.indicator));l[s.id]=s.args[0].id,p=p.args[1]}if("[]/0"!==p.indicator)return void(H.type.is_variable(p)?e.throw_error(H.error.instantiation(t.indicator)):e.throw_error(H.error.type("list",o,t.indicator)));var u,_=l.alias;if(_&&e.get_stream_by_alias(_))return void e.throw_error(H.error.permission("open","source_sink",new Y("alias",[new Y(_,[])]),t.indicator));if(l.type||(l.type="text"),!1===(u=H.type.is_atom(i)?e.file_system_open(i.id,l.type,n.id):i.stream(l.type,n.id)))return void e.throw_error(H.error.permission("open","source_sink",i,t.indicator));if(null===u)return void e.throw_error(H.error.existence("source_sink",i,t.indicator));var c=new q(u,n.id,l.alias,l.type,"true"===l.reposition,l.eof_action);_?e.session.streams[_]=c:e.session.streams[c.id]=c,e.prepend([new $(r.goal.replace(new Y("=",[a,c])),r.substitution,r)])}else e.throw_error(H.error.domain("io_mode",n,t.indicator));else e.throw_error(H.error.domain("source_sink",i,t.indicator));else e.throw_error(H.error.uninstantiation(a,t.indicator));else e.throw_error(H.error.type("list",o,t.indicator));else e.throw_error(H.error.type("atom",n,t.indicator))},"close/1":function(e,r,t){var i=t.args[0];e.prepend([new $(r.goal.replace(new Y("close",[i,new Y("[]",[])])),r.substitution,r)])},"close/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i)||H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_list(n))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream){for(var o,s={},l=n;H.type.is_term(l)&&"./2"===l.indicator;){if(o=l.args[0],H.type.is_variable(o))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_close_option(o))return void e.throw_error(H.error.domain("close_option",o,t.indicator));s[o.id]="true"===o.args[0].id,l=l.args[1]}if("[]/0"!==l.indicator)return void(H.type.is_variable(l)?e.throw_error(H.error.instantiation(t.indicator)):e.throw_error(H.error.type("list",n,t.indicator)));if(a===e.session.standard_input||a===e.session.standard_output||a===e.session.standard_error)return void e.success(r);a===e.session.current_input?e.session.current_input=e.session.standard_input:a===e.session.current_output&&(e.session.current_output=e.session.standard_output),null!==a.alias&&void 0!==a.alias?delete e.session.streams[a.alias]:delete e.session.streams[a.id],a.output&&a.stream.flush();var p=a.stream.close();a.stream=null,!0!==s.force&&!0!==p||e.success(r)}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("list",n,t.indicator))},"flush_output/0":[new z(new Y("flush_output",[]),new Y(",",[new Y("current_output",[new X("S")]),new Y("flush_output",[new X("S")])]))],"flush_output/1":function(e,r,t){var i=t.args[0],n=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(n)&&null!==n.stream?!0===n.input?e.throw_error(H.error.permission("output","stream",i,t.indicator)):(n.stream.flush(),e.success(r)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator))},"stream_property/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i)||H.type.is_stream(i))if(H.type.is_variable(i)||H.type.is_stream(a)&&null!==a.stream)if(H.type.is_variable(n)||H.type.is_stream_property(n)){var o=[],s=[],l=H.type.is_variable(n);if(H.type.is_variable(i))for(var p in e.session.streams)o.push(e.session.streams[p]);else o.push(a);for(var u=0;u<o.length;u++){var _=[];(l||"file_name/1"===n.indicator)&&o[u].filename&&_.push(new Y("file_name",[new Y(o[u].file_name,[])])),(l||"mode/1"===n.indicator)&&_.push(new Y("mode",[new Y(o[u].mode,[])])),(l||"input/0"===n.indicator||"output/0"===n.indicator)&&_.push(new Y(o[u].input?"input":"output",[])),(l||"alias/1"===n.indicator)&&o[u].alias&&_.push(new Y("alias",[new Y(o[u].alias,[])])),(l||"position/1"===n.indicator)&&_.push(new Y("position",[new Y("position",[new M(o[u].char_count,!1),new M(o[u].line_count,!1),new M(o[u].line_position,!1)])])),(l||"end_of_stream/1"===n.indicator)&&_.push(new Y("end_of_stream",[new Y("end_of_stream"===o[u].position||o[u].stream.eof&&o[u].stream.eof(o[u].position)?"at":"past_end_of_stream"===o[u].position?"past":"not",[])])),(l||"eof_action/1"===n.indicator)&&_.push(new Y("eof_action",[new Y(o[u].eof_action,[])])),(l||"reposition/1"===n.indicator)&&_.push(new Y("reposition",[new Y(o[u].reposition?"true":"false",[])])),(l||"type/1"===n.indicator)&&_.push(new Y("type",[new Y(o[u].type,[])]));for(var c=0;c<_.length;c++)s.push(new $(r.goal.replace(new Y(",",[new Y("=",[H.type.is_variable(i)?i:a,o[u]]),new Y("=",[n,_[c]])])),r.substitution,r))}e.prepend(s)}else e.throw_error(H.error.domain("stream_property",n,t.indicator));else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream",i,t.indicator))},"stream_position_data/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2];if(H.type.is_variable(n))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_term(n)&&"position/3"===n.indicator)if(H.type.is_variable(i)||H.type.is_atom(i))if(H.type.is_variable(a)||H.type.is_integer(a)){var o=["char_count","line_count","line_position"],s=[],l={char_count:0,line_count:1,line_position:2};if(H.type.is_variable(i))for(var p=0;p<o.length;p++)s.push(new $(r.goal.replace(new Y(",",[new Y("=",[new Y(o[p]),i]),new Y("=",[a,n.args[l[o[p]]]])])),r.substitution,r));else l.hasOwnProperty(i.id)&&s.push(new $(r.goal.replace(new Y("=",[a,n.args[l[i.id]]])),r.substitution,r));e.prepend(s)}else e.throw_error(H.error.type("integer",a,t.indicator));else e.throw_error(H.error.type("atom",i,t.indicator));else e.throw_error(H.error.domain("stream_position",n,t.indicator))},"at_end_of_stream/0":[new z(new Y("at_end_of_stream",[]),new H.type.Term(",",[new Y("current_input",[new X("S")]),new Y(",",[new Y("stream_property",[new X("S"),new Y("end_of_stream",[new X("E")])]),new Y(",",[new Y("!",[]),new Y(";",[new Y("=",[new X("E"),new Y("at",[])]),new Y("=",[new X("E"),new Y("past",[])])])])])]))],"at_end_of_stream/1":function(e,r,t){var i=t.args[0],n=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_stream(n)&&null!==n.stream){var a=e.next_free_variable();e.prepend([new $(r.goal.replace(new Y(",",[new Y("stream_property",[n,new Y("end_of_stream",[a])]),new Y(",",[new Y("!",[]),new Y(";",[new Y("=",[a,new Y("at",[])]),new Y("=",[a,new Y("past",[])])])])])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator))},"set_stream_position/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)||H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(a)&&null!==a.stream?H.type.is_stream_position(n)?!1===a.reposition?e.throw_error(H.error.permission("reposition","stream",i,t.indicator)):("position/3"===n.indicator?(a.position=n.args[0].value,a.char_count=n.args[0].value,a.line_count=n.args[1].value,a.line_position=n.args[2].value):a.position=n.id,e.success(r)):e.throw_error(H.error.domain("stream_position",n,t.indicator)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator))},"get_char/1":[new z(new Y("get_char",[new X("C")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("get_char",[new X("S"),new X("C")])]))],"get_char/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_in_character(n))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("binary"===a.type)e.throw_error(H.error.permission("input","binary_stream",i,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else{var o;if("end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else if("past_end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(H.error.representation("character",t.indicator));"end_of_stream"===o?(o="end_of_file",a.position="past_end_of_stream"):(a.position++,a.char_count++,a.line_position++,"\n"===o&&(a.line_count++,a.line_position=0))}e.prepend([new $(r.goal.replace(new Y("=",[new Y(o,[]),n])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("in_character",n,t.indicator))},"get_code/1":[new z(new Y("get_code",[new X("C")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("get_code",[new X("S"),new X("C")])]))],"get_code/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_integer(n))if(H.type.is_integer(n)&&!H.type.is_in_character_code(n))e.throw_error(H.error.representation("in_character_code",t.indicator));else if(H.type.is_variable(i)||H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("binary"===a.type)e.throw_error(H.error.permission("input","binary_stream",i,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else{var o;if("end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else if("past_end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(H.error.representation("character",t.indicator));"end_of_stream"===o?(o=-1,a.position="past_end_of_stream"):(o=s(o,0),a.position++,a.char_count++,a.line_position++,10===o&&(a.line_count++,a.line_position=0))}e.prepend([new $(r.goal.replace(new Y("=",[new M(o,!1),n])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("integer",n,t.indicator))},"peek_char/1":[new z(new Y("peek_char",[new X("C")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("peek_char",[new X("S"),new X("C")])]))],"peek_char/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_in_character(n))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("binary"===a.type)e.throw_error(H.error.permission("input","binary_stream",i,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else{var o;if("end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else if("past_end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(H.error.representation("character",t.indicator));"end_of_stream"===o&&(o="end_of_file")}e.prepend([new $(r.goal.replace(new Y("=",[new Y(o,[]),n])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("in_character",n,t.indicator))},"peek_code/1":[new z(new Y("peek_code",[new X("C")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("peek_code",[new X("S"),new X("C")])]))],"peek_code/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_integer(n))if(H.type.is_integer(n)&&!H.type.is_in_character_code(n))e.throw_error(H.error.representation("in_character_code",t.indicator));else if(H.type.is_variable(i)||H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("binary"===a.type)e.throw_error(H.error.permission("input","binary_stream",i,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else{var o;if("end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(H.error.representation("character",t.indicator));o="end_of_stream"===o?-1:s(o,0)}e.prepend([new $(r.goal.replace(new Y("=",[new M(o,!1),n])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("integer",n,t.indicator))},"put_char/1":[new z(new Y("put_char",[new X("C")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("put_char",[new X("S"),new X("C")])]))],"put_char/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)||H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_character(n)?H.type.is_variable(i)||H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(a)&&null!==a.stream?a.input?e.throw_error(H.error.permission("output","stream",i,t.indicator)):"binary"===a.type?e.throw_error(H.error.permission("output","binary_stream",i,t.indicator)):a.stream.put(n.id,a.position)&&("number"==typeof a.position&&a.position++,a.char_count++,a.line_position++,"\n"===n.id&&(a.line_count++,a.line_position=0),e.success(r)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator)):e.throw_error(H.error.type("character",n,t.indicator))},"put_code/1":[new z(new Y("put_code",[new X("C")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("put_code",[new X("S"),new X("C")])]))],"put_code/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)||H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_integer(n)?H.type.is_character_code(n)?H.type.is_variable(i)||H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(a)&&null!==a.stream?a.input?e.throw_error(H.error.permission("output","stream",i,t.indicator)):"binary"===a.type?e.throw_error(H.error.permission("output","binary_stream",i,t.indicator)):a.stream.put(l(n.value),a.position)&&("number"==typeof a.position&&a.position++,a.char_count++,a.line_position++,10===n.value&&(a.line_count++,a.line_position=0),e.success(r)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator)):e.throw_error(H.error.representation("character_code",t.indicator)):e.throw_error(H.error.type("integer",n,t.indicator))},"nl/0":[new z(new Y("nl"),new Y(",",[new Y("current_output",[new X("S")]),new Y("put_char",[new X("S"),new Y("\n")])]))],"nl/1":function(e,r,t){var i=t.args[0];e.prepend([new $(r.goal.replace(new Y("put_char",[i,new Y("\n",[])])),r.substitution,r)])},"get_byte/1":[new z(new Y("get_byte",[new X("B")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("get_byte",[new X("S"),new X("B")])]))],"get_byte/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_in_byte(n))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("text"===a.type)e.throw_error(H.error.permission("input","text_stream",i,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else{var o;if("end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else{if(null===(o=a.stream.get_byte(a.position)))return void e.throw_error(H.error.representation("byte",t.indicator));"end_of_stream"===o?(o=-1,a.position="past_end_of_stream"):(a.position++,a.char_count++,a.line_position++)}e.prepend([new $(r.goal.replace(new Y("=",[new M(o,!1),n])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("in_byte",n,t.indicator))},"peek_byte/1":[new z(new Y("peek_byte",[new X("B")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("peek_byte",[new X("S"),new X("B")])]))],"peek_byte/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(n)||H.type.is_in_byte(n))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("text"===a.type)e.throw_error(H.error.permission("input","text_stream",i,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else{var o;if("end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else{if(null===(o=a.stream.get_byte(a.position)))return void e.throw_error(H.error.representation("byte",t.indicator));"end_of_stream"===o&&(o=-1)}e.prepend([new $(r.goal.replace(new Y("=",[new M(o,!1),n])),r.substitution,r)])}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("in_byte",n,t.indicator))},"put_byte/1":[new z(new Y("put_byte",[new X("B")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("put_byte",[new X("S"),new X("B")])]))],"put_byte/2":function(e,r,t){var i=t.args[0],n=t.args[1],a=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);H.type.is_variable(i)||H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_byte(n)?H.type.is_variable(i)||H.type.is_stream(i)||H.type.is_atom(i)?H.type.is_stream(a)&&null!==a.stream?a.input?e.throw_error(H.error.permission("output","stream",i,t.indicator)):"text"===a.type?e.throw_error(H.error.permission("output","text_stream",i,t.indicator)):a.stream.put_byte(n.value,a.position)&&("number"==typeof a.position&&a.position++,a.char_count++,a.line_position++,e.success(r)):e.throw_error(H.error.existence("stream",i,t.indicator)):e.throw_error(H.error.domain("stream_or_alias",i,t.indicator)):e.throw_error(H.error.type("byte",n,t.indicator))},"read/1":[new z(new Y("read",[new X("T")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("read_term",[new X("S"),new X("T"),new Y("[]")])]))],"read/2":[new z(new Y("read",[new X("S"),new X("T")]),new Y("read_term",[new X("S"),new X("T"),new Y("[]")]))],"read_term/2":[new z(new Y("read_term",[new X("T"),new X("O")]),new Y(",",[new Y("current_input",[new X("S")]),new Y("read_term",[new X("S"),new X("T"),new X("O")])]))],"read_term/3":function(e,r,t){var i=t.args[0],n=t.args[1],o=t.args[2],s=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i)||H.type.is_variable(o))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_list(o))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(s)&&null!==s.stream)if(s.output)e.throw_error(H.error.permission("input","stream",i,t.indicator));else if("binary"===s.type)e.throw_error(H.error.permission("input","binary_stream",i,t.indicator));else if("past_end_of_stream"===s.position&&"error"===s.eof_action)e.throw_error(H.error.permission("input","past_end_of_stream",i,t.indicator));else if("past_end_of_stream"===s.position&&"eof_code"===s.eof_action)d={value:new Y("end_of_file",[]),type:1,len:-1};else{for(var l,p={},u=o;H.type.is_term(u)&&"./2"===u.indicator;){if(l=u.args[0],H.type.is_variable(l))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_read_option(l))return void e.throw_error(H.error.domain("read_option",l,t.indicator));p[l.id]=l.args[0],u=u.args[1]}if("[]/0"!==u.indicator)return void(H.type.is_variable(u)?e.throw_error(H.error.instantiation(t.indicator)):e.throw_error(H.error.type("list",o,t.indicator)));for(var _,c,d,w="",f=[],y=null,h=!1;null===y||h||"atom"!==y.name||"."!==y.value||f.length>0&&0===d.type;){for(_=s.stream.get(1,s.position);null!==_&&"."!==_&&"end_of_stream"!==_&&"past_end_of_stream"!==_;)s.position++,w+=_,_=s.stream.get(1,s.position);if(null===_)return void e.throw_error(H.error.representation("character",t.indicator));if("end_of_stream"===_||"past_end_of_stream"===_){if(null===f||0===f.length){s.position="past_end_of_stream",d={value:new Y("end_of_file",[]),type:1,len:-1};break}return d?void e.throw_error(H.error.syntax(y,"unexpected end of file",!1)):void e.throw_error(H.error.syntax(y,"token not found",!0))}if("."===_&&(s.position++,w+=_),(c=new g(e)).new_text(w),f=c.get_tokens(),num_token=null!==f&&f.length>1?f[f.length-2]:null,y=null!==f&&f.length>0?f[f.length-1]:null,null!==f){h=!1;for(var m=0;m<f.length&&!h;m++)h="lexical"===f[m].name;if(!h&&(d=v(e,f,0,e.__get_max_priority(),!1),num_token&&"number"===num_token.name&&!num_token.float&&!num_token.blank&&"."===y.value)){var b=s.stream.get(1,s.position);if(b>="0"&&b<="9"){s.position++,w+=b,y=null;continue}}}}if(y&&(y.line_position===y.len?s.line_position+=y.line_position:s.line_position=y.line_position,s.line_count+=y.line_count,s.char_count+=y.len),1===d.type&&(-1===d.len||d.len===f.length-1&&"."===y.value)){e.session.renamed_variables={};var x=new Y("=",[n,d=d.value.rename(e)]);if(p.variables){var k=V(a(P(d.variables()),(function(e){return new X(e)})));x=new Y(",",[x,new Y("=",[p.variables,k])])}if(p.variable_names){k=P(d.variables());var T=[];for(m=0;m<k.length;m++){var S=k[m];for(var A in e.session.renamed_variables)if(e.session.renamed_variables.hasOwnProperty(A)&&e.session.renamed_variables[A]===S){T.push(new Y("=",[new Y(A,[]),new X(S)]));break}}T=V(T),x=new Y(",",[x,new Y("=",[p.variable_names,T])])}if(p.singletons){for(k=P(new z(d,null).singleton_variables(!0)),T=[],m=0;m<k.length;m++){S=k[m];for(var A in e.session.renamed_variables)if(e.session.renamed_variables.hasOwnProperty(A)&&e.session.renamed_variables[A]===S){T.push(new Y("=",[new Y(A,[]),new X(S)]));break}}T=V(T),x=new Y(",",[x,new Y("=",[p.singletons,T])])}e.prepend([new $(r.goal.replace(x),r.substitution,r)])}else 1===d.type?e.throw_error(H.error.syntax(f[d.len],"unexpected token",!1)):e.throw_error(d.value)}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("list",o,t.indicator))},"write/1":[new z(new Y("write",[new X("T")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("write",[new X("S"),new X("T")])]))],"write/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.prepend([new $(r.goal.replace(new Y("write_term",[i,n,new Y(".",[new Y("quoted",[new Y("false",[])]),new Y(".",[new Y("ignore_ops",[new Y("false")]),new Y(".",[new Y("numbervars",[new Y("true")]),new Y("[]",[])])])])])),r.substitution,r)])},"writeq/1":[new z(new Y("writeq",[new X("T")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("writeq",[new X("S"),new X("T")])]))],"writeq/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.prepend([new $(r.goal.replace(new Y("write_term",[i,n,new Y(".",[new Y("quoted",[new Y("true",[])]),new Y(".",[new Y("ignore_ops",[new Y("false")]),new Y(".",[new Y("numbervars",[new Y("true")]),new Y("[]",[])])])])])),r.substitution,r)])},"write_canonical/1":[new z(new Y("write_canonical",[new X("T")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("write_canonical",[new X("S"),new X("T")])]))],"write_canonical/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.prepend([new $(r.goal.replace(new Y("write_term",[i,n,new Y(".",[new Y("quoted",[new Y("true",[])]),new Y(".",[new Y("ignore_ops",[new Y("true")]),new Y(".",[new Y("numbervars",[new Y("false")]),new Y("[]",[])])])])])),r.substitution,r)])},"write_term/2":[new z(new Y("write_term",[new X("T"),new X("O")]),new Y(",",[new Y("current_output",[new X("S")]),new Y("write_term",[new X("S"),new X("T"),new X("O")])]))],"write_term/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2],o=H.type.is_stream(i)?i:e.get_stream_by_alias(i.id);if(H.type.is_variable(i)||H.type.is_variable(a))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_list(a))if(H.type.is_stream(i)||H.type.is_atom(i))if(H.type.is_stream(o)&&null!==o.stream)if(o.input)e.throw_error(H.error.permission("output","stream",i,t.indicator));else if("binary"===o.type)e.throw_error(H.error.permission("output","binary_stream",i,t.indicator));else if("past_end_of_stream"===o.position&&"error"===o.eof_action)e.throw_error(H.error.permission("output","past_end_of_stream",i,t.indicator));else{for(var s,l={},p=a;H.type.is_term(p)&&"./2"===p.indicator;){if(s=p.args[0],H.type.is_variable(s))return void e.throw_error(H.error.instantiation(t.indicator));if(!H.type.is_write_option(s))return void e.throw_error(H.error.domain("write_option",s,t.indicator));"variable_names/1"===s.indicator?l[s.id]=s.args[0]:l[s.id]="true"===s.args[0].id,p=p.args[1]}if("[]/0"!==p.indicator)return void(H.type.is_variable(p)?e.throw_error(H.error.instantiation(t.indicator)):e.throw_error(H.error.type("list",a,t.indicator)));l.session=e.session;var u=n.toString(l);o.stream.put(u,o.position),"number"==typeof o.position&&(o.position+=u.length);var _=(u.match(/\n/g)||[]).length;o.line_count+=_,_>0?o.line_position=u.length-u.lastIndexOf("\n")-1:o.line_position+=u.length,o.char_count+=u.length,e.success(r)}else e.throw_error(H.error.existence("stream",i,t.indicator));else e.throw_error(H.error.domain("stream_or_alias",i,t.indicator));else e.throw_error(H.error.type("list",a,t.indicator))},"halt/0":function(e,r,t){"true/0"===e.get_flag("nodejs").indicator&&process.exit(),e.points=[]},"halt/1":function(e,r,t){var i=t.args[0];H.type.is_variable(i)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_integer(i)?("true/0"===e.get_flag("nodejs").indicator&&process.exit(i.value),e.points=[]):e.throw_error(H.error.type("integer",i,t.indicator))},"current_prolog_flag/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i)||H.type.is_atom(i))if(H.type.is_variable(i)||H.type.is_flag(i)){var a=[];for(var o in H.flag)if(H.flag.hasOwnProperty(o)){var s=new Y(",",[new Y("=",[new Y(o),i]),new Y("=",[e.get_flag(o),n])]);a.push(new $(r.goal.replace(s),r.substitution,r))}e.prepend(a)}else e.throw_error(H.error.domain("prolog_flag",i,t.indicator));else e.throw_error(H.error.type("atom",i,t.indicator))},"set_prolog_flag/2":function(e,r,t){var i=t.args[0],n=t.args[1];H.type.is_variable(i)||H.type.is_variable(n)?e.throw_error(H.error.instantiation(t.indicator)):H.type.is_atom(i)?H.type.is_flag(i)?H.type.is_modifiable_flag(i)?H.type.is_value_flag(i,n)?(e.session.flag[i.id]=n,e.success(r)):e.throw_error(H.error.domain("flag_value",new Y("+",[i,n]),t.indicator)):e.throw_error(H.error.permission("modify","flag",i,t.indicator)):e.throw_error(H.error.domain("prolog_flag",i,t.indicator)):e.throw_error(H.error.type("atom",i,t.indicator))},"consult/1":function(e,r,t){var i=t.args[0],n="user";if(":/2"===i.indicator&&(n=i.args[0].id,i=i.args[1]),H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else{if(H.type.is_atom(i))return e.consult(i.id,{context_module:n,text:!1,html:!1,success:function(){e.success(r),e.again()},error:function(r){e.throw_error(r),e.again()}}),!0;e.throw_error(H.error.type("atom",i,t.indicator))}},"get_time/1":function(e,r,t){var i=t.args[0];if(H.type.is_variable(i)||H.type.is_number(i)){var n=new M(Date.now(),!0);e.prepend([new $(r.goal.replace(new Y("=",[i,n])),r.substitution,r)])}else e.throw_error(H.error.type("number",i,t.indicator))},"time_property/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_variable(i)||H.type.is_number(i))if(H.type.is_variable(n)||H.type.is_time_property(n)){var a;a=H.type.is_variable(n)?["year","month","day","hours","minutes","seconds","milliseconds","weekday"]:[n.id];for(var o,s=new Date(i.value),l=[],p=0;p<a.length;p++){switch(a[p]){case"year":o=new Y("year",[new M(s.getFullYear(),!1)]);break;case"month":o=new Y("month",[new M(s.getMonth(),!1)]);break;case"day":o=new Y("day",[new M(s.getDate(),!1)]);break;case"hours":o=new Y("hours",[new M(s.getHours(),!1)]);break;case"minutes":o=new Y("minutes",[new M(s.getMinutes(),!1)]);break;case"seconds":o=new Y("seconds",[new M(s.getSeconds(),!1)]);break;case"milliseconds":o=new Y("milliseconds",[new M(s.getMilliseconds(),!1)]);break;case"weekday":o=new Y("weekday",[new M(s.getDay(),!1)])}l.push(new $(r.goal.replace(new Y("=",[n,o])),r.substitution,r))}e.prepend(l)}else e.throw_error(H.error.domain("time_property",n,t.indicator));else e.throw_error(H.error.type("number",i,t.indicator))},"time_year/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_number(i))if(H.type.is_variable(n)||H.type.is_integer(n)){var a=new M(new Date(i.value).getFullYear(),!1);e.prepend([new $(r.goal.replace(new Y("=",[n,a])),r.substitution,r)])}else e.throw_error(H.error.type("integer",n,t.indicator));else e.throw_error(H.error.type("number",i,t.indicator))},"time_month/2":function(e,r,t){var i=t.args[0],n=t.args[1];if(H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_number(i))if(H.type.is_variable(n)||H.type.is_integer(n)){var a=new M(new Date(i.value).getMonth(),!1);e.prepend([new $(r.goal.replace(new Y("=",[n,a])),r.substitution,r)])}else e.throw_error(H.error.type("integer",n,t.indicator));else e.throw_error(H.error.type("number",i,t.indicator))},"phrase/3":function(e,r,t){var i=t.args[0],n=t.args[1],a=t.args[2],o="user";if(":/2"===i.indicator&&(o=i.args[0].id,i=i.args[1]),H.type.is_variable(i))e.throw_error(H.error.instantiation(t.indicator));else if(H.type.is_callable(i)){var s=A(i.clone(),n,e);s.value=new Y(":",[new Y(o),new Y("call",[s.value])]),null!==s&&e.prepend([new $(r.goal.replace(new Y(",",[s.value,new Y("=",[s.variable,a])])),r.substitution,r)])}else e.throw_error(H.error.type("callable",i,t.indicator))},"phrase/2":function(e,r,t){var i=t.args[0],n=t.args[1];e.prepend([new $(r.goal.replace(new Y("phrase",[i,n,new Y("[]",[])])),r.substitution,r)])},"version/0":function(e,t,i){var n="Welcome to Tau Prolog version "+r.major+"."+r.minor+"."+r.patch+"\n";n+="Tau Prolog comes with ABSOLUTELY NO WARRANTY. This is free software.\n",n+="Please run ?- license. for legal details.\n",n+="For online help and background, visit http:/tau-prolog.org",e.prepend([new $(t.goal.replace(new Y("write",[new Y(n,[])])),t.substitution,t)])},"license/0":function(e,r,t){e.prepend([new $(r.goal.replace(new Y("write",[new Y('Tau Prolog. A Prolog interpreter in JavaScript.\nCopyright (C) 2017 - 2022 José Antonio Riaza Valverde\n\nRedistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nYou should have received a copy of the BSD 3-Clause License along with this program. If not, see https://opensource.org/licenses/BSD-3-Clause',[])])),r.substitution,r)])}},"all",{meta_predicates:{"$findall/4":new Y("$findall",[new Y("?"),new M(0,!1),new Y("-"),new Y("?")]),"$bagof/3":new Y("$bagof",[new Y("?"),new Y("^"),new Y("-")]),"$setof/3":new Y("$setof",[new Y("?"),new Y("^"),new Y("-")]),"$if/3":new Y("$if",[new M(0,!1),new M(0,!1),new M(0,!1)]),";/2":new Y(";",[new M(0,!1),new M(0,!1)]),"->/2":new Y("->",[new M(0,!1),new M(0,!1)]),"*->/2":new Y("*->",[new M(0,!1),new M(0,!1)]),"\\+/1":new Y("\\+",[new M(0,!1)]),"abolish/1":new Y("abolish",[new Y(":")]),"asserta/1":new Y("asserta",[new Y(":")]),"assertz/1":new Y("assertz",[new Y(":")]),"bagof/3":new Y("bagof",[new Y("?"),new Y("^"),new Y("-")]),"call/1":new Y("call",[new M(0,!1)]),"call/2":new Y("call",[new M(1,!1),new Y("?")]),"call/3":new Y("call",[new M(2,!1),new Y("?"),new Y("?")]),"call/4":new Y("call",[new M(3,!1),new Y("?"),new Y("?"),new Y("?")]),"call/5":new Y("call",[new M(4,!1),new Y("?"),new Y("?"),new Y("?"),new Y("?")]),"call/6":new Y("call",[new M(5,!1),new Y("?"),new Y("?"),new Y("?"),new Y("?"),new Y("?")]),"call/7":new Y("call",[new M(6,!1),new Y("?"),new Y("?"),new Y("?"),new Y("?"),new Y("?"),new Y("?")]),"call/8":new Y("call",[new M(6,!1),new Y("?"),new Y("?"),new Y("?"),new Y("?"),new Y("?"),new Y("?"),new Y("?")]),"call_cleanup/2":new Y("call_cleanup",[new M(0,!1),new M(0,!1)]),"catch/3":new Y("catch",[new M(0,!1),new Y("?"),new M(0,!1)]),"consult/1":new Y("consult",[new Y(":")]),"clause/2":new Y("clause",[new Y(":"),new Y("?")]),"current_predicate/2":new Y("current_predicate",[new Y("?"),new Y(":")]),"findall/3":new Y("findall",[new Y("?"),new M(0,!1),new Y("-")]),"findall/4":new Y("findall",[new Y("?"),new M(0,!1),new Y("-"),new Y("?")]),"forall/2":new Y("forall",[new M(0,!1),new M(0,!1)]),"listing/1":new Y("listing",[new Y(":")]),"once/1":new Y("once",[new M(0,!1)]),"phrase/2":new Y("phrase",[new Y(":"),new Y("?")]),"phrase/3":new Y("phrase",[new Y(":"),new Y("?"),new Y("?")]),"retract/1":new Y("retract",[new Y(":")]),"retractall/1":new Y("retractall",[new Y(":")]),"setup_call_cleanup/3":new Y("setup_call_cleanup",[new M(0,!1),new M(0,!1),new M(0,!1)]),"setof/3":new Y("setof",[new Y("?"),new Y("^"),new Y("-")])}}),"undefined"!=typeof module?module.exports=H:window.pl=H}();
//# sourceMappingURL=/sm/a84a479cf9b5193a98167f69777aa8bfb59488397c04dcdca9f1fb693eb04344.map